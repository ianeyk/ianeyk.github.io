var gn=Object.defineProperty;var mn=(F,R,G)=>R in F?gn(F,R,{enumerable:!0,configurable:!0,writable:!0,value:G}):F[R]=G;var c=(F,R,G)=>(mn(F,typeof R!="symbol"?R+"":R,G),G),ls=(F,R,G)=>{if(!R.has(F))throw TypeError("Cannot "+G)};var r=(F,R,G)=>(ls(F,R,"read from private field"),G?G.call(F):R.get(F)),V=(F,R,G)=>{if(R.has(F))throw TypeError("Cannot add the same private member more than once");R instanceof WeakSet?R.add(F):R.set(F,G)},p=(F,R,G,v)=>(ls(F,R,"write to private field"),v?v.call(F,G):R.set(F,G),G);var Ie=(F,R,G,v)=>({set _(D){p(F,R,D,G)},get _(){return r(F,R,v)}}),m=(F,R,G)=>(ls(F,R,"access private method"),G);(function(){"use strict";var li,Zt,mt,rt,vt,yt,te,ee,K,pt,U,k,x,et,lt,tt,J,bt,X,wt,Mt,ct,xt,Et,st,he,cs,Ut,Ct,de,ht,Fe,hi,Ht,se,fe,St,zt,Tt,Rt,ue,hs,un,ie,Ne,ne,je,z,I,ge,ds,qt,ve,_t,Ft,me,fs;const v="GND",D="VDD";var di=Object.defineProperty,fi=(t,s,e)=>s in t?di(t,s,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[s]=e,oe=(t,s,e)=>(fi(t,typeof s!="symbol"?s+"":s,e),e);class Z{constructor(s,e,i){oe(this,"_rows"),oe(this,"_columns"),oe(this,"_values"),this._rows=Math.max(s,1),this._columns=Math.max(e,1),this._values=new Array(this._rows).fill([]).map(()=>new Array(this._columns).fill(0)),i&&(this.values=i)}get rows(){return this._rows}get columns(){return this._columns}get values(){return this._values}set values(s){const e=Math.min(s.length,this.rows),i=Math.min(s[0].length,this.columns);for(let n=0;n<e;n++)for(let a=0;a<i;a++)this.values[n][a]=s[n][a]}at(s,e){return this.values[s][e]}reset(){this.values=this.values.map(s=>s.map(()=>0))}addAColumn(){return new Z(this.rows,this.columns+1,this.values)}addARow(){return new Z(this.rows+1,this.columns,this.values)}equals(s){return this.rows===s.rows&&this.columns===s.columns&&this.values.reduce((e,i,n)=>e&&i.reduce((a,o,l)=>a&&s.at(n,l)===o,e),!0)}setAsIdentity(){if(this.rows!==this.columns)throw new Error("Dimension error! The matrix isn't squared!");return this.values.forEach((s,e)=>{s.forEach((i,n)=>{this.values[e][n]=e===n?1:0})}),this}static identity(s){if(s<1)throw Error("Dimension error! Matrix dimension must be positive.");return new Z(s,s).setAsIdentity()}multiply(s){if(this.columns!==s.rows)throw new Error("Dimension error! The operand matrix must have the same number of rows as 'this' matrix columns!");const e=new Z(this.rows,s.columns);return e.values=e.values.map((i,n)=>i.map((a,o)=>this.values[n].reduce((l,h,d)=>l+h*s.at(d,o),0))),e}indexOf(s){for(let e=0;e<this.rows;e++)for(let i=0;i<this.columns;i++)if(this.values[e][i]===s)return[e,i];return[-1,-1]}max(){return this.values.reduce((s,e)=>Math.max(s,...e),-1/0)}min(){return this.values.reduce((s,e)=>Math.min(s,...e),1/0)}round(){return new Z(this.rows,this.columns,this.values.map(s=>s.map(e=>Math.round(e))))}determinant(){if(this.rows!==this.columns)throw new Error("Dimension error! The matrix isn't squared!");if(this.rows===this.columns&&this.columns===1)return this.values[0][0];let s=0,e=1;if(this.rows===2)s=this.values[0][0]*this.values[1][1]-this.values[1][0]*this.values[0][1];else for(let i=0;i<this.rows;i++){const n=this.getCofactor(0,i);s+=e*this.at(0,i)*n.determinant(),e=-e}return s}getCofactor(s,e){return new Z(this.rows-1,this.columns-1,this.values.filter((i,n)=>n!==s).map(i=>i.filter((n,a)=>a!==e)))}transpose(){return new Z(this.columns,this.rows,new Array(this.columns).fill([]).map((s,e)=>new Array(this.rows).fill(0).map((i,n)=>this.at(n,e))))}inverse(){if(this.rows!==this.columns)throw new Error("Dimension error! The matrix isn't squared!");const s=this.determinant();if(s===0)throw new Error("Determinant is 0, can't compute inverse.");const e=new Z(this.rows,this.columns,this.values.map((i,n)=>i.map((a,o)=>Math.pow(-1,n+o)*this.getCofactor(n,o).determinant()))).transpose();return new Z(this.rows,this.columns,this.values.map((i,n)=>i.map((a,o)=>e.at(n,o)/s)))}toString(){return`[${this.values.map(s=>`[${s.join(", ")}]`).join(`,
`)}]`}}const ui=1e-5,ut=class{constructor(t){oe(this,"values",new Float32Array(4)),t!==void 0&&(this.xyzw=t)}get x(){return this.values[0]}set x(t){this.values[0]=t}get y(){return this.values[1]}set y(t){this.values[1]=t}get z(){return this.values[2]}set z(t){this.values[2]=t}get w(){return this.values[3]}set w(t){this.values[3]=t}get xy(){return[this.values[0],this.values[1]]}set xy(t){this.values[0]=t[0],this.values[1]=t[1]}get xyz(){return[this.values[0],this.values[1],this.values[2]]}set xyz(t){this.values[0]=t[0],this.values[1]=t[1],this.values[2]=t[2]}get xyzw(){return[this.values[0],this.values[1],this.values[2],this.values[3]]}set xyzw(t){this.values[0]=t[0],this.values[1]=t[1],this.values[2]=t[2],this.values[3]=t[3]}at(t){return this.values[t]}reset(){for(let t=0;t<4;t++)this.values[t]=0}copy(t){t||(t=new ut);for(let s=0;s<4;s++)t.values[s]=this.values[s];return t}roll(){const t=this.x,s=this.y,e=this.z,i=this.w;return Math.atan2(2*(t*s+i*e),i*i+t*t-s*s-e*e)}pitch(){const t=this.x,s=this.y,e=this.z,i=this.w;return Math.atan2(2*(s*e+i*t),i*i-t*t-s*s+e*e)}yaw(){return Math.asin(2*(this.x*this.z-this.w*this.y))}equals(t,s=ui){for(let e=0;e<4;e++)if(Math.abs(this.values[e]-t.at(e))>s)return!1;return!0}setIdentity(){return this.x=0,this.y=0,this.z=0,this.w=1,this}calculateW(){const t=this.x,s=this.y,e=this.z;return this.w=-Math.sqrt(Math.abs(1-t*t-s*s-e*e)),this}inverse(){const t=ut.dot(this,this);if(!t)return this.xyzw=[0,0,0,0],this;const s=t?1/t:0;return this.x*=-s,this.y*=-s,this.z*=-s,this.w*=s,this}conjugate(){return this.values[0]*=-1,this.values[1]*=-1,this.values[2]*=-1,this}length(){const t=this.x,s=this.y,e=this.z,i=this.w;return Math.sqrt(t*t+s*s+e*e+i*i)}normalize(t){t||(t=this);const s=this.x,e=this.y,i=this.z,n=this.w;let a=Math.sqrt(s*s+e*e+i*i+n*n);return a?(a=1/a,t.x=s*a,t.y=e*a,t.z=i*a,t.w=n*a,t):(t.x=0,t.y=0,t.z=0,t.w=0,t)}add(t){for(let s=0;s<4;s++)this.values[s]+=t.at(s);return this}multiply(t){const s=this.values[0],e=this.values[1],i=this.values[2],n=this.values[3],a=t.x,o=t.y,l=t.z,h=t.w;return this.x=s*h+n*a+e*l-i*o,this.y=e*h+n*o+i*a-s*l,this.z=i*h+n*l+s*o-e*a,this.w=n*h-s*a-e*o-i*l,this}static dot(t,s){return t.x*s.x+t.y*s.y+t.z*s.z+t.w*s.w}static sum(t,s){const e=new ut;return e.x=t.x+s.x,e.y=t.y+s.y,e.z=t.z+s.z,e.w=t.w+s.w,e}static product(t,s){const e=new ut,i=t.x,n=t.y,a=t.z,o=t.w,l=s.x,h=s.y,d=s.z,f=s.w;return e.x=i*f+o*l+n*d-a*h,e.y=n*f+o*h+a*l-i*d,e.z=a*f+o*d+i*h-n*l,e.w=o*f-i*l-n*h-a*d,e}static cross(t,s){const e=new ut,i=t.x,n=t.y,a=t.z,o=t.w,l=s.x,h=s.y,d=s.z,f=s.w;return e.x=o*d+a*f+i*h-n*l,e.y=o*f-i*l-n*h-a*d,e.z=o*l+i*f+n*d-a*h,e.w=o*h+n*f+a*l-i*d,e}static shortMix(t,s,e){const i=new ut;if(e<=0)return i.xyzw=t.xyzw,i;if(e>=1)return i.xyzw=s.xyzw,i;let n=ut.dot(t,s);const a=s.copy();n<0&&(a.inverse(),n=-n);let o,l;if(n>.9999)o=1-e,l=0+e;else{const h=Math.sqrt(1-n*n),d=Math.atan2(h,n),f=1/h;o=Math.sin((1-e)*d)*f,l=Math.sin((0+e)*d)*f}return i.x=o*t.x+l*a.x,i.y=o*t.y+l*a.y,i.z=o*t.z+l*a.z,i.w=o*t.w+l*a.w,i}static mix(t,s,e){const i=new ut,n=t.x*s.x+t.y*s.y+t.z*s.z+t.w*s.w;if(Math.abs(n)>=1)return i.xyzw=t.xyzw,i;const a=Math.acos(n),o=Math.sqrt(1-n*n);if(Math.abs(o)<.001)return i.x=t.x*.5+s.x*.5,i.y=t.y*.5+s.y*.5,i.z=t.z*.5+s.z*.5,i.w=t.w*.5+s.w*.5,i;const l=Math.sin((1-e)*a)/o,h=Math.sin(e*a)/o;return i.x=t.x*l+s.x*h,i.y=t.y*l+s.y*h,i.z=t.z*l+s.z*h,i.w=t.w*l+s.w*h,i}static fromAxisAngle(t,s){if(t.rows!==3)throw new Error("The axis vector must be in 3D!");const e=new ut;s*=.5;const i=Math.sin(s);return e.x=t.at(0)*i,e.y=t.at(1)*i,e.z=t.at(2)*i,e.w=Math.cos(s),e}};oe(ut,"identity",new ut().setIdentity());class P{constructor(){c(this,"matrix");this.matrix=new Z(3,3,[[1,0,0],[0,1,0],[0,0,1]])}get scaleX(){return Math.sqrt(this.matrix.at(0,0)**2+this.matrix.at(1,0)**2)}get scaleY(){return Math.sqrt(this.matrix.at(0,1)**2+this.matrix.at(1,1)**2)}get relativeScale(){return Math.sqrt(Math.abs(this.matrix.determinant()))}get rotation(){return Math.atan2(-1*this.matrix.at(0,1),this.matrix.at(0,0))}get isMirrored(){return this.matrix.determinant()<0}get translation(){return{x:this.matrix.at(0,2),y:this.matrix.at(1,2)}}set scaleX(s){this.scale(1/this.scaleX,1,!0),this.scale(s,1,!0)}set scaleY(s){this.scale(1,1/this.scaleY,!0),this.scale(1,s,!0)}set relativeScale(s){this.scale(1/this.relativeScale,1/this.relativeScale,!0),this.scale(s,s,!0)}set rotation(s){this.rotate(-this.rotation,!0),this.rotate(s,!0)}set isMirrored(s){this.isMirrored!=s&&this.mirror(!0,!1,!0)}set translation(s){this.translate({x:-this.translation.x,y:-this.translation.y},!0),this.translate(s,!0)}rotate(s,e=!1){const i=new P;return Object.assign(i,this),i.matrix=this.matrix.multiply(new Z(3,3,[[Math.cos(s),-Math.sin(s),0],[Math.sin(s),Math.cos(s),0],[0,0,1]])),e&&Object.assign(this,i),i}translate(s,e=!1){const i=new P;return Object.assign(i,this),i.matrix=this.matrix.multiply(new Z(3,3,[[1,0,s.x],[0,1,s.y],[0,0,1]])),e&&Object.assign(this,i),i}mirror(s,e=!1,i=!1){const n=new P;Object.assign(n,this);const a=s?-1:1,o=e?-1:1;return n.matrix=this.matrix.multiply(new Z(3,3,[[a,0,0],[0,o,0],[0,0,1]])),i&&Object.assign(this,n),n}scale(s,e=s,i=!1){const n=new P;return Object.assign(n,this),n.matrix=this.matrix.multiply(new Z(3,3,[[s,0,0],[0,e,0],[0,0,1]])),i&&Object.assign(this,n),n}inverse(s=!1){const e=new P;return Object.assign(e,this),e.matrix=e.matrix.inverse(),s&&Object.assign(this,e),e}multiply(s,e=!1){const i=new P;return Object.assign(i,this),i.matrix=i.matrix.multiply(s.matrix),e&&Object.assign(this,i),i}transformCanvas(s,e=!0){e?s.setTransform(this.matrix.at(0,0),this.matrix.at(1,0),this.matrix.at(0,1),this.matrix.at(1,1),this.matrix.at(0,2),this.matrix.at(1,2)):s.transform(this.matrix.at(0,0),this.matrix.at(1,0),this.matrix.at(0,1),this.matrix.at(1,1),this.matrix.at(0,2),this.matrix.at(1,2))}transformPoint(s){const e=this.matrix.multiply(new Z(3,1,[[s.x],[s.y],[1]]));return{x:e.at(0,0),y:e.at(1,0)}}transformLine(s){return{start:this.transformPoint(s.start),end:this.transformPoint(s.end)}}transformPath(s){return s.map(e=>this.transformLine(e))}}/**
* @vue/shared v3.4.27
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**//*! #__NO_SIDE_EFFECTS__ */function gi(t,s){const e=new Set(t.split(","));return i=>e.has(i)}const mi=()=>{},vi=Object.prototype.hasOwnProperty,ye=(t,s)=>vi.call(t,s),kt=Array.isArray,pe=t=>us(t)==="[object Map]",yi=t=>typeof t=="function",pi=t=>typeof t=="string",re=t=>typeof t=="symbol",be=t=>t!==null&&typeof t=="object",bi=Object.prototype.toString,us=t=>bi.call(t),wi=t=>us(t).slice(8,-1),Ge=t=>pi(t)&&t!=="NaN"&&t[0]!=="-"&&""+parseInt(t,10)===t,Yt=(t,s)=>!Object.is(t,s);let gs;const Mi=()=>gs||(gs=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});/**
* @vue/reactivity v3.4.27
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let xi;function Vi(t,s=xi){s&&s.active&&s.effects.push(t)}let It;class Si{constructor(s,e,i,n){this.fn=s,this.trigger=e,this.scheduler=i,this.active=!0,this.deps=[],this._dirtyLevel=4,this._trackId=0,this._runnings=0,this._shouldSchedule=!1,this._depsLength=0,Vi(this,n)}get dirty(){if(this._dirtyLevel===2||this._dirtyLevel===3){this._dirtyLevel=1,bs();for(let s=0;s<this._depsLength;s++){const e=this.deps[s];if(e.computed&&(Ti(e.computed),this._dirtyLevel>=4))break}this._dirtyLevel===1&&(this._dirtyLevel=0),ws()}return this._dirtyLevel>=4}set dirty(s){this._dirtyLevel=s?4:0}run(){if(this._dirtyLevel=0,!this.active)return this.fn();let s=Lt,e=It;try{return Lt=!0,It=this,this._runnings++,ms(this),this.fn()}finally{vs(this),this._runnings--,It=e,Lt=s}}stop(){this.active&&(ms(this),vs(this),this.onStop&&this.onStop(),this.active=!1)}}function Ti(t){return t.value}function ms(t){t._trackId++,t._depsLength=0}function vs(t){if(t.deps.length>t._depsLength){for(let s=t._depsLength;s<t.deps.length;s++)ys(t.deps[s],t);t.deps.length=t._depsLength}}function ys(t,s){const e=t.get(s);e!==void 0&&s._trackId!==e&&(t.delete(s),t.size===0&&t.cleanup())}let Lt=!0,Be=0;const ps=[];function bs(){ps.push(Lt),Lt=!1}function ws(){const t=ps.pop();Lt=t===void 0?!0:t}function Ue(){Be++}function He(){for(Be--;!Be&&qe.length;)qe.shift()()}function Ms(t,s,e){if(s.get(t)!==t._trackId){s.set(t,t._trackId);const i=t.deps[t._depsLength];i!==s?(i&&ys(i,t),t.deps[t._depsLength++]=s):t._depsLength++}}const qe=[];function xs(t,s,e){Ue();for(const i of t.keys()){let n;i._dirtyLevel<s&&(n??(n=t.get(i)===i._trackId))&&(i._shouldSchedule||(i._shouldSchedule=i._dirtyLevel===0),i._dirtyLevel=s),i._shouldSchedule&&(n??(n=t.get(i)===i._trackId))&&(i.trigger(),(!i._runnings||i.allowRecurse)&&i._dirtyLevel!==2&&(i._shouldSchedule=!1,i.scheduler&&qe.push(i.scheduler)))}He()}const Vs=(t,s)=>{const e=new Map;return e.cleanup=t,e.computed=s,e},Ke=new WeakMap,Nt=Symbol(""),Ye=Symbol("");function dt(t,s,e){if(Lt&&It){let i=Ke.get(t);i||Ke.set(t,i=new Map);let n=i.get(e);n||i.set(e,n=Vs(()=>i.delete(e))),Ms(It,n)}}function Dt(t,s,e,i,n,a){const o=Ke.get(t);if(!o)return;let l=[];if(s==="clear")l=[...o.values()];else if(e==="length"&&kt(t)){const h=Number(i);o.forEach((d,f)=>{(f==="length"||!re(f)&&f>=h)&&l.push(d)})}else switch(e!==void 0&&l.push(o.get(e)),s){case"add":kt(t)?Ge(e)&&l.push(o.get("length")):(l.push(o.get(Nt)),pe(t)&&l.push(o.get(Ye)));break;case"delete":kt(t)||(l.push(o.get(Nt)),pe(t)&&l.push(o.get(Ye)));break;case"set":pe(t)&&l.push(o.get(Nt));break}Ue();for(const h of l)h&&xs(h,4);He()}const _i=gi("__proto__,__v_isRef,__isVue"),Ss=new Set(Object.getOwnPropertyNames(Symbol).filter(t=>t!=="arguments"&&t!=="caller").map(t=>Symbol[t]).filter(re)),Ts=Ai();function Ai(){const t={};return["includes","indexOf","lastIndexOf"].forEach(s=>{t[s]=function(...e){const i=E(this);for(let a=0,o=this.length;a<o;a++)dt(i,"get",a+"");const n=i[s](...e);return n===-1||n===!1?i[s](...e.map(E)):n}}),["push","pop","shift","unshift","splice"].forEach(s=>{t[s]=function(...e){bs(),Ue();const i=E(this)[s].apply(this,e);return He(),ws(),i}}),t}function Pi(t){re(t)||(t=String(t));const s=E(this);return dt(s,"has",t),s.hasOwnProperty(t)}class _s{constructor(s=!1,e=!1){this._isReadonly=s,this._isShallow=e}get(s,e,i){const n=this._isReadonly,a=this._isShallow;if(e==="__v_isReactive")return!n;if(e==="__v_isReadonly")return n;if(e==="__v_isShallow")return a;if(e==="__v_raw")return i===(n?a?ji:Os:a?Ni:Ws).get(s)||Object.getPrototypeOf(s)===Object.getPrototypeOf(i)?s:void 0;const o=kt(s);if(!n){if(o&&ye(Ts,e))return Reflect.get(Ts,e,i);if(e==="hasOwnProperty")return Pi}const l=Reflect.get(s,e,i);return(re(e)?Ss.has(e):_i(e))||(n||dt(s,"get",e),a)?l:Pe(l)?o&&Ge(e)?l:l.value:be(l)?n?zs(l):Es(l):l}}class Ci extends _s{constructor(s=!1){super(!1,s)}set(s,e,i,n){let a=s[e];if(!this._isShallow){const h=_e(a);if(!Fs(i)&&!_e(i)&&(a=E(a),i=E(i)),!kt(s)&&Pe(a)&&!Pe(i))return h?!1:(a.value=i,!0)}const o=kt(s)&&Ge(e)?Number(e)<s.length:ye(s,e),l=Reflect.set(s,e,i,n);return s===E(n)&&(o?Yt(i,a)&&Dt(s,"set",e,i):Dt(s,"add",e,i)),l}deleteProperty(s,e){const i=ye(s,e);s[e];const n=Reflect.deleteProperty(s,e);return n&&i&&Dt(s,"delete",e,void 0),n}has(s,e){const i=Reflect.has(s,e);return(!re(e)||!Ss.has(e))&&dt(s,"has",e),i}ownKeys(s){return dt(s,"iterate",kt(s)?"length":Nt),Reflect.ownKeys(s)}}class Li extends _s{constructor(s=!1){super(!0,s)}set(s,e){return!0}deleteProperty(s,e){return!0}}const Di=new Ci,Wi=new Li,Je=t=>t,we=t=>Reflect.getPrototypeOf(t);function Me(t,s,e=!1,i=!1){t=t.__v_raw;const n=E(t),a=E(s);e||(Yt(s,a)&&dt(n,"get",s),dt(n,"get",a));const{has:o}=we(n),l=i?Je:e?Xe:le;if(o.call(n,s))return l(t.get(s));if(o.call(n,a))return l(t.get(a));t!==n&&t.get(s)}function xe(t,s=!1){const e=this.__v_raw,i=E(e),n=E(t);return s||(Yt(t,n)&&dt(i,"has",t),dt(i,"has",n)),t===n?e.has(t):e.has(t)||e.has(n)}function Ve(t,s=!1){return t=t.__v_raw,!s&&dt(E(t),"iterate",Nt),Reflect.get(t,"size",t)}function As(t){t=E(t);const s=E(this);return we(s).has.call(s,t)||(s.add(t),Dt(s,"add",t,t)),this}function Ps(t,s){s=E(s);const e=E(this),{has:i,get:n}=we(e);let a=i.call(e,t);a||(t=E(t),a=i.call(e,t));const o=n.call(e,t);return e.set(t,s),a?Yt(s,o)&&Dt(e,"set",t,s):Dt(e,"add",t,s),this}function Cs(t){const s=E(this),{has:e,get:i}=we(s);let n=e.call(s,t);n||(t=E(t),n=e.call(s,t)),i&&i.call(s,t);const a=s.delete(t);return n&&Dt(s,"delete",t,void 0),a}function Ls(){const t=E(this),s=t.size!==0,e=t.clear();return s&&Dt(t,"clear",void 0,void 0),e}function Se(t,s){return function(i,n){const a=this,o=a.__v_raw,l=E(o),h=s?Je:t?Xe:le;return!t&&dt(l,"iterate",Nt),o.forEach((d,f)=>i.call(n,h(d),h(f),a))}}function Te(t,s,e){return function(...i){const n=this.__v_raw,a=E(n),o=pe(a),l=t==="entries"||t===Symbol.iterator&&o,h=t==="keys"&&o,d=n[t](...i),f=e?Je:s?Xe:le;return!s&&dt(a,"iterate",h?Ye:Nt),{next(){const{value:u,done:M}=d.next();return M?{value:u,done:M}:{value:l?[f(u[0]),f(u[1])]:f(u),done:M}},[Symbol.iterator](){return this}}}}function Wt(t){return function(...s){return t==="delete"?!1:t==="clear"?void 0:this}}function Oi(){const t={get(a){return Me(this,a)},get size(){return Ve(this)},has:xe,add:As,set:Ps,delete:Cs,clear:Ls,forEach:Se(!1,!1)},s={get(a){return Me(this,a,!1,!0)},get size(){return Ve(this)},has:xe,add:As,set:Ps,delete:Cs,clear:Ls,forEach:Se(!1,!0)},e={get(a){return Me(this,a,!0)},get size(){return Ve(this,!0)},has(a){return xe.call(this,a,!0)},add:Wt("add"),set:Wt("set"),delete:Wt("delete"),clear:Wt("clear"),forEach:Se(!0,!1)},i={get(a){return Me(this,a,!0,!0)},get size(){return Ve(this,!0)},has(a){return xe.call(this,a,!0)},add:Wt("add"),set:Wt("set"),delete:Wt("delete"),clear:Wt("clear"),forEach:Se(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(a=>{t[a]=Te(a,!1,!1),e[a]=Te(a,!0,!1),s[a]=Te(a,!1,!0),i[a]=Te(a,!0,!0)}),[t,e,s,i]}const[Ei,zi,Ri,Fi]=Oi();function Ds(t,s){const e=s?t?Fi:Ri:t?zi:Ei;return(i,n,a)=>n==="__v_isReactive"?!t:n==="__v_isReadonly"?t:n==="__v_raw"?i:Reflect.get(ye(e,n)&&n in i?e:i,n,a)}const ki={get:Ds(!1,!1)},Ii={get:Ds(!0,!1)},Ws=new WeakMap,Ni=new WeakMap,Os=new WeakMap,ji=new WeakMap;function Gi(t){switch(t){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function Bi(t){return t.__v_skip||!Object.isExtensible(t)?0:Gi(wi(t))}function Es(t){return _e(t)?t:Rs(t,!1,Di,ki,Ws)}function zs(t){return Rs(t,!0,Wi,Ii,Os)}function Rs(t,s,e,i,n){if(!be(t)||t.__v_raw&&!(s&&t.__v_isReactive))return t;const a=n.get(t);if(a)return a;const o=Bi(t);if(o===0)return t;const l=new Proxy(t,o===2?i:e);return n.set(t,l),l}function _e(t){return!!(t&&t.__v_isReadonly)}function Fs(t){return!!(t&&t.__v_isShallow)}function E(t){const s=t&&t.__v_raw;return s?E(s):t}const le=t=>be(t)?Es(t):t,Xe=t=>be(t)?zs(t):t;class ks{constructor(s,e,i,n){this.getter=s,this._setter=e,this.dep=void 0,this.__v_isRef=!0,this.__v_isReadonly=!1,this.effect=new Si(()=>s(this._value),()=>Ae(this,this.effect._dirtyLevel===2?2:3)),this.effect.computed=this,this.effect.active=this._cacheable=!n,this.__v_isReadonly=i}get value(){const s=E(this);return(!s._cacheable||s.effect.dirty)&&Yt(s._value,s._value=s.effect.run())&&Ae(s,4),Is(s),s.effect._dirtyLevel>=2&&Ae(s,2),s._value}set value(s){this._setter(s)}get _dirty(){return this.effect.dirty}set _dirty(s){this.effect.dirty=s}}function Ui(t,s,e=!1){let i,n;const a=yi(t);return a?(i=t,n=mi):(i=t.get,n=t.set),new ks(i,n,a||!n,e)}function Is(t){var s;Lt&&It&&(t=E(t),Ms(It,(s=t.dep)!=null?s:t.dep=Vs(()=>t.dep=void 0,t instanceof ks?t:void 0)))}function Ae(t,s=4,e){t=E(t);const i=t.dep;i&&xs(i,s)}function Pe(t){return!!(t&&t.__v_isRef===!0)}function w(t){return Hi(t,!1)}function Hi(t,s){return Pe(t)?t:new qi(t,s)}class qi{constructor(s,e){this.__v_isShallow=e,this.dep=void 0,this.__v_isRef=!0,this._rawValue=e?s:E(s),this._value=e?s:le(s)}get value(){return Is(this),this._value}set value(s){const e=this.__v_isShallow||Fs(s)||_e(s);s=e?s:E(s),Yt(s,this._rawValue)&&(this._rawValue=s,this._value=e?s:le(s),Ae(this,4))}}/**
* @vue/runtime-core v3.4.27
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/{const t=Mi(),s=(e,i)=>{let n;return(n=t[e])||(n=t[e]=[]),n.push(i),a=>{n.length>1?n.forEach(o=>o(a)):n[0](a)}};s("__VUE_INSTANCE_SETTERS__",e=>e),s("__VUE_SSR_SETTERS__",e=>Ns=e)}let Ns=!1;const A=(t,s)=>Ui(t,s,Ns),js=(t,s,[e,...i])=>e===void 0?s:js(t,t(e,s),i),ot=t=>t*Math.PI/180,$e=(t,s)=>(t%s+s)%s,H=(t,s,e)=>{const i=Math.max(t,s),n=Math.min(t,s);return e>i?i:e<n?n:e},gt=class gt{constructor(s=[],e=new P,i="main"){c(this,"transformations",[]);c(this,"anchorPoints",{});c(this,"_transformationMatrix");c(this,"canvasId");c(this,"key","");s.forEach(n=>{this.transformations.push(n)}),this.transformations.push(w(e)),this._transformationMatrix=A(()=>js((n,a)=>a.multiply(n.value),new P,this.transformations)),gt.allCtxArtists.push(this),this.canvasId=i}get transformationMatrix(){return this._transformationMatrix.value}get localTransformationMatrix(){return this.transformations[this.transformations.length-1].value}getAnchorPoint(s){return this.anchorPoints[s]==null&&console.log("Cannot find anchor point",s,"on CtxArtist"),gt.circuitTransformationMatrix.inverse().multiply(this.transformationMatrix).transformPoint(this.anchorPoints[s])}getAnchorPointWithTransformations(s){return[this.transformations.slice(0,-1),this.getAnchorPoint(s)]}moveTo(s){this.transformations[this.transformations.length-1].value.translation=s}get localLineThickness(){return this.getLocalLineThickness()}fillTextGlobalReferenceFrame(s,e,i,n=!1,a=!1,o=16){if(gt.textTransformationMatrix.transformCanvas(s),n){const h=this.transformationMatrix.transformPoint({x:0,y:0}),d=this.transformationMatrix.transformPoint(e);d.x<h.x==!a?s.textAlign="right":d.x>h.x==!a?s.textAlign="left":s.textAlign="center"}const l=gt.textTransformationMatrix.inverse().transformPoint(this.transformationMatrix.transformPoint(e));return s.fillText(i,l.x,l.y),this.transformationMatrix.transformCanvas(s),this.transformationMatrix.inverse().transformPoint(gt.textTransformationMatrix.transformPoint({x:l.x,y:l.y+o}))}getRelativeScaling(){return gt.textTransformationMatrix.relativeScale/this.transformationMatrix.relativeScale}getLocalLineThickness(s=5){return s*this.getRelativeScaling()}};c(gt,"textTransformationMatrix",new P),c(gt,"circuitTransformationMatrix",new P),c(gt,"allCtxArtists",[]);let $=gt;const Ce=t=>Math.sqrt((t.end.x-t.start.x)**2+(t.end.y-t.start.y)**2),Gs=t=>{let s=0;return t.forEach(e=>{s+=Ce(e)}),s},Bs=(t,s)=>(s=H(0,1,s),{x:t.start.x+(t.end.x-t.start.x)*s,y:t.start.y+(t.end.y-t.start.y)*s}),it=(t,s)=>{const e=Gs(t),i=s*e;let n=0;for(let a of t){const o=Ce(a);if(n+=o,n>=i){const l=n-o,d=(i-l)/o;return Bs(a,d)}}return console.log("Error finding point along path"),{x:0,y:0}},Ki=(t,s,e,i=5)=>{const n=e.x-s.x,a=e.y-s.y,o=Math.sqrt(n**2+a**2),l=i/2/o*-a,h=i/2/o*n,d=i/2/o*n,f=i/2/o*a,u={x:s.x+l-d,y:s.y+h-f},M={x:s.x-l-d,y:s.y-h-f},S={x:e.x-l+d,y:e.y-h+f},L={x:e.x+l+d,y:e.y+h+f};t.moveTo(u.x,u.y),t.lineTo(M.x,M.y),t.lineTo(S.x,S.y),t.lineTo(L.x,L.y)},Yi=(t,s,e)=>{const i=s.outerDiameter,n=i-2*e;t.moveTo(s.center.x,s.center.y),t.arc(s.center.x,s.center.y,i/2,0,2*Math.PI,!1),n>0&&t.arc(s.center.x,s.center.y,n/2,0,2*Math.PI,!0)},Us=(t,s,e,i="rgba(200, 200, 200, 1)")=>{const n=t.createRadialGradient(s.x,s.y,0,s.x,s.y,e);return n.addColorStop(0,i),n.addColorStop(.5,i),n.addColorStop(.99,"rgba(0, 0, 0, 1)"),n.addColorStop(1,"rgba(0, 0, 0, 0)"),n},Hs=(t,s)=>()=>{t.save(),t.clip(),t.fillStyle=s,t.fill(),t.resetTransform(),t.fillRect(0,0,t.canvas.clientWidth,t.canvas.clientHeight),t.restore(),t.beginPath()},qs=(t,s="black")=>()=>{t.fillStyle=s,t.fill(),t.beginPath()},Ks=(t,s,e=5,i)=>{const n=Hs(t,i);for(let a=0;a<4;a++)Ys(t,s,e,n)},Vt=(t,s,e=5,i="black")=>{const n=qs(t,i);for(let a=0;a<4;a++)Ys(t,s,e,n)},Ys=(t,s,e=5,i)=>{t.beginPath(),s.forEach(n=>{Ki(t,n.start,n.end,e),i()})},Ji=(t,s,e=5,i)=>{const n=Hs(t,i);Js(t,s,e,n)},Qe=(t,s,e=5,i="black")=>{const n=qs(t,i);Js(t,s,e,n)},Js=(t,s,e=5,i)=>{t.beginPath(),s.forEach(n=>{Yi(t,n,e)}),i()},jt=(t,s,e=3)=>{if(t==0)return"0"+s;const i=t>=0?"":"-",n=Math.abs(t),a={30:"Q",27:"R",24:"Y",21:"Z",18:"E",15:"P",12:"T",9:"G",6:"M",3:"k",0:"","-3":"m","-6":"Âµ","-9":"n","-12":"p","-15":"f","-18":"a","-21":"z","-24":"y","-27":"r","-30":"q"},o=Math.floor(Math.log10(n)/3)*3;let l=a[o.toString()];l==null&&(l="e"+o.toString()+" ");const h=parseFloat((n/10**o).toPrecision(e));return i+h+l+s};class Pt extends ${constructor(e=[],i=[],n=[],a=[],o=[],l=[],h=[]){super(e,new P);c(this,"gndSymbols");c(this,"vddSymbols");c(this,"parasiticCapacitors");c(this,"mosfets");c(this,"nodes");c(this,"wires");this.gndSymbols=i,this.vddSymbols=n,this.parasiticCapacitors=a,this.mosfets=o,this.nodes=l,this.wires=h}copy(e){return new Pt([e].concat(this.transformations.slice(1)),this.gndSymbols.map(n=>n.copy(e)),this.vddSymbols.map(n=>n.copy(e)),[],this.mosfets,this.nodes,this.wires.map(n=>({node:n.node,lines:n.lines,voltageDisplayLabel:"",voltageDisplayLocations:[]})))}draw(e){this.transformationMatrix.transformCanvas(e),this.gndSymbols.forEach(i=>{i.draw(e)}),this.vddSymbols.forEach(i=>{i.draw(e)}),this.parasiticCapacitors.forEach(i=>{i.draw(e)}),this.transformationMatrix.transformCanvas(e),this.nodes.forEach(i=>{i.value.schematicEffects=[]}),this.mosfets.forEach(i=>{Object.values(i.schematicEffects).forEach(n=>{const a=Pt.flattenSchematicEffect(n);n.node.value.schematicEffects.push(a)})}),this.wires.forEach(i=>{Vt(e,i.lines.map(n=>n.toLine()),this.localLineThickness,"black"),i.node.value.schematicEffects.forEach(n=>{const a=n.origin,o=Us(e,a,n.gradientSize,n.color);Ks(e,i.lines.map(l=>l.toLine()),this.localLineThickness,o)}),i.voltageDisplayLocations.forEach(n=>{e.fillStyle="black",e.font="18px sans-serif",this.fillTextGlobalReferenceFrame(e,n.toPoint(),i.voltageDisplayLabel+" = "+jt(i.node.value.voltage,"V"),!1)})})}static flattenSchematicEffect(e){return{origin:e.origin.toPoint(),color:e.color,gradientSize:e.gradientSize}}}class Xs extends ${constructor(e=[],i=new P,n,a,o,l,h,d="visible",f="visible",u="main"){super(e,i);c(this,"visibility");c(this,"originalVisibility");c(this,"fromNode");c(this,"toNode");c(this,"dragging",!1);c(this,"location",{x:0,y:0});c(this,"minValue");c(this,"maxValue");c(this,"value");c(this,"drivenNode");c(this,"canvasId");c(this,"preciseDragging",!1);c(this,"temporaryMinValue");c(this,"temporaryMaxValue");c(this,"previousValue");c(this,"valueRateOfChange",0);this.originalVisibility=d,this.visibility=f,this.fromNode=n,this.toNode=a,this.minValue=l,this.maxValue=h,this.value=l,this.temporaryMinValue=l,this.temporaryMaxValue=h,this.previousValue=l,this.drivenNode=o,this.canvasId=u}draw(e){throw new Error("draw is a virtual function on the CtxSlider class. (Received"+e+")")}updateLocationBasedOnValue(){throw new Error("updateLocationBasedOnValue is a virtual function on the CtxSlider class.")}updateValueBasedOnMousePosition(e){throw new Error("updateValueBasedOnMousePosition is a virtual function on the CtxSlider class. (Received"+e+")")}mouseDownIntiatesDrag(e){throw new Error("mouseDownIntiatesDrag is a virtual function on the CtxSlider class. (Received"+e+")")}updateValueBasedOnNodeVoltages(){this.value=H(this.temporaryMinValue,this.temporaryMaxValue,this.toNode.value.voltage-this.fromNode.value.voltage),this.updateLocationBasedOnValue()}updateNodeVoltagesBasedOnValue(){this.dragging&&(this.drivenNode=="toNode"?(this.toNode.value.fixed=!0,this.toNode.value.voltage=this.fromNode.value.voltage+this.value):(this.fromNode.value.fixed=!0,this.fromNode.value.voltage=this.toNode.value.voltage-this.value))}dragSlider(e){if(this.dragging){const i=this.transformationMatrix.inverse().transformPoint(e);this.updateValueBasedOnMousePosition(i),this.value=H(this.temporaryMinValue,this.temporaryMaxValue,this.value);const n=H(0,1,(this.value-this.temporaryMinValue)/(this.temporaryMaxValue-this.temporaryMinValue));n<.05&&this.value<=this.previousValue?this.valueRateOfChange=-.01:n>.95&&this.value>=this.previousValue?this.valueRateOfChange=.01:this.valueRateOfChange=0,this.updateLocationBasedOnValue(),this.updateNodeVoltagesBasedOnValue(),this.previousValue=this.value}}releaseSlider(){this.temporaryMinValue=this.minValue,this.temporaryMaxValue=this.maxValue,this.preciseDragging=!1,this.dragging=!1,this.drivenNode=="toNode"?this.toNode.value.fixed=!1:this.fromNode.value.fixed=!1}adjustPreciseSlider(e=10){this.dragging&&this.preciseDragging&&(this.value>=this.maxValue||this.temporaryMaxValue>this.maxValue?(this.value=this.maxValue,this.temporaryMaxValue=this.maxValue,this.temporaryMinValue=this.maxValue-1.5,this.valueRateOfChange=0):this.value<=this.minValue||this.temporaryMinValue<this.minValue?(this.value=this.minValue,this.temporaryMinValue=this.minValue,this.temporaryMaxValue=this.minValue+1.5,this.valueRateOfChange=0):(this.temporaryMinValue+=this.valueRateOfChange*(e/1e3)*70,this.temporaryMaxValue+=this.valueRateOfChange*(e/1e3)*70,this.value+=this.valueRateOfChange*(e/1e3)*70))}checkDrag(e,i){if(this.visibility!="visible")return;const n=this.transformationMatrix.inverse().transformPoint(e);if(this.mouseDownIntiatesDrag(n)&&(this.dragging=!0),this.dragging)if(i){this.preciseDragging=!0;const a=(this.value-this.minValue)/(this.maxValue-this.minValue);this.temporaryMinValue=this.value-1.5*a,this.temporaryMaxValue=this.value+1.5*(1-a)}else this.temporaryMinValue=this.minValue,this.temporaryMaxValue=this.maxValue}}class Jt extends Xs{constructor(e=[],i,n,a,o,l,h,d,f,u,M,S,L,W,_="main"){super(e,new P().translate({x:o,y:l}).rotate(d).mirror(!1,u),i,n,a,M,S,W,W,_);c(this,"radius");c(this,"originalRadius");c(this,"endAngle");c(this,"displayText");this.radius=h,this.originalRadius=h,this.endAngle=f,this.displayText=L}draw(e){if(this.visibility=="hidden")return;this.transformationMatrix.transformCanvas(e),this.dragging&&this.preciseDragging?this.radius=this.originalRadius+10:this.radius=this.originalRadius,e.strokeStyle=this.visibility=="visible"?"orange":"lightgrey",e.lineWidth=this.localLineThickness,e.beginPath(),e.arc(0,0,this.radius,0,this.endAngle,!1);const i=this.endAngle,n=0,a=7;e.moveTo((this.radius+a)*Math.cos(n),(this.radius+a)*Math.sin(n)),e.lineTo((this.radius-a)*Math.cos(n),(this.radius-a)*Math.sin(n));const o=7,l=ot(-5);if(e.moveTo((this.radius+o)*Math.cos(i+l),(this.radius+o)*Math.sin(i+l)),e.lineTo(this.radius*Math.cos(i),this.radius*Math.sin(i)),e.lineTo((this.radius-o)*Math.cos(i+l),(this.radius-o)*Math.sin(i+l)),e.stroke(),this.dragging&&this.preciseDragging){const f=(M,S=!0)=>{const L=this.radius+(S?15:8);e.beginPath(),e.moveTo(this.radius*Math.cos(M),this.radius*Math.sin(M)),e.lineTo(L*Math.cos(M),L*Math.sin(M)),e.stroke()};let u=Math.ceil(this.temporaryMinValue);for(;u<this.temporaryMaxValue;){const M=(u-this.temporaryMinValue)/(this.temporaryMaxValue-this.temporaryMinValue);f(this.endAngle*M,!0),u+=1}for(u=Math.ceil(this.temporaryMinValue+.5)-.5;u<this.temporaryMaxValue;){const M=(u-this.temporaryMinValue)/(this.temporaryMaxValue-this.temporaryMinValue);f(this.endAngle*M,!1),u+=1}}e.beginPath(),e.arc(this.location.x,this.location.y,5,0,Math.PI*2),e.fillStyle=this.visibility=="visible"?"rgb(255, 0, 0)":"lightgrey",e.fill(),e.fillStyle=this.visibility=="visible"?"#000":"lightgrey";const h={x:this.location.x*(this.radius+15)/this.radius,y:this.location.y*(this.radius+15)/this.radius};e.font="18px Arial";const d=this.fillTextGlobalReferenceFrame(e,h,this.displayText,!0,!1,18);e.font="16px Arial",this.fillTextGlobalReferenceFrame(e,d,jt(this.value,"V",3),!0)}updateLocationBasedOnValue(){const i=(this.value-this.temporaryMinValue)/(this.temporaryMaxValue-this.temporaryMinValue)*this.endAngle;this.location={x:this.radius*Math.cos(i),y:this.radius*Math.sin(i)}}updateValueBasedOnMousePosition(e){const i=Math.atan2(e.y,e.x),n=H(0,1,i/this.endAngle);this.value=n*(this.temporaryMaxValue-this.temporaryMinValue)+this.temporaryMinValue,this.updateLocationBasedOnValue()}mouseDownIntiatesDrag(e){const i=e.x**2+e.y**2,n=(e.x-this.location.x)**2+(e.y-this.location.y)**2,o=Math.atan2(e.y,e.x)/this.endAngle;return n<=10**2||(this.radius-20)**2<i&&i<(this.radius+20)**2&&0<o&&o<1}}const Re=class Re extends ${constructor(e=[],i=A(()=>({x:0,y:0})),n={}){super(e,new P);c(this,"currentLocation",{x:0,y:0});c(this,"desiredLocation");this.desiredLocation=i,this.anchorPoints=n,Re.allTectonicPlates.push(this)}moveTowardDesiredLocation(){this.moveTowardLocation(this.desiredLocation.value)}moveTowardLocation(e){const n={start:this.currentLocation,end:e};let a={x:0,y:0};Ce($.textTransformationMatrix.transformLine(n))<.1?a=e:a=Bs(n,.1),this.moveTo(a),this.currentLocation=a}};c(Re,"allTectonicPlates",[]);let T=Re;class b extends ${constructor(e=[],i={x:0,y:0}){super(e,new P);c(this,"point");this.point=i}toPoint(){return this.transformations[0].value.inverse().multiply(this.transformationMatrix).transformPoint(this.point)}}class g{constructor(s,e,i,n){c(this,"start");c(this,"end");this.start=new b(s,e),this.end=new b(i,n)}toLine(){return{start:this.start.toPoint(),end:this.end.toPoint()}}}class $s extends ${constructor(e=[],i=new P,n="main"){super(e,i,n);c(this,"isDuplicate",!1);c(this,"mouseDownInsideSelectionArea",!1);c(this,"selected",w(!1));c(this,"selectedFocus",w(!1));c(this,"boundingBox");this.boundingBox=[new b(this.transformations,{x:-120,y:0}),new b(this.transformations,{x:120,y:0}),new b(this.transformations,{x:0,y:-120}),new b(this.transformations,{x:0,y:120})]}checkSelectionArea(e){const i=this.transformationMatrix.inverse().transformPoint(e);return Ce({start:{x:0,y:0},end:i})<60}drawSelectedHalo(e){if(this.selectedFocus.value&&!this.isDuplicate){const i=e.createRadialGradient(0,0,0,0,0,100);i.addColorStop(0,"rgba(0, 0, 255, 0)"),i.addColorStop(.5,"rgba(0, 0, 255, 0)"),i.addColorStop(.8,"rgba(0, 0, 255, 0.2)"),i.addColorStop(1,"rgba(0, 0, 255, 0)"),e.fillStyle=i,e.arc(0,0,200,0,2*Math.PI),e.fill()}}}class nt extends $s{constructor(e=[],i,n,a,o,l,h=!1,d="main"){super(e,new P().translate(i).mirror(h,!1).scale(1/30),d);c(this,"voltageDrop");c(this,"vplus");c(this,"vminus");c(this,"schematicEffects");c(this,"current");c(this,"fixedAt");c(this,"isDuplicate",!1);c(this,"selectedFocus",w(!1));c(this,"mouseDownInsideSelectionArea",!1);this.vplus=a,this.vminus=n,this.fixedAt=l,l=="gnd"?this.voltageDrop=new Jt(this.transformations,n,a,"toNode",0,0,50,ot(40),ot(80),!0,0,5,o,"visible",d):this.voltageDrop=new Jt(this.transformations.concat([w(new P().mirror(!1,!0))]),n,a,"fromNode",0,0,50,ot(40),ot(80),!0,0,5,o,"visible",d),this.schematicEffects={},this.current=0,this.anchorPoints={Vplus:{x:0,y:-30},Vminus:{x:0,y:30},vdd:{x:0,y:-60},gnd:{x:0,y:60}}}copy(e,i="main"){const n=new nt([e].concat(this.transformations.slice(1)),{x:0,y:0},this.vminus,this.vplus,this.voltageDrop.displayText,this.fixedAt,this.fixedAt=="gnd"==this.transformationMatrix.isMirrored,i);return n.transformations[n.transformations.length-1].value=new P,n}draw(e){this.transformationMatrix.transformCanvas(e),this.drawSelectedHalo(e);const i=30,n=11,a=10;e.strokeStyle="black",e.lineWidth=this.localLineThickness;const o=[],l=[{start:{x:n/2,y:-a},end:{x:-n/2,y:-a}},{start:{x:0,y:-a-n/2},end:{x:0,y:-a+n/2}},{start:{x:n/2,y:a},end:{x:-n/2,y:a}}],h=[{center:{x:0,y:0},outerDiameter:2*i}];Vt(e,o,this.localLineThickness,"black"),Vt(e,l,this.localLineThickness*.8,"black"),Qe(e,h,this.localLineThickness,"black"),this.voltageDrop.draw(e)}}const Ze=(t,s=0,e=5,i=0)=>{const n=t-i,a=s-i,o=e-i,l=.0256,h=.648,d=.8051,f=164e-8,u=f*Math.log(1+Math.exp((d*(n-h)-a)/(2*l)))**2+1e-15,M=f*Math.log(1+Math.exp((d*(n-h)-o)/(2*l)))**2,S=u-M,L=S/u;return{I:S,IF:u,saturationLevel:L}},ts=(t,s=5,e=0,i=5)=>{const n=i-t,a=i-s,o=i-e,l=.0256,h=.7283,d=.7609,f=6108e-10,u=f*Math.log(1+Math.exp((d*(n-h)-a)/(2*l)))**2+1e-15,M=f*Math.log(1+Math.exp((d*(n-h)-o)/(2*l)))**2,S=u-M,L=S/u;return{I:S,IF:u,saturationLevel:L}};function Le(t){for(var s=t.length/6|0,e=new Array(s),i=0;i<s;)e[i]="#"+t.slice(i*6,++i*6);return e}function De(t){var s=t.length;return function(e){return t[Math.max(0,Math.min(s-1,Math.floor(e*s)))]}}De(Le("44015444025645045745055946075a46085c460a5d460b5e470d60470e6147106347116447136548146748166848176948186a481a6c481b6d481c6e481d6f481f70482071482173482374482475482576482677482878482979472a7a472c7a472d7b472e7c472f7d46307e46327e46337f463480453581453781453882443983443a83443b84433d84433e85423f854240864241864142874144874045884046883f47883f48893e49893e4a893e4c8a3d4d8a3d4e8a3c4f8a3c508b3b518b3b528b3a538b3a548c39558c39568c38588c38598c375a8c375b8d365c8d365d8d355e8d355f8d34608d34618d33628d33638d32648e32658e31668e31678e31688e30698e306a8e2f6b8e2f6c8e2e6d8e2e6e8e2e6f8e2d708e2d718e2c718e2c728e2c738e2b748e2b758e2a768e2a778e2a788e29798e297a8e297b8e287c8e287d8e277e8e277f8e27808e26818e26828e26828e25838e25848e25858e24868e24878e23888e23898e238a8d228b8d228c8d228d8d218e8d218f8d21908d21918c20928c20928c20938c1f948c1f958b1f968b1f978b1f988b1f998a1f9a8a1e9b8a1e9c891e9d891f9e891f9f881fa0881fa1881fa1871fa28720a38620a48621a58521a68522a78522a88423a98324aa8325ab8225ac8226ad8127ad8128ae8029af7f2ab07f2cb17e2db27d2eb37c2fb47c31b57b32b67a34b67935b77937b87838b9773aba763bbb753dbc743fbc7340bd7242be7144bf7046c06f48c16e4ac16d4cc26c4ec36b50c46a52c56954c56856c66758c7655ac8645cc8635ec96260ca6063cb5f65cb5e67cc5c69cd5b6ccd5a6ece5870cf5773d05675d05477d1537ad1517cd2507fd34e81d34d84d44b86d54989d5488bd6468ed64590d74393d74195d84098d83e9bd93c9dd93ba0da39a2da37a5db36a8db34aadc32addc30b0dd2fb2dd2db5de2bb8de29bade28bddf26c0df25c2df23c5e021c8e020cae11fcde11dd0e11cd2e21bd5e21ad8e219dae319dde318dfe318e2e418e5e419e7e419eae51aece51befe51cf1e51df4e61ef6e620f8e621fbe723fde725")),De(Le("00000401000501010601010802010902020b02020d03030f03031204041405041606051806051a07061c08071e0907200a08220b09240c09260d0a290e0b2b100b2d110c2f120d31130d34140e36150e38160f3b180f3d19103f1a10421c10441d11471e114920114b21114e22115024125325125527125829115a2a115c2c115f2d11612f116331116533106734106936106b38106c390f6e3b0f703d0f713f0f72400f74420f75440f764510774710784910784a10794c117a4e117b4f127b51127c52137c54137d56147d57157e59157e5a167e5c167f5d177f5f187f601880621980641a80651a80671b80681c816a1c816b1d816d1d816e1e81701f81721f817320817521817621817822817922827b23827c23827e24828025828125818326818426818627818827818928818b29818c29818e2a81902a81912b81932b80942c80962c80982d80992d809b2e7f9c2e7f9e2f7fa02f7fa1307ea3307ea5317ea6317da8327daa337dab337cad347cae347bb0357bb2357bb3367ab5367ab73779b83779ba3878bc3978bd3977bf3a77c03a76c23b75c43c75c53c74c73d73c83e73ca3e72cc3f71cd4071cf4070d0416fd2426fd3436ed5446dd6456cd8456cd9466bdb476adc4869de4968df4a68e04c67e24d66e34e65e44f64e55064e75263e85362e95462ea5661eb5760ec5860ed5a5fee5b5eef5d5ef05f5ef1605df2625df2645cf3655cf4675cf4695cf56b5cf66c5cf66e5cf7705cf7725cf8745cf8765cf9785df9795df97b5dfa7d5efa7f5efa815ffb835ffb8560fb8761fc8961fc8a62fc8c63fc8e64fc9065fd9266fd9467fd9668fd9869fd9a6afd9b6bfe9d6cfe9f6dfea16efea36ffea571fea772fea973feaa74feac76feae77feb078feb27afeb47bfeb67cfeb77efeb97ffebb81febd82febf84fec185fec287fec488fec68afec88cfeca8dfecc8ffecd90fecf92fed194fed395fed597fed799fed89afdda9cfddc9efddea0fde0a1fde2a3fde3a5fde5a7fde7a9fde9aafdebacfcecaefceeb0fcf0b2fcf2b4fcf4b6fcf6b8fcf7b9fcf9bbfcfbbdfcfdbf"));var Xi=De(Le("00000401000501010601010802010a02020c02020e03021004031204031405041706041907051b08051d09061f0a07220b07240c08260d08290e092b10092d110a30120a32140b34150b37160b39180c3c190c3e1b0c411c0c431e0c451f0c48210c4a230c4c240c4f260c51280b53290b552b0b572d0b592f0a5b310a5c320a5e340a5f3609613809623909633b09643d09653e0966400a67420a68440a68450a69470b6a490b6a4a0c6b4c0c6b4d0d6c4f0d6c510e6c520e6d540f6d550f6d57106e59106e5a116e5c126e5d126e5f136e61136e62146e64156e65156e67166e69166e6a176e6c186e6d186e6f196e71196e721a6e741a6e751b6e771c6d781c6d7a1d6d7c1d6d7d1e6d7f1e6c801f6c82206c84206b85216b87216b88226a8a226a8c23698d23698f24699025689225689326679526679727669827669a28659b29649d29649f2a63a02a63a22b62a32c61a52c60a62d60a82e5fa92e5eab2f5ead305dae305cb0315bb1325ab3325ab43359b63458b73557b93556ba3655bc3754bd3853bf3952c03a51c13a50c33b4fc43c4ec63d4dc73e4cc83f4bca404acb4149cc4248ce4347cf4446d04545d24644d34743d44842d54a41d74b3fd84c3ed94d3dda4e3cdb503bdd513ade5238df5337e05536e15635e25734e35933e45a31e55c30e65d2fe75e2ee8602de9612bea632aeb6429eb6628ec6726ed6925ee6a24ef6c23ef6e21f06f20f1711ff1731df2741cf3761bf37819f47918f57b17f57d15f67e14f68013f78212f78410f8850ff8870ef8890cf98b0bf98c0af98e09fa9008fa9207fa9407fb9606fb9706fb9906fb9b06fb9d07fc9f07fca108fca309fca50afca60cfca80dfcaa0ffcac11fcae12fcb014fcb216fcb418fbb61afbb81dfbba1ffbbc21fbbe23fac026fac228fac42afac62df9c72ff9c932f9cb35f8cd37f8cf3af7d13df7d340f6d543f6d746f5d949f5db4cf4dd4ff4df53f4e156f3e35af3e55df2e661f2e865f2ea69f1ec6df1ed71f1ef75f1f179f2f27df2f482f3f586f3f68af4f88ef5f992f6fa96f8fb9af9fc9dfafda1fcffa4"));De(Le("0d088710078813078916078a19068c1b068d1d068e20068f2206902406912605912805922a05932c05942e05952f059631059733059735049837049938049a3a049a3c049b3e049c3f049c41049d43039e44039e46039f48039f4903a04b03a14c02a14e02a25002a25102a35302a35502a45601a45801a45901a55b01a55c01a65e01a66001a66100a76300a76400a76600a76700a86900a86a00a86c00a86e00a86f00a87100a87201a87401a87501a87701a87801a87a02a87b02a87d03a87e03a88004a88104a78305a78405a78606a68707a68808a68a09a58b0aa58d0ba58e0ca48f0da4910ea3920fa39410a29511a19613a19814a099159f9a169f9c179e9d189d9e199da01a9ca11b9ba21d9aa31e9aa51f99a62098a72197a82296aa2395ab2494ac2694ad2793ae2892b02991b12a90b22b8fb32c8eb42e8db52f8cb6308bb7318ab83289ba3388bb3488bc3587bd3786be3885bf3984c03a83c13b82c23c81c33d80c43e7fc5407ec6417dc7427cc8437bc9447aca457acb4679cc4778cc4977cd4a76ce4b75cf4c74d04d73d14e72d24f71d35171d45270d5536fd5546ed6556dd7566cd8576bd9586ada5a6ada5b69db5c68dc5d67dd5e66de5f65de6164df6263e06363e16462e26561e26660e3685fe4695ee56a5de56b5de66c5ce76e5be76f5ae87059e97158e97257ea7457eb7556eb7655ec7754ed7953ed7a52ee7b51ef7c51ef7e50f07f4ff0804ef1814df1834cf2844bf3854bf3874af48849f48948f58b47f58c46f68d45f68f44f79044f79143f79342f89441f89540f9973ff9983ef99a3efa9b3dfa9c3cfa9e3bfb9f3afba139fba238fca338fca537fca636fca835fca934fdab33fdac33fdae32fdaf31fdb130fdb22ffdb42ffdb52efeb72dfeb82cfeba2cfebb2bfebd2afebe2afec029fdc229fdc328fdc527fdc627fdc827fdca26fdcb26fccd25fcce25fcd025fcd225fbd324fbd524fbd724fad824fada24f9dc24f9dd25f8df25f8e125f7e225f7e425f6e626f6e826f5e926f5eb27f4ed27f3ee27f3f027f2f227f1f426f1f525f0f724f0f921"));function ce(t,s,e){this.k=t,this.x=s,this.y=e}ce.prototype={constructor:ce,scale:function(t){return t===1?this:new ce(this.k*t,this.x,this.y)},translate:function(t,s){return t===0&s===0?this:new ce(this.k,this.x+this.k*t,this.y+this.k*s)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}},ce.prototype;class es{constructor(s=[]){c(this,"dotPath");c(this,"dotPercentage");c(this,"dotSize");c(this,"dotSpacing");c(this,"gradientSize");this.dotPath=s,this.dotPercentage=0,this.dotSize=8,this.dotSpacing=20,s.length==0?this.gradientSize=0:this.gradientSize=Math.sqrt((s[s.length-1].end.x-s[0].start.x)**2+(s[s.length-1].end.y-s[0].start.y)**2)/2}draw(s){const e=this.getMovingDotPositions(this.dotPath,this.dotSpacing).map(n=>({center:n,outerDiameter:this.dotSize})),i=s.createRadialGradient(0,0,0,0,0,this.gradientSize);i.addColorStop(0,"rgba(0, 0, 255, 1)"),i.addColorStop(1,"rgba(0, 0, 255, 0)"),Ji(s,e,this.dotSize/2,i)}updateDotPositionBasedOnTimestamp(s,e=10){const i=this.getDotSpeedFromCurrent(s);this.dotPercentage=$e(this.dotPercentage+i*(e/1e3),1)}getMovingDotPositions(s,e){const i=Gs(s),n=[],a=Math.floor(i/e);for(let o=0;o<a;o++){const l=(o+this.dotPercentage)/a,h=it(s,l);n.push(h)}return n}getDotSpeedFromCurrent(s){let n=1,a=!1;return s==0?0:(s<0&&(s=Math.abs(s),a=!0),s>1e-4?n=(Math.log10(s/1e-4)+1)**2*1:n=1/(1-Math.log10(s/1e-4))**2*1,n>5*1?n=5*1:n<.001*1&&(n=.001*1),a?-n:n)}}const $i=(t,s)=>Math.floor(t/s)*s,ss=(t,s,e=!1)=>{if(e)return Zi(t,s);const i=s-t;let n=10**Math.floor(Math.log10(i));const a=Math.floor(i/n);a>=5?n=n*5:a>=4?n=n*2:a<=2&&(n=n/2);let l=$i(t,n),h=[];for(;l<=s;)h.push(l),l=l+n;return h.push(l),h},Qi=t=>Math.abs(Math.round(t)-t)<.1?10**Math.round(3*t):5*10**Math.floor(3*t),Zi=(t,s)=>{t<=0&&console.error(`Lower bound, ${t} <= 0. Log will return NaN`);const e=Math.log10(t)/3,i=Math.log10(s)/3;return i-e<1?ss(t,s):ss(e,i).map(Qi)},We=(t,s,e)=>{if(e<=0)throw new Error("num must be a positive integer");if(e===1)return[t];const i=(s-t)/(e-1),n=[];for(let a=0;a<e;a++)n.push(t+i*a);return n},tn=w(!0),Qs=w(!1);w(!0);const Gt=w(2),Zs=w({width:1,height:1});w({width:1,height:1}),w({width:1,height:1});const Xt=typeof performance=="object"&&performance&&typeof performance.now=="function"?performance:Date,ti=new Set,is=typeof process=="object"&&process?process:{},ei=(t,s,e,i)=>{typeof is.emitWarning=="function"?is.emitWarning(t,s,e,i):console.error(`[${e}] ${s}: ${t}`)};let Oe=globalThis.AbortController,si=globalThis.AbortSignal;if(typeof Oe>"u"){si=class{constructor(){c(this,"onabort");c(this,"_onabort",[]);c(this,"reason");c(this,"aborted",!1)}addEventListener(i,n){this._onabort.push(n)}},Oe=class{constructor(){c(this,"signal",new si);s()}abort(i){var n,a;if(!this.signal.aborted){this.signal.reason=i,this.signal.aborted=!0;for(const o of this.signal._onabort)o(i);(a=(n=this.signal).onabort)==null||a.call(n,i)}}};let t=((li=is.env)==null?void 0:li.LRU_CACHE_IGNORE_AC_WARNING)!=="1";const s=()=>{t&&(t=!1,ei("AbortController is not defined. If using lru-cache in node 14, load an AbortController polyfill from the `node-abort-controller` package. A minimal polyfill is provided for use by LRUCache.fetch(), but it should not be relied upon in other contexts (eg, passing it to other APIs that use AbortController/AbortSignal might have undesirable effects). You may disable this with LRU_CACHE_IGNORE_AC_WARNING=1 in the env.","NO_ABORT_CONTROLLER","ENOTSUP",s))}}const en=t=>!ti.has(t),Ot=t=>t&&t===Math.floor(t)&&t>0&&isFinite(t),ii=t=>Ot(t)?t<=Math.pow(2,8)?Uint8Array:t<=Math.pow(2,16)?Uint16Array:t<=Math.pow(2,32)?Uint32Array:t<=Number.MAX_SAFE_INTEGER?Ee:null:null;class Ee extends Array{constructor(s){super(s),this.fill(0)}}const Bt=class Bt{constructor(s,e){c(this,"heap");c(this,"length");if(!r(Bt,Zt))throw new TypeError("instantiate Stack using Stack.create(n)");this.heap=new e(s),this.length=0}static create(s){const e=ii(s);if(!e)return[];p(Bt,Zt,!0);const i=new Bt(s,e);return p(Bt,Zt,!1),i}push(s){this.heap[this.length++]=s}pop(){return this.heap[--this.length]}};Zt=new WeakMap,V(Bt,Zt,!1);let ns=Bt;const rs=class rs{constructor(s){V(this,he);V(this,Fe);V(this,St);V(this,Tt);V(this,ue);V(this,ie);V(this,ne);V(this,z);V(this,ge);V(this,qt);V(this,_t);V(this,me);V(this,mt,void 0);V(this,rt,void 0);V(this,vt,void 0);V(this,yt,void 0);V(this,te,void 0);V(this,ee,void 0);c(this,"ttl");c(this,"ttlResolution");c(this,"ttlAutopurge");c(this,"updateAgeOnGet");c(this,"updateAgeOnHas");c(this,"allowStale");c(this,"noDisposeOnSet");c(this,"noUpdateTTL");c(this,"maxEntrySize");c(this,"sizeCalculation");c(this,"noDeleteOnFetchRejection");c(this,"noDeleteOnStaleGet");c(this,"allowStaleOnFetchAbort");c(this,"allowStaleOnFetchRejection");c(this,"ignoreFetchAbort");V(this,K,void 0);V(this,pt,void 0);V(this,U,void 0);V(this,k,void 0);V(this,x,void 0);V(this,et,void 0);V(this,lt,void 0);V(this,tt,void 0);V(this,J,void 0);V(this,bt,void 0);V(this,X,void 0);V(this,wt,void 0);V(this,Mt,void 0);V(this,ct,void 0);V(this,xt,void 0);V(this,Et,void 0);V(this,st,void 0);V(this,Ut,()=>{});V(this,Ct,()=>{});V(this,de,()=>{});V(this,ht,()=>!1);V(this,Ht,s=>{});V(this,se,(s,e,i)=>{});V(this,fe,(s,e,i,n)=>{if(i||n)throw new TypeError("cannot set size without setting maxSize or maxEntrySize on cache");return 0});c(this,un,"LRUCache");const{max:e=0,ttl:i,ttlResolution:n=1,ttlAutopurge:a,updateAgeOnGet:o,updateAgeOnHas:l,allowStale:h,dispose:d,disposeAfter:f,noDisposeOnSet:u,noUpdateTTL:M,maxSize:S=0,maxEntrySize:L=0,sizeCalculation:W,fetchMethod:_,memoMethod:y,noDeleteOnFetchRejection:O,noDeleteOnStaleGet:Y,allowStaleOnFetchRejection:B,allowStaleOnFetchAbort:at,ignoreFetchAbort:Kt}=s;if(e!==0&&!Ot(e))throw new TypeError("max option must be a nonnegative integer");const At=e?ii(e):Array;if(!At)throw new Error("invalid max value: "+e);if(p(this,mt,e),p(this,rt,S),this.maxEntrySize=L||r(this,rt),this.sizeCalculation=W,this.sizeCalculation){if(!r(this,rt)&&!this.maxEntrySize)throw new TypeError("cannot set sizeCalculation without setting maxSize or maxEntrySize");if(typeof this.sizeCalculation!="function")throw new TypeError("sizeCalculation set to non-function")}if(y!==void 0&&typeof y!="function")throw new TypeError("memoMethod must be a function if defined");if(p(this,ee,y),_!==void 0&&typeof _!="function")throw new TypeError("fetchMethod must be a function if specified");if(p(this,te,_),p(this,Et,!!_),p(this,U,new Map),p(this,k,new Array(e).fill(void 0)),p(this,x,new Array(e).fill(void 0)),p(this,et,new At(e)),p(this,lt,new At(e)),p(this,tt,0),p(this,J,0),p(this,bt,ns.create(e)),p(this,K,0),p(this,pt,0),typeof d=="function"&&p(this,vt,d),typeof f=="function"?(p(this,yt,f),p(this,X,[])):(p(this,yt,void 0),p(this,X,void 0)),p(this,xt,!!r(this,vt)),p(this,st,!!r(this,yt)),this.noDisposeOnSet=!!u,this.noUpdateTTL=!!M,this.noDeleteOnFetchRejection=!!O,this.allowStaleOnFetchRejection=!!B,this.allowStaleOnFetchAbort=!!at,this.ignoreFetchAbort=!!Kt,this.maxEntrySize!==0){if(r(this,rt)!==0&&!Ot(r(this,rt)))throw new TypeError("maxSize must be a positive integer if specified");if(!Ot(this.maxEntrySize))throw new TypeError("maxEntrySize must be a positive integer if specified");m(this,Fe,hi).call(this)}if(this.allowStale=!!h,this.noDeleteOnStaleGet=!!Y,this.updateAgeOnGet=!!o,this.updateAgeOnHas=!!l,this.ttlResolution=Ot(n)||n===0?n:1,this.ttlAutopurge=!!a,this.ttl=i||0,this.ttl){if(!Ot(this.ttl))throw new TypeError("ttl must be a positive integer if specified");m(this,he,cs).call(this)}if(r(this,mt)===0&&this.ttl===0&&r(this,rt)===0)throw new TypeError("At least one of max, maxSize, or ttl is required");if(!this.ttlAutopurge&&!r(this,mt)&&!r(this,rt)){const ae="LRU_CACHE_UNBOUNDED";en(ae)&&(ti.add(ae),ei("TTL caching without ttlAutopurge, max, or maxSize can result in unbounded memory consumption.","UnboundedCacheWarning",ae,rs))}}static unsafeExposeInternals(s){return{starts:r(s,Mt),ttls:r(s,ct),sizes:r(s,wt),keyMap:r(s,U),keyList:r(s,k),valList:r(s,x),next:r(s,et),prev:r(s,lt),get head(){return r(s,tt)},get tail(){return r(s,J)},free:r(s,bt),isBackgroundFetch:e=>{var i;return m(i=s,z,I).call(i,e)},backgroundFetch:(e,i,n,a)=>{var o;return m(o=s,ne,je).call(o,e,i,n,a)},moveToTail:e=>{var i;return m(i=s,qt,ve).call(i,e)},indexes:e=>{var i;return m(i=s,St,zt).call(i,e)},rindexes:e=>{var i;return m(i=s,Tt,Rt).call(i,e)},isStale:e=>{var i;return r(i=s,ht).call(i,e)}}}get max(){return r(this,mt)}get maxSize(){return r(this,rt)}get calculatedSize(){return r(this,pt)}get size(){return r(this,K)}get fetchMethod(){return r(this,te)}get memoMethod(){return r(this,ee)}get dispose(){return r(this,vt)}get disposeAfter(){return r(this,yt)}getRemainingTTL(s){return r(this,U).has(s)?1/0:0}*entries(){for(const s of m(this,St,zt).call(this))r(this,x)[s]!==void 0&&r(this,k)[s]!==void 0&&!m(this,z,I).call(this,r(this,x)[s])&&(yield[r(this,k)[s],r(this,x)[s]])}*rentries(){for(const s of m(this,Tt,Rt).call(this))r(this,x)[s]!==void 0&&r(this,k)[s]!==void 0&&!m(this,z,I).call(this,r(this,x)[s])&&(yield[r(this,k)[s],r(this,x)[s]])}*keys(){for(const s of m(this,St,zt).call(this)){const e=r(this,k)[s];e!==void 0&&!m(this,z,I).call(this,r(this,x)[s])&&(yield e)}}*rkeys(){for(const s of m(this,Tt,Rt).call(this)){const e=r(this,k)[s];e!==void 0&&!m(this,z,I).call(this,r(this,x)[s])&&(yield e)}}*values(){for(const s of m(this,St,zt).call(this))r(this,x)[s]!==void 0&&!m(this,z,I).call(this,r(this,x)[s])&&(yield r(this,x)[s])}*rvalues(){for(const s of m(this,Tt,Rt).call(this))r(this,x)[s]!==void 0&&!m(this,z,I).call(this,r(this,x)[s])&&(yield r(this,x)[s])}[Symbol.iterator](){return this.entries()}find(s,e={}){for(const i of m(this,St,zt).call(this)){const n=r(this,x)[i],a=m(this,z,I).call(this,n)?n.__staleWhileFetching:n;if(a!==void 0&&s(a,r(this,k)[i],this))return this.get(r(this,k)[i],e)}}forEach(s,e=this){for(const i of m(this,St,zt).call(this)){const n=r(this,x)[i],a=m(this,z,I).call(this,n)?n.__staleWhileFetching:n;a!==void 0&&s.call(e,a,r(this,k)[i],this)}}rforEach(s,e=this){for(const i of m(this,Tt,Rt).call(this)){const n=r(this,x)[i],a=m(this,z,I).call(this,n)?n.__staleWhileFetching:n;a!==void 0&&s.call(e,a,r(this,k)[i],this)}}purgeStale(){let s=!1;for(const e of m(this,Tt,Rt).call(this,{allowStale:!0}))r(this,ht).call(this,e)&&(m(this,_t,Ft).call(this,r(this,k)[e],"expire"),s=!0);return s}info(s){const e=r(this,U).get(s);if(e===void 0)return;const i=r(this,x)[e],n=m(this,z,I).call(this,i)?i.__staleWhileFetching:i;if(n===void 0)return;const a={value:n};if(r(this,ct)&&r(this,Mt)){const o=r(this,ct)[e],l=r(this,Mt)[e];if(o&&l){const h=o-(Xt.now()-l);a.ttl=h,a.start=Date.now()}}return r(this,wt)&&(a.size=r(this,wt)[e]),a}dump(){const s=[];for(const e of m(this,St,zt).call(this,{allowStale:!0})){const i=r(this,k)[e],n=r(this,x)[e],a=m(this,z,I).call(this,n)?n.__staleWhileFetching:n;if(a===void 0||i===void 0)continue;const o={value:a};if(r(this,ct)&&r(this,Mt)){o.ttl=r(this,ct)[e];const l=Xt.now()-r(this,Mt)[e];o.start=Math.floor(Date.now()-l)}r(this,wt)&&(o.size=r(this,wt)[e]),s.unshift([i,o])}return s}load(s){this.clear();for(const[e,i]of s){if(i.start){const n=Date.now()-i.start;i.start=Xt.now()-n}this.set(e,i.value,i)}}set(s,e,i={}){var M,S,L,W,_;if(e===void 0)return this.delete(s),this;const{ttl:n=this.ttl,start:a,noDisposeOnSet:o=this.noDisposeOnSet,sizeCalculation:l=this.sizeCalculation,status:h}=i;let{noUpdateTTL:d=this.noUpdateTTL}=i;const f=r(this,fe).call(this,s,e,i.size||0,l);if(this.maxEntrySize&&f>this.maxEntrySize)return h&&(h.set="miss",h.maxEntrySizeExceeded=!0),m(this,_t,Ft).call(this,s,"set"),this;let u=r(this,K)===0?void 0:r(this,U).get(s);if(u===void 0)u=r(this,K)===0?r(this,J):r(this,bt).length!==0?r(this,bt).pop():r(this,K)===r(this,mt)?m(this,ie,Ne).call(this,!1):r(this,K),r(this,k)[u]=s,r(this,x)[u]=e,r(this,U).set(s,u),r(this,et)[r(this,J)]=u,r(this,lt)[u]=r(this,J),p(this,J,u),Ie(this,K)._++,r(this,se).call(this,u,f,h),h&&(h.set="add"),d=!1;else{m(this,qt,ve).call(this,u);const y=r(this,x)[u];if(e!==y){if(r(this,Et)&&m(this,z,I).call(this,y)){y.__abortController.abort(new Error("replaced"));const{__staleWhileFetching:O}=y;O!==void 0&&!o&&(r(this,xt)&&((M=r(this,vt))==null||M.call(this,O,s,"set")),r(this,st)&&((S=r(this,X))==null||S.push([O,s,"set"])))}else o||(r(this,xt)&&((L=r(this,vt))==null||L.call(this,y,s,"set")),r(this,st)&&((W=r(this,X))==null||W.push([y,s,"set"])));if(r(this,Ht).call(this,u),r(this,se).call(this,u,f,h),r(this,x)[u]=e,h){h.set="replace";const O=y&&m(this,z,I).call(this,y)?y.__staleWhileFetching:y;O!==void 0&&(h.oldValue=O)}}else h&&(h.set="update")}if(n!==0&&!r(this,ct)&&m(this,he,cs).call(this),r(this,ct)&&(d||r(this,de).call(this,u,n,a),h&&r(this,Ct).call(this,h,u)),!o&&r(this,st)&&r(this,X)){const y=r(this,X);let O;for(;O=y==null?void 0:y.shift();)(_=r(this,yt))==null||_.call(this,...O)}return this}pop(){var s;try{for(;r(this,K);){const e=r(this,x)[r(this,tt)];if(m(this,ie,Ne).call(this,!0),m(this,z,I).call(this,e)){if(e.__staleWhileFetching)return e.__staleWhileFetching}else if(e!==void 0)return e}}finally{if(r(this,st)&&r(this,X)){const e=r(this,X);let i;for(;i=e==null?void 0:e.shift();)(s=r(this,yt))==null||s.call(this,...i)}}}has(s,e={}){const{updateAgeOnHas:i=this.updateAgeOnHas,status:n}=e,a=r(this,U).get(s);if(a!==void 0){const o=r(this,x)[a];if(m(this,z,I).call(this,o)&&o.__staleWhileFetching===void 0)return!1;if(r(this,ht).call(this,a))n&&(n.has="stale",r(this,Ct).call(this,n,a));else return i&&r(this,Ut).call(this,a),n&&(n.has="hit",r(this,Ct).call(this,n,a)),!0}else n&&(n.has="miss");return!1}peek(s,e={}){const{allowStale:i=this.allowStale}=e,n=r(this,U).get(s);if(n===void 0||!i&&r(this,ht).call(this,n))return;const a=r(this,x)[n];return m(this,z,I).call(this,a)?a.__staleWhileFetching:a}async fetch(s,e={}){const{allowStale:i=this.allowStale,updateAgeOnGet:n=this.updateAgeOnGet,noDeleteOnStaleGet:a=this.noDeleteOnStaleGet,ttl:o=this.ttl,noDisposeOnSet:l=this.noDisposeOnSet,size:h=0,sizeCalculation:d=this.sizeCalculation,noUpdateTTL:f=this.noUpdateTTL,noDeleteOnFetchRejection:u=this.noDeleteOnFetchRejection,allowStaleOnFetchRejection:M=this.allowStaleOnFetchRejection,ignoreFetchAbort:S=this.ignoreFetchAbort,allowStaleOnFetchAbort:L=this.allowStaleOnFetchAbort,context:W,forceRefresh:_=!1,status:y,signal:O}=e;if(!r(this,Et))return y&&(y.fetch="get"),this.get(s,{allowStale:i,updateAgeOnGet:n,noDeleteOnStaleGet:a,status:y});const Y={allowStale:i,updateAgeOnGet:n,noDeleteOnStaleGet:a,ttl:o,noDisposeOnSet:l,size:h,sizeCalculation:d,noUpdateTTL:f,noDeleteOnFetchRejection:u,allowStaleOnFetchRejection:M,allowStaleOnFetchAbort:L,ignoreFetchAbort:S,status:y,signal:O};let B=r(this,U).get(s);if(B===void 0){y&&(y.fetch="miss");const at=m(this,ne,je).call(this,s,B,Y,W);return at.__returned=at}else{const at=r(this,x)[B];if(m(this,z,I).call(this,at)){const ci=i&&at.__staleWhileFetching!==void 0;return y&&(y.fetch="inflight",ci&&(y.returnedStale=!0)),ci?at.__staleWhileFetching:at.__returned=at}const Kt=r(this,ht).call(this,B);if(!_&&!Kt)return y&&(y.fetch="hit"),m(this,qt,ve).call(this,B),n&&r(this,Ut).call(this,B),y&&r(this,Ct).call(this,y,B),at;const At=m(this,ne,je).call(this,s,B,Y,W),ke=At.__staleWhileFetching!==void 0&&i;return y&&(y.fetch=Kt?"stale":"refresh",ke&&Kt&&(y.returnedStale=!0)),ke?At.__staleWhileFetching:At.__returned=At}}async forceFetch(s,e={}){const i=await this.fetch(s,e);if(i===void 0)throw new Error("fetch() returned undefined");return i}memo(s,e={}){const i=r(this,ee);if(!i)throw new Error("no memoMethod provided to constructor");const{context:n,forceRefresh:a,...o}=e,l=this.get(s,o);if(!a&&l!==void 0)return l;const h=i(s,l,{options:o,context:n});return this.set(s,h,o),h}get(s,e={}){const{allowStale:i=this.allowStale,updateAgeOnGet:n=this.updateAgeOnGet,noDeleteOnStaleGet:a=this.noDeleteOnStaleGet,status:o}=e,l=r(this,U).get(s);if(l!==void 0){const h=r(this,x)[l],d=m(this,z,I).call(this,h);return o&&r(this,Ct).call(this,o,l),r(this,ht).call(this,l)?(o&&(o.get="stale"),d?(o&&i&&h.__staleWhileFetching!==void 0&&(o.returnedStale=!0),i?h.__staleWhileFetching:void 0):(a||m(this,_t,Ft).call(this,s,"expire"),o&&i&&(o.returnedStale=!0),i?h:void 0)):(o&&(o.get="hit"),d?h.__staleWhileFetching:(m(this,qt,ve).call(this,l),n&&r(this,Ut).call(this,l),h))}else o&&(o.get="miss")}delete(s){return m(this,_t,Ft).call(this,s,"delete")}clear(){return m(this,me,fs).call(this,"delete")}};un=Symbol.toStringTag,mt=new WeakMap,rt=new WeakMap,vt=new WeakMap,yt=new WeakMap,te=new WeakMap,ee=new WeakMap,K=new WeakMap,pt=new WeakMap,U=new WeakMap,k=new WeakMap,x=new WeakMap,et=new WeakMap,lt=new WeakMap,tt=new WeakMap,J=new WeakMap,bt=new WeakMap,X=new WeakMap,wt=new WeakMap,Mt=new WeakMap,ct=new WeakMap,xt=new WeakMap,Et=new WeakMap,st=new WeakMap,he=new WeakSet,cs=function(){const s=new Ee(r(this,mt)),e=new Ee(r(this,mt));p(this,ct,s),p(this,Mt,e),p(this,de,(a,o,l=Xt.now())=>{if(e[a]=o!==0?l:0,s[a]=o,o!==0&&this.ttlAutopurge){const h=setTimeout(()=>{r(this,ht).call(this,a)&&m(this,_t,Ft).call(this,r(this,k)[a],"expire")},o+1);h.unref&&h.unref()}}),p(this,Ut,a=>{e[a]=s[a]!==0?Xt.now():0}),p(this,Ct,(a,o)=>{if(s[o]){const l=s[o],h=e[o];if(!l||!h)return;a.ttl=l,a.start=h,a.now=i||n();const d=a.now-h;a.remainingTTL=l-d}});let i=0;const n=()=>{const a=Xt.now();if(this.ttlResolution>0){i=a;const o=setTimeout(()=>i=0,this.ttlResolution);o.unref&&o.unref()}return a};this.getRemainingTTL=a=>{const o=r(this,U).get(a);if(o===void 0)return 0;const l=s[o],h=e[o];if(!l||!h)return 1/0;const d=(i||n())-h;return l-d},p(this,ht,a=>{const o=e[a],l=s[a];return!!l&&!!o&&(i||n())-o>l})},Ut=new WeakMap,Ct=new WeakMap,de=new WeakMap,ht=new WeakMap,Fe=new WeakSet,hi=function(){const s=new Ee(r(this,mt));p(this,pt,0),p(this,wt,s),p(this,Ht,e=>{p(this,pt,r(this,pt)-s[e]),s[e]=0}),p(this,fe,(e,i,n,a)=>{if(m(this,z,I).call(this,i))return 0;if(!Ot(n))if(a){if(typeof a!="function")throw new TypeError("sizeCalculation must be a function");if(n=a(i,e),!Ot(n))throw new TypeError("sizeCalculation return invalid (expect positive integer)")}else throw new TypeError("invalid size value (must be positive integer). When maxSize or maxEntrySize is used, sizeCalculation or size must be set.");return n}),p(this,se,(e,i,n)=>{if(s[e]=i,r(this,rt)){const a=r(this,rt)-s[e];for(;r(this,pt)>a;)m(this,ie,Ne).call(this,!0)}p(this,pt,r(this,pt)+s[e]),n&&(n.entrySize=i,n.totalCalculatedSize=r(this,pt))})},Ht=new WeakMap,se=new WeakMap,fe=new WeakMap,St=new WeakSet,zt=function*({allowStale:s=this.allowStale}={}){if(r(this,K))for(let e=r(this,J);!(!m(this,ue,hs).call(this,e)||((s||!r(this,ht).call(this,e))&&(yield e),e===r(this,tt)));)e=r(this,lt)[e]},Tt=new WeakSet,Rt=function*({allowStale:s=this.allowStale}={}){if(r(this,K))for(let e=r(this,tt);!(!m(this,ue,hs).call(this,e)||((s||!r(this,ht).call(this,e))&&(yield e),e===r(this,J)));)e=r(this,et)[e]},ue=new WeakSet,hs=function(s){return s!==void 0&&r(this,U).get(r(this,k)[s])===s},ie=new WeakSet,Ne=function(s){var a,o;const e=r(this,tt),i=r(this,k)[e],n=r(this,x)[e];return r(this,Et)&&m(this,z,I).call(this,n)?n.__abortController.abort(new Error("evicted")):(r(this,xt)||r(this,st))&&(r(this,xt)&&((a=r(this,vt))==null||a.call(this,n,i,"evict")),r(this,st)&&((o=r(this,X))==null||o.push([n,i,"evict"]))),r(this,Ht).call(this,e),s&&(r(this,k)[e]=void 0,r(this,x)[e]=void 0,r(this,bt).push(e)),r(this,K)===1?(p(this,tt,p(this,J,0)),r(this,bt).length=0):p(this,tt,r(this,et)[e]),r(this,U).delete(i),Ie(this,K)._--,e},ne=new WeakSet,je=function(s,e,i,n){const a=e===void 0?void 0:r(this,x)[e];if(m(this,z,I).call(this,a))return a;const o=new Oe,{signal:l}=i;l==null||l.addEventListener("abort",()=>o.abort(l.reason),{signal:o.signal});const h={signal:o.signal,options:i,context:n},d=(W,_=!1)=>{const{aborted:y}=o.signal,O=i.ignoreFetchAbort&&W!==void 0;if(i.status&&(y&&!_?(i.status.fetchAborted=!0,i.status.fetchError=o.signal.reason,O&&(i.status.fetchAbortIgnored=!0)):i.status.fetchResolved=!0),y&&!O&&!_)return u(o.signal.reason);const Y=S;return r(this,x)[e]===S&&(W===void 0?Y.__staleWhileFetching?r(this,x)[e]=Y.__staleWhileFetching:m(this,_t,Ft).call(this,s,"fetch"):(i.status&&(i.status.fetchUpdated=!0),this.set(s,W,h.options))),W},f=W=>(i.status&&(i.status.fetchRejected=!0,i.status.fetchError=W),u(W)),u=W=>{const{aborted:_}=o.signal,y=_&&i.allowStaleOnFetchAbort,O=y||i.allowStaleOnFetchRejection,Y=O||i.noDeleteOnFetchRejection,B=S;if(r(this,x)[e]===S&&(!Y||B.__staleWhileFetching===void 0?m(this,_t,Ft).call(this,s,"fetch"):y||(r(this,x)[e]=B.__staleWhileFetching)),O)return i.status&&B.__staleWhileFetching!==void 0&&(i.status.returnedStale=!0),B.__staleWhileFetching;if(B.__returned===B)throw W},M=(W,_)=>{var O;const y=(O=r(this,te))==null?void 0:O.call(this,s,a,h);y&&y instanceof Promise&&y.then(Y=>W(Y===void 0?void 0:Y),_),o.signal.addEventListener("abort",()=>{(!i.ignoreFetchAbort||i.allowStaleOnFetchAbort)&&(W(void 0),i.allowStaleOnFetchAbort&&(W=Y=>d(Y,!0)))})};i.status&&(i.status.fetchDispatched=!0);const S=new Promise(M).then(d,f),L=Object.assign(S,{__abortController:o,__staleWhileFetching:a,__returned:void 0});return e===void 0?(this.set(s,L,{...h.options,status:void 0}),e=r(this,U).get(s)):r(this,x)[e]=L,L},z=new WeakSet,I=function(s){if(!r(this,Et))return!1;const e=s;return!!e&&e instanceof Promise&&e.hasOwnProperty("__staleWhileFetching")&&e.__abortController instanceof Oe},ge=new WeakSet,ds=function(s,e){r(this,lt)[e]=s,r(this,et)[s]=e},qt=new WeakSet,ve=function(s){s!==r(this,J)&&(s===r(this,tt)?p(this,tt,r(this,et)[s]):m(this,ge,ds).call(this,r(this,lt)[s],r(this,et)[s]),m(this,ge,ds).call(this,r(this,J),s),p(this,J,s))},_t=new WeakSet,Ft=function(s,e){var n,a,o,l;let i=!1;if(r(this,K)!==0){const h=r(this,U).get(s);if(h!==void 0)if(i=!0,r(this,K)===1)m(this,me,fs).call(this,e);else{r(this,Ht).call(this,h);const d=r(this,x)[h];if(m(this,z,I).call(this,d)?d.__abortController.abort(new Error("deleted")):(r(this,xt)||r(this,st))&&(r(this,xt)&&((n=r(this,vt))==null||n.call(this,d,s,e)),r(this,st)&&((a=r(this,X))==null||a.push([d,s,e]))),r(this,U).delete(s),r(this,k)[h]=void 0,r(this,x)[h]=void 0,h===r(this,J))p(this,J,r(this,lt)[h]);else if(h===r(this,tt))p(this,tt,r(this,et)[h]);else{const f=r(this,lt)[h];r(this,et)[f]=r(this,et)[h];const u=r(this,et)[h];r(this,lt)[u]=r(this,lt)[h]}Ie(this,K)._--,r(this,bt).push(h)}}if(r(this,st)&&((o=r(this,X))!=null&&o.length)){const h=r(this,X);let d;for(;d=h==null?void 0:h.shift();)(l=r(this,yt))==null||l.call(this,...d)}return i},me=new WeakSet,fs=function(s){var e,i,n;for(const a of m(this,Tt,Rt).call(this,{allowStale:!0})){const o=r(this,x)[a];if(m(this,z,I).call(this,o))o.__abortController.abort(new Error("deleted"));else{const l=r(this,k)[a];r(this,xt)&&((e=r(this,vt))==null||e.call(this,o,l,s)),r(this,st)&&((i=r(this,X))==null||i.push([o,l,s]))}}if(r(this,U).clear(),r(this,x).fill(void 0),r(this,k).fill(void 0),r(this,ct)&&r(this,Mt)&&(r(this,ct).fill(0),r(this,Mt).fill(0)),r(this,wt)&&r(this,wt).fill(0),p(this,tt,0),p(this,J,0),r(this,bt).length=0,p(this,pt,0),p(this,K,0),r(this,st)&&r(this,X)){const a=r(this,X);let o;for(;o=a==null?void 0:a.shift();)(n=r(this,yt))==null||n.call(this,...o)}};let as=rs;const Q=class Q extends Xs{constructor(e=[],i,n,a,o,l,h,d,f,u,M=5,S="x Var",L="y Var",W="xUnit",_="yUnit",y="linear",O="log",Y=250,B=200,at="visible",Kt="main"){const At=u,ae=n=="Vgs"?l:d;super(e,new P().translate({x:a,y:o}),At,ae,"toNode",0,M,"hidden",at,Kt);c(this,"points");c(this,"xAxisLabel");c(this,"yAxisLabel");c(this,"xUnit");c(this,"yUnit");c(this,"width");c(this,"height");c(this,"axesWidth");c(this,"axesHeight");c(this,"cornerToCornerGraph",!0);c(this,"plottingValues",[]);c(this,"yValue",0);c(this,"pointsCache",new as({max:1e3}));c(this,"cacheAttempts",0);c(this,"cacheHits",0);c(this,"memoize",!1);c(this,"Vg");c(this,"Vs");c(this,"Vd");c(this,"Vb");c(this,"mosfetType");c(this,"chartType");c(this,"originalMaxValue");c(this,"xScaleType");c(this,"yScaleType");c(this,"yMin",0);c(this,"yMax",0);c(this,"xTicks",[]);c(this,"yTicks",[]);c(this,"xScale",0);c(this,"yScale",0);c(this,"boundingBox");this.transformationMatrix.isMirrored&&this.transformations[this.transformations.length-1].value.mirror(!0,!1,!0),this.transformations[this.transformations.length-1].value.rotate(-this.transformationMatrix.rotation,!0),this.transformations[this.transformations.length-1].value.mirror(!1,!0,!0),n=="Vgs"?this.transformations[this.transformations.length-1].value.translate({x:-Y/2,y:0},!0):this.transformations[this.transformations.length-1].value.translate({x:-Y/2,y:-B},!0),this.transformations[this.transformations.length-1].value.translate({x:Q.paddingL,y:Q.paddingB},!0),this.points=[],this.xAxisLabel=S,this.yAxisLabel=L,this.xUnit=W,this.yUnit=_,this.xScaleType=y,this.yScaleType=O,this.width=Y,this.height=B,this.axesWidth=Y-Q.paddingL-Q.paddingR,this.axesHeight=B-Q.paddingT-Q.paddingB,this.Vg=l,this.Vs=h,this.Vd=d,this.Vb=f,this.mosfetType=i,this.chartType=n,this.originalMaxValue=M,this.temporaryMinValue=this.minValue,this.temporaryMaxValue=this.maxValue,this.boundingBox=[new b(this.transformations,{x:-100,y:0}),new b(this.transformations,{x:100,y:0}),new b(this.transformations,{x:0,y:-100}),new b(this.transformations,{x:0,y:100})]}copy(e,i="main"){return new Q([e],this.mosfetType,this.chartType,0,0,this.Vg,this.Vs,this.Vd,this.Vb,this.fromNode,this.maxValue,this.xAxisLabel,this.yAxisLabel,this.xUnit,this.yUnit,this.xScaleType,this.yScaleType,this.width,this.height,this.visibility,i)}draw(e){if(this.visibility=="hidden")return;this.transformationMatrix.transformCanvas(e);const i=this.localLineThickness/2,n=this.localLineThickness/4;this.chartType=="Vgs"?this.sweepGateVoltages():this.sweepDrainVoltages(),this.preciseDragging?this.xTicks=ss(this.temporaryMinValue,this.temporaryMaxValue,this.xScaleType=="log").filter(f=>f>=this.temporaryMinValue&&f<=this.temporaryMaxValue):this.xTicks=[0,1,2,3,4,5],this.chartType=="Vgs"?this.yTicks=[.001,1e-6,1e-9,1e-12].filter(f=>f>=this.yMin&&f<=this.yMax):this.yTicks=[25,50,75,100].filter(f=>f>=this.yMin&&f<=this.yMax);const a=this.xValueToLocation(this.value),o=(this.temporaryMaxValue-this.temporaryMinValue)/4;this.xTicks=this.xTicks.filter(f=>!(this.value-o/2<f&&f<this.value+o/2)),this.plottingValues=this.points.map(f=>({x:this.xValueToLocation(f.x),y:this.yValueToLocation(f.y)})),e.clearRect(-Q.paddingL,-Q.paddingB,this.width,this.height),e.strokeStyle="#000",Vt(e,[{start:{x:0,y:0},end:{x:this.axesWidth,y:0}},{start:{x:0,y:0},end:{x:0,y:this.axesHeight}}],i,"black"),e.font="16px Arial",e.textAlign="center";let l=this.fillTextGlobalReferenceFrame(e,{x:a,y:-16},this.xAxisLabel,!1);e.font="12px Arial",this.fillTextGlobalReferenceFrame(e,{x:l.x,y:l.y+3},jt(this.value,"V"),!1),e.font="18px Arial",this.fillTextGlobalReferenceFrame(e,{x:-30,y:this.axesHeight+6},this.yAxisLabel,!0,!0),e.strokeStyle="#ccc",e.font="12px Arial",e.fillStyle="#000",e.textAlign="center",this.xTicks.forEach(f=>{const u=this.xValueToLocation(f),M=jt(f,this.xUnit);Vt(e,[{start:{x:u,y:0},end:{x:u,y:-5}}],n,"black"),this.fillTextGlobalReferenceFrame(e,{x:u,y:-18},M)}),this.yTicks.forEach(f=>{const u=this.yValueToLocation(f),M=jt(f,this.yUnit);Vt(e,[{start:{x:0,y:u},end:{x:-5,y:u}}],n,"black"),this.fillTextGlobalReferenceFrame(e,{x:-25,y:u-6},M)}),e.strokeStyle="#f00",e.lineWidth=i,e.beginPath(),this.plottingValues.forEach((f,u)=>{u===0?e.moveTo(f.x,f.y):e.lineTo(f.x,f.y)}),e.stroke(),e.lineWidth=n,this.updateLocationBasedOnValue(),e.beginPath(),e.arc(this.location.x,this.location.y,5,0,2*Math.PI),e.fill(),e.moveTo(this.location.x,0),e.lineTo(this.location.x,this.location.y),e.stroke();const h=jt(this.yValue,this.yUnit),d=h.length*5;this.fillTextGlobalReferenceFrame(e,{x:this.location.x<this.axesWidth-d?Math.max(5,this.location.x+d):this.location.x-d,y:Math.max(5,this.location.y-15)},h),Qs.value&&(e.lineWidth=5,e.strokeStyle="black",e.strokeRect(-Q.paddingL,-Q.paddingB,this.width,this.height))}sweepGateVoltages(e=this.width/3){if(this.yMin=1/0,this.yMax=-1/0,We(this.minValue,this.maxValue,5).forEach(o=>{const l=this.getMosfetCurrentFromGateVoltage(o);this.yMin=Math.min(this.yMin,l),this.yMax=Math.max(this.yMax,l)}),this.memoize){this.cacheAttempts+=1;const o=this.pointsCache.get(this.discretizeArgsForCache(this.temporaryMinValue,this.temporaryMaxValue,this.Vs.value.voltage,this.Vd.value.voltage,this.Vb.value.voltage));if(o!==void 0){this.points=o,this.cacheHits+=1;return}}this.points=[];let n={x:0,y:0};We(this.temporaryMinValue,this.temporaryMaxValue,e).forEach(o=>{n={x:o,y:this.getMosfetCurrentFromGateVoltage(o)},this.points.push(n)}),this.memoize&&this.pointsCache.set(this.discretizeArgsForCache(this.temporaryMinValue,this.temporaryMaxValue,this.Vs.value.voltage,this.Vd.value.voltage,this.Vb.value.voltage),this.points)}sweepDrainVoltages(e=this.width/3){if(this.points=[],this.yMin=1/0,this.yMax=-1/0,We(this.minValue,this.maxValue,5).forEach(o=>{let l=this.getMosfetSaturationFromDrainVoltage(o);l<0&&(l=0),this.yMax=Math.max(this.yMax,l)}),this.yMin=0,this.memoize){this.cacheAttempts+=1;const o=this.pointsCache.get(this.discretizeArgsForCache(this.temporaryMinValue,this.temporaryMaxValue,this.Vg.value.voltage,this.Vs.value.voltage,this.Vb.value.voltage));if(o!==void 0){this.points=o,this.cacheHits+=1;return}}const n=We(this.temporaryMinValue,this.temporaryMaxValue,e);let a={x:0,y:0};n.forEach(o=>{a={x:o,y:this.getMosfetSaturationFromDrainVoltage(o)},a.y<0&&(a.y=0),this.points.push(a)}),this.memoize&&this.pointsCache.set(this.discretizeArgsForCache(this.temporaryMinValue,this.temporaryMaxValue,this.Vg.value.voltage,this.Vs.value.voltage,this.Vb.value.voltage),this.points)}discretizeArgsForCache(e,i,n,a,o){return JSON.stringify([e.toFixed(3),i.toFixed(3),n.toFixed(3),a.toFixed(3),o.toFixed(3)])}xLocationToValue(e){let i=0;return this.xScaleType=="linear"?i=e/this.axesWidth*(this.temporaryMaxValue-this.temporaryMinValue)+this.temporaryMinValue:i=10**(Math.log10(e)/this.axesWidth*(Math.log10(this.temporaryMaxValue)-Math.log10(this.temporaryMinValue))+Math.log10(this.temporaryMinValue)),i}xValueToLocation(e){return this.xScaleType=="linear"?(e-this.temporaryMinValue)/(this.temporaryMaxValue-this.temporaryMinValue)*this.axesWidth:(Math.log10(e)-Math.log10(this.temporaryMinValue))/(Math.log10(this.temporaryMaxValue)-Math.log10(this.temporaryMinValue))*this.axesWidth}yValueToLocation(e){return this.yScaleType=="linear"?(e-this.yMin)/(this.yMax-this.yMin)*this.axesHeight:(Math.log10(e)-Math.log10(this.yMin))/(Math.log10(this.yMax)-Math.log10(this.yMin))*this.axesHeight}toggleYAxisLog(){this.yScaleType=this.yScaleType==="log"?"linear":"log"}updateLocationBasedOnValue(){const e=this.value;this.chartType=="Vgs"?this.yValue=this.getMosfetCurrentFromGateVoltage(e):this.yValue=this.getMosfetSaturationFromDrainVoltage(e),this.location={x:this.xValueToLocation(e),y:this.yValueToLocation(this.yValue)}}getMosfetCurrentFromGateVoltage(e){return this.mosfetType=="nmos"?Ze(e,this.Vs.value.voltage,this.Vd.value.voltage,this.Vb.value.voltage).I:ts(e,this.Vs.value.voltage,this.Vd.value.voltage,this.Vb.value.voltage).I}getMosfetSaturationFromDrainVoltage(e){return this.mosfetType=="nmos"?Ze(this.Vg.value.voltage,this.Vs.value.voltage,e,this.Vb.value.voltage).saturationLevel*100:ts(this.Vg.value.voltage,this.Vs.value.voltage,e,this.Vb.value.voltage).saturationLevel*100}updateValueBasedOnMousePosition(e){this.value=this.xLocationToValue(e.x)}mouseDownIntiatesDrag(e){return e.x>0&&e.x<this.axesWidth&&e.y>0&&e.y<this.axesHeight}};c(Q,"paddingL",40),c(Q,"paddingR",10),c(Q,"paddingT",20),c(Q,"paddingB",30);let $t=Q;const j=class j extends $s{constructor(e=[],i,n,a,o,l,h,d,f,u=3,M=5,S=!1,L="visible",W="visible",_="gate",y="main"){super(e,new P().translate({x:n,y:a}).scale(1/30).mirror(S,i=="pmos"),y);c(this,"mosfetType");c(this,"isDuplicate",!1);c(this,"currentDots");c(this,"gradientSize",100);c(this,"schematicEffects");c(this,"vgs");c(this,"vds");c(this,"Vg");c(this,"Vs");c(this,"Vd");c(this,"Vb");c(this,"gndNode");c(this,"mouseDownInsideSelectionArea",!1);c(this,"_selected",w(!1));c(this,"selectedFocus",w(!1));c(this,"vgsChart");c(this,"vdsChart");this.mosfetType=i,this.schematicEffects={gate:{node:o,origin:new b(this.transformations,{x:60,y:0}),color:"red",gradientSize:2},saturation:{node:h,origin:new b(this.transformations,{x:0,y:-60}),color:"red",gradientSize:100}},this.Vg=o,this.Vs=l,this.Vd=h,this.Vb=d,this.gndNode=f,this.anchorPoints={Vg:{x:60,y:0},Vs:{x:0,y:60},Vd:{x:0,y:-60},Vb:{x:0,y:0},SourceSupply:{x:0,y:90},DrainSupply:{x:0,y:-90},Vg_mirror_gate:{x:90,y:0},Vg_mirror_corner:{x:90,y:-90},Vg_mirror_drain:{x:0,y:-90},Vg_drive_gate:{x:120,y:0},Vg_drive_Vsource:{x:120,y:90}};let O="main";y=="mosfet"&&(O="chart"),this.mosfetType=="nmos"?(this.vgs=new Jt(this.transformations,l,o,"toNode",10,10,60,ot(75),ot(70),!0,0,u,"Vgs",L,y),this.vds=new Jt(this.transformations,l,h,"toNode",30,0,75,ot(140),ot(80),!1,0,M,"Vds",W,y),this.vgsChart=new $t(this.transformations,i,"Vgs",j.chartLocations[_].x,j.chartLocations[_].y,o,l,h,d,f,5,"Vg","Current","V","A","linear","log",200,115,"hidden",O),this.vdsChart=new $t(this.transformations,i,"Vds",j.chartLocations[_].x,j.chartLocations[_].y,o,l,h,d,f,5,"Vd","Saturation Level","V","%","linear","linear",200,115,"hidden",O),this.currentDots=new es([{start:{x:-15,y:-60},end:{x:-15,y:60}}])):(this.vgs=new Jt(this.transformations,o,l,"fromNode",10,10,60,ot(75),ot(70),!0,0,u,"Vsg",L,y),this.vds=new Jt(this.transformations,h,l,"fromNode",30,0,75,ot(140),ot(80),!1,0,M,"Vsd",W,y),this.vgsChart=new $t(this.transformations,i,"Vgs",j.chartLocations[_].x,j.chartLocations[_].y,o,l,h,d,f,5,"Vg","Current","V","A","linear","log",200,115,"hidden",O),this.vdsChart=new $t(this.transformations,i,"Vds",j.chartLocations[_].x,j.chartLocations[_].y,o,l,h,d,f,5,"Vd","Saturation Level","V","%","linear","linear",200,115,"hidden",O),this.currentDots=new es([{start:{x:-15,y:60},end:{x:-15,y:-60}}]))}copy(e,i="main"){const n=new j([e].concat(this.transformations.slice(1)),this.mosfetType,0,0,this.Vg,this.Vs,this.Vd,this.Vb,this.gndNode,void 0,void 0,this.mosfetType=="nmos"==this.transformationMatrix.isMirrored,this.vgs.visibility,this.vds.visibility,"deviceOrigin",i);return n.vgsChart.visibility="hidden",n.vdsChart.visibility="hidden",n.isDuplicate=!0,n.transformations[n.transformations.length-1].value=new P,n}draw(e){this.transformationMatrix.transformCanvas(e),this.drawSelectedHalo(e);const i=[{start:{x:0,y:20},end:{x:0,y:59}},{start:{x:0,y:20},end:{x:26,y:20}},{start:{x:0,y:-20},end:{x:0,y:-59}},{start:{x:0,y:-20},end:{x:26,y:-20}},{start:{x:26,y:-40},end:{x:26,y:40}}],n=this.mosfetType=="nmos"?[{start:{x:40,y:30},end:{x:40,y:-30}},{start:{x:40,y:0},end:{x:60,y:0}}]:[{start:{x:40,y:30},end:{x:40,y:-30}},{start:{x:50,y:0},end:{x:60,y:0}}],a=this.mosfetType=="nmos"?[]:[{center:{x:45,y:0},outerDiameter:10}];this.gradientSize=this.getGradientSizeFromSaturationLevel();const l=Us(e,{x:0,y:-60},this.gradientSize,"rgba(200, 200, 200, 1)"),h=this.getForwardCurrentScaled(),d=this.getGateColorFromForwardCurrent();Vt(e,i,this.localLineThickness,"black"),Vt(e,n,this.localLineThickness,d),Qe(e,a,this.localLineThickness,d),Ks(e,i,this.localLineThickness,l),this.schematicEffects.saturation.gradientSize=this.gradientSize/30*3.5,this.schematicEffects.saturation.color="rgba(200, 200, 200, 1)",this.schematicEffects.gate.gradientSize=h*3.5,this.schematicEffects.gate.color=d,this.currentDots.draw(e);const f=jt(this.current,"A");let u="";for(const L of f)"-0123456789.".indexOf(L)>-1&&(u+=L);const M=f.slice(u.length);e.fillStyle="black",e.font="14px sans-serif";const S=this.fillTextGlobalReferenceFrame(e,{x:20,y:this.mosfetType=="nmos"?-3:3},u,!0,!0,14);e.font="14px sans-serif",this.fillTextGlobalReferenceFrame(e,S,M,!0,!0),this.vgsChart.draw(e),this.vdsChart.draw(e),this.vgs.draw(e),this.vds.draw(e)}toggleSelected(){this.selected.value?(this.selected.value=!1,this.vgsChart.visibility="hidden",this.vdsChart.visibility="hidden"):(this.selected.value=!0,this.vgsChart.visibility=this.vgs.visibility,this.vdsChart.visibility=this.vds.visibility)}get current(){return this.getMosfetCurrent()}get saturationLevel(){return this.getMosfetSaturationLevel()}get forwardCurrent(){return this.getMosfetForwardCurrent()}setMinAndMaxValue(){this.mosfetType=="pmos"?(this.vgs.minValue=this.Vs.value.voltage-5,this.vds.minValue=this.Vs.value.voltage-5,this.vgsChart.minValue=this.Vs.value.voltage-5,this.vdsChart.minValue=this.Vs.value.voltage-5):(this.vgs.minValue=-this.Vs.value.voltage,this.vds.minValue=-this.Vs.value.voltage,this.vgsChart.minValue=-this.Vs.value.voltage,this.vdsChart.minValue=-this.Vs.value.voltage)}getMosfetEkvResult(){return this.mosfetType=="pmos"?ts(this.Vg.value.voltage,this.Vs.value.voltage,this.Vd.value.voltage,this.Vb.value.voltage):Ze(this.Vg.value.voltage,this.Vs.value.voltage,this.Vd.value.voltage,this.Vb.value.voltage)}getMosfetCurrent(){return this.getMosfetEkvResult().I}getMosfetSaturationLevel(){return this.getMosfetEkvResult().saturationLevel}getMosfetForwardCurrent(){return this.getMosfetEkvResult().IF}getGradientSizeFromSaturationLevel(){return this.getRelativeScaling()*60*(1-this.saturationLevel)}getForwardCurrentScaled(){return H(0,1,Math.log10(this.forwardCurrent/.005)*.2+1)}getGateColorFromForwardCurrent(){const e=this.getForwardCurrentScaled();return Xi(e)}};c(j,"chartWidth",200),c(j,"chartHeight",120),c(j,"chartLocations",{base:{x:-j.chartWidth/2-100,y:0},lowerBase:{x:-j.chartWidth/2-100,y:100},gate:{x:j.chartWidth/2+120,y:0},furtherGate:{x:j.chartWidth/2+150,y:0},voltageSource:{x:j.chartWidth/2+240,y:0},lowerVoltageSource:{x:j.chartWidth/2+240,y:100},mirrorDriver:{x:j.chartWidth/2+110,y:-j.chartHeight-20},deviceOrigin:{x:0,y:0}});let N=j;class Qt extends ${constructor(e,i,n,a,o=new Pt,l={},h={},d={},f=new P){super([w(new P)],new P);c(this,"name");c(this,"boundingBox");c(this,"schematic");c(this,"devices");c(this,"selectedDeviceCharts",[]);c(this,"selectedDeviceChartsBoundingBox");c(this,"selectedDeviceChartsTransformationMatrix",w(new P));c(this,"nodes");c(this,"textTransformationMatrix");c(this,"originalTextTransformationMatrix");c(this,"circuitCopy");c(this,"anyDevicesSelected",!1);c(this,"moveTectonicPlatesWhileDragging",!0);this.name=e,this.boundingBox=[new b(this.transformations,{x:i.x-n/2,y:i.y-a/2}),new b(this.transformations,{x:i.x+n/2,y:i.y-a/2}),new b(this.transformations,{x:i.x-n/2,y:i.y+a/2}),new b(this.transformations,{x:i.x+n/2,y:i.y+a/2})],this.schematic=o,this.devices={mosfets:l,voltageSources:h},this.nodes=d,this.originalTextTransformationMatrix=f,this.textTransformationMatrix=this.transformationMatrix.scale(1/30).multiply(this.originalTextTransformationMatrix),this.circuitCopy=this.copy(),this.selectedDeviceChartsBoundingBox=[new b(this.transformations,{x:-120,y:0}),new b(this.transformations,{x:120,y:0}),new b(this.transformations,{x:0,y:-120}),new b(this.transformations,{x:0,y:120})],$.circuitTransformationMatrix=this.transformationMatrix,$.textTransformationMatrix=this.textTransformationMatrix}assignKeysToDevices(){Object.entries(this.devices.mosfets).forEach(([e,i])=>{i.key=e}),Object.entries(this.devices.voltageSources).forEach(([e,i])=>{i.key=e})}finishSetup(){var e;this.assignKeysToDevices(),this.circuitCopy=this.copy(),(e=this.circuitCopy)==null||e.assignKeysToDevices()}get allSliders(){return this.makeListOfSliders()}get anySlidersDragging(){let e=!1;return this.allSliders.forEach(i=>{i.dragging&&(e=!0)}),e}copy(){const e=w(new P),i=new sn(this.name,{x:0,y:0},10,10,this.schematic.copy(e),Object.fromEntries(Object.entries(this.devices.mosfets).map(([n,a])=>[n,a.copy(e,"mosfet")])),Object.fromEntries(Object.entries(this.devices.voltageSources).map(([n,a])=>[n,a.copy(e,"mosfet")])),this.nodes,this.textTransformationMatrix);return i.transformations[0]=e,i}draw(e){e.save(),this.setScaleBasedOnBoundingBox(e),this.transformationMatrix.transformCanvas(e),tn.value?(!this.anySlidersDragging||this.moveTectonicPlatesWhileDragging)&&T.allTectonicPlates.forEach(i=>{i.moveTowardDesiredLocation()}):T.allTectonicPlates.forEach(i=>{i.moveTowardLocation({x:0,y:0})}),this.schematic.draw(e),Object.values(this.devices.mosfets).forEach(i=>{i.draw(e)}),Object.values(this.devices.voltageSources).forEach(i=>{i.draw(e)}),Qs.value&&this.drawGrid(e),e.restore()}drawSelectedDeviceCharts(e){const i=this.calculateTransformationMatrixBasedOnBoundingBox(e,this.selectedDeviceChartsBoundingBox);this.selectedDeviceChartsTransformationMatrix.value=i,$.textTransformationMatrix.relativeScale=i.relativeScale,this.selectedDeviceCharts.forEach(n=>{n.draw(e)})}setSelectedDevice(e){if(this.circuitCopy){if(this.circuitCopy.boundingBox=e.boundingBox,this.anyDevicesSelected=!0,e instanceof N){const i=this.circuitCopy.devices.mosfets[e.key];i.vgs.visibility=e.vgs.visibility,i.vds.visibility=e.vds.visibility,i.vgsChart.visibility="hidden",i.vdsChart.visibility="hidden",this.selectedDeviceCharts=[e.vgsChart.copy(this.selectedDeviceChartsTransformationMatrix,"chart"),e.vdsChart.copy(this.selectedDeviceChartsTransformationMatrix,"chart")],this.selectedDeviceCharts[0].visibility=e.vgs.visibility,this.selectedDeviceCharts[1].visibility=e.vds.visibility}else if(e instanceof nt){const i=this.circuitCopy.devices.voltageSources[e.key];i.voltageDrop.visibility=e.voltageDrop.visibility}}}resetSelectedDevice(){this.selectedDeviceCharts=[],this.anyDevicesSelected=!1,this.circuitCopy&&this.circuitCopy.allSliders.forEach(e=>{e.visibility="hidden"})}makeListOfSliders(){const e=[];for(const i in this.devices.mosfets){const n=this.devices.mosfets[i];e.push(n.vgs),e.push(n.vds),e.push(n.vgsChart),e.push(n.vdsChart)}for(const i in this.devices.voltageSources){const n=this.devices.voltageSources[i];e.push(n.voltageDrop)}return this.selectedDeviceCharts.forEach(i=>{e.push(i)}),this.circuitCopy?e.concat(this.circuitCopy.allSliders):e}setSlidersActive(e){const i=a=>{e?(a.vgs.visibility="visible",a.vds.visibility="visible",(a.vgsChart.visibility=="visible"||a.vgsChart.visibility=="locked")&&(a.vgsChart.visibility="visible"),(a.vdsChart.visibility=="visible"||a.vdsChart.visibility=="locked")&&(a.vdsChart.visibility="visible")):(a.vgs.visibility=a.vgs.originalVisibility,a.vds.visibility=a.vds.originalVisibility,(a.vgsChart.visibility=="visible"||a.vgsChart.visibility=="locked")&&(a.vgsChart.visibility=a.vgs.visibility),(a.vdsChart.visibility=="visible"||a.vdsChart.visibility=="locked")&&(a.vdsChart.visibility=a.vds.visibility))};Object.values(this.devices.mosfets).forEach(a=>{i(a),a.selectedFocus.value&&this.circuitCopy&&i(this.circuitCopy.devices.mosfets[a.key])});const n=a=>{e?a.voltageDrop.visibility="visible":a.voltageDrop.visibility=a.voltageDrop.originalVisibility};if(Object.values(this.devices.voltageSources).forEach(a=>{n(a),a.selectedFocus.value&&this.circuitCopy&&n(this.circuitCopy.devices.voltageSources[a.key])}),this.selectedDeviceCharts.length>=2)if(e)(this.selectedDeviceCharts[0].visibility=="visible"||this.selectedDeviceCharts[0].visibility=="locked")&&(this.selectedDeviceCharts[0].visibility="visible"),(this.selectedDeviceCharts[1].visibility=="visible"||this.selectedDeviceCharts[1].visibility=="locked")&&(this.selectedDeviceCharts[1].visibility="visible");else{const a=Object.values(this.devices.mosfets).filter(o=>o.selectedFocus);if(a.length>=1){const o=a[0];(this.selectedDeviceCharts[0].visibility=="visible"||this.selectedDeviceCharts[0].visibility=="locked")&&(this.selectedDeviceCharts[0].visibility=o.vgs.visibility=="hidden"?"locked":o.vgs.visibility),(this.selectedDeviceCharts[1].visibility=="visible"||this.selectedDeviceCharts[1].visibility=="locked")&&(this.selectedDeviceCharts[1].visibility=o.vds.visibility=="hidden"?"locked":o.vds.visibility)}}}drawGrid(e){this.transformationMatrix.transformCanvas(e);const i=this.transformationMatrix.inverse().transformPoint({x:0,y:0}),n=this.transformationMatrix.inverse().transformPoint({x:Zs.value.width*Gt.value,y:Zs.value.height*Gt.value});for(let a=Math.floor(i.x);a<=Math.ceil(n.x);a+=1)for(let o=Math.floor(i.y);o<=Math.ceil(n.y);o+=1){let l=.1;($e(a,10)==0||$e(o,10)==0)&&(l=.2),e.fillStyle="brown",(a==0||o==0)&&(e.fillStyle="black"),e.beginPath(),e.arc(a,o,l,0,2*Math.PI),e.fill()}Qe(e,this.boundingBox.map(a=>({center:a.toPoint(),outerDiameter:2})),.2,"purple")}calculateTransformationMatrixBasedOnBoundingBox(e,i=this.boundingBox){const n=Math.min(...i.map(_=>_.toPoint().x)),a=Math.max(...i.map(_=>_.toPoint().x)),o=Math.min(...i.map(_=>_.toPoint().y)),l=Math.max(...i.map(_=>_.toPoint().y)),h=Math.abs(o-l),d=Math.abs(a-n),f={x:n+d/2,y:o+h/2},u=Math.max(e.canvas.width,1),M=Math.max(e.canvas.height,1),S=Math.min(u/Gt.value/d,M/Gt.value/h),L={x:(u/Gt.value/S-d)/2,y:(M/Gt.value/S-h)/2};return new P().scale(Gt.value*S).translate(L).translate({x:-f.x+d/2,y:-f.y+h/2})}setScaleBasedOnBoundingBox(e,i=this.boundingBox){this.transformations[1].value=new P,this.transformations[0].value=this.calculateTransformationMatrixBasedOnBoundingBox(e,i),this.textTransformationMatrix=this.transformationMatrix.scale(1/30).multiply(this.originalTextTransformationMatrix),this.setCtxArtistScale()}setCtxArtistScale(){$.circuitTransformationMatrix=this.transformationMatrix,$.textTransformationMatrix=this.textTransformationMatrix}resetNodeCapacitance(){for(const e in this.nodes){const i=this.nodes[e].value;i.capacitance=i.originalCapacitance}}nodeVoltagesToJson(){const e=Object.fromEntries(Object.entries(this.nodes).map(([n,a])=>[n,a.value.voltage]));return JSON.stringify([this.name,e])}fixedNodeVoltagesToJson(){const e=Object.fromEntries(Object.entries(this.nodes).filter(([n,a])=>a.value.fixed).map(([n,a])=>[n,a.value.voltage]));return JSON.stringify([this.name,e])}nodeVoltagesFromJson(e){const i=JSON.parse(e);if(i[0]!=this.name)return!1;let n=!1;const a=i[1];Object.entries(a).forEach(([o,l])=>{this.nodes[o].value.voltage=l,[v,D].includes(o)||(n=!0)}),n&&this.resetNodeCapacitance()}}class sn extends Qt{copy(){return null}setCtxArtistScale(){}}class nn{constructor(){c(this,"items",[])}enqueue(s){this.items.push(s)}dequeue(){return this.items.shift()}peek(){return this.items[0]}isEmpty(){return this.items.length===0}size(){return this.items.length}toArray(){return this.items}fill(s,e){this.items=Array(e).fill(s)}}class C{constructor(s,e){c(this,"voltage");c(this,"netCurrent");c(this,"capacitance");c(this,"originalCapacitance");c(this,"fixed");c(this,"historicVoltages");c(this,"schematicEffects",[]);const i=new nn;i.fill(0,10);const n=e?100:5e-7;this.voltage=s,this.netCurrent=0,this.capacitance=n,this.originalCapacitance=n,this.fixed=!!e,this.historicVoltages=i}}class q extends ${constructor(s=[],e){super(s,new P().translate(e))}draw(s){this.transformationMatrix.transformCanvas(s);const e=.8;s.strokeStyle="black",s.lineWidth=this.localLineThickness,s.beginPath(),s.moveTo(0,0),s.lineTo(e/2,0),s.lineTo(0,e/2),s.lineTo(-e/2,0),s.lineTo(0,0),s.stroke()}copy(s){return new q([s].concat(this.transformations.slice(1)),{x:0,y:0})}}class ft extends ${constructor(s=[],e){super(s,new P().translate(e))}draw(s){this.transformationMatrix.transformCanvas(s);const e=.8;s.strokeStyle="black",s.lineWidth=this.localLineThickness,s.beginPath(),s.moveTo(e/2,0),s.lineTo(-e/2,0),s.stroke()}copy(s){return new ft([s].concat(this.transformations.slice(1)),{x:0,y:0})}}const an=()=>{const t=new Qt("nMosSingle",{x:0,y:-3},10,20);t.nodes={[v]:w(new C(0,!0)),[D]:w(new C(5,!0)),M1_drain:w(new C(5,!1)),M1_gate:w(new C(1,!1))};const s=new T(t.transformations,A(()=>it([{start:{x:0,y:2},end:{x:0,y:-4}}],H(0,5,t.nodes.M1_drain.value.voltage)/5))),e=new T(t.transformations,A(()=>({x:0,y:-4}))),i=new T(t.transformations,A(()=>t.devices.mosfets.M1.selected.value?{x:7,y:0}:{x:0,y:0}));return t.boundingBox=[new b(e.transformations,{x:-5,y:-12}),new b(s.transformations,{x:5,y:-12}),new b(t.transformations,{x:-5,y:6}),new b(i.transformations,{x:5,y:6})],t.devices.mosfets={M1:new N(t.transformations,"nmos",0,0,t.nodes.M1_gate,t.nodes[v],t.nodes.M1_drain,t.nodes[v],t.nodes[v],3,5,!1,"visible","visible","furtherGate")},t.devices.mosfets.M1.vgsChart.originalVisibility="visible",t.devices.mosfets.M1.vdsChart.originalVisibility="visible",t.devices.voltageSources={Vd:new nt(s.transformations,{x:0,y:-6},t.nodes.M1_drain,t.nodes[D],"Vdd-Vd","vdd",!0)},t.schematic=new Pt(t.transformations,[new q(...t.devices.mosfets.M1.getAnchorPointWithTransformations("Vs"))],[new ft(e.transformations,{x:0,y:-8})],[],Object.values(t.devices.mosfets),Object.values(t.nodes),[{node:t.nodes.M1_drain,lines:[new g(...t.devices.mosfets.M1.getAnchorPointWithTransformations("Vd"),...t.devices.voltageSources.Vd.getAnchorPointWithTransformations("Vminus"))],voltageDisplayLabel:"Drain",voltageDisplayLocations:[new b(s.transformations,{x:.5,y:-4})]},{node:t.nodes[D],lines:[new g(e.transformations,{x:0,y:-8},...t.devices.voltageSources.Vd.getAnchorPointWithTransformations("Vplus"))],voltageDisplayLabel:"",voltageDisplayLocations:[]}]),t.finishSetup(),t},on=()=>{const t=new Qt("nMosDiffPair",{x:0,y:4},25,20);t.nodes={[v]:w(new C(0,!0)),[D]:w(new C(5,!0)),M1_gate:w(new C(2,!1)),M2_gate:w(new C(2,!1)),Mb_gate:w(new C(.7,!1)),Vnode:w(new C(1,!1))};const s=new T(t.transformations,A(()=>it([{start:{x:0,y:1},end:{x:0,y:-7}}],H(0,5,Math.max(t.nodes.M1_gate.value.voltage,t.nodes.Vnode.value.voltage))/5))),e=new T(t.transformations,A(()=>it([{start:{x:0,y:1},end:{x:0,y:-7}}],H(0,5,Math.max(t.nodes.M2_gate.value.voltage,t.nodes.Vnode.value.voltage))/5))),i=new T(t.transformations,A(()=>it([{start:{x:0,y:0},end:{x:0,y:-8}}],H(0,5,t.nodes.Vnode.value.voltage)/5))),n=new T(s.transformations,A(()=>t.devices.mosfets.Mb.selected.value?{x:5,y:2}:{x:0,y:0})),a=new T(s.transformations,A(()=>t.devices.mosfets.M1.selected.value?{x:-8,y:0}:{x:0,y:0})),o=new T(e.transformations,A(()=>t.devices.mosfets.M2.selected.value?{x:8,y:0}:{x:0,y:0}));return t.boundingBox=[new b(a.transformations,{x:-11,y:-6}),new b(o.transformations,{x:11,y:-6}),new b(t.transformations,{x:-11,y:13}),new b(n.transformations,{x:11,y:13})],t.devices.mosfets={Mb:new N(t.transformations,"nmos",0,6,t.nodes.Mb_gate,t.nodes[v],t.nodes.Vnode,t.nodes[v],t.nodes[v],void 0,void 0,!1,"locked","locked","lowerVoltageSource"),M1:new N(s.transformations,"nmos",-4,0,t.nodes.M1_gate,t.nodes.Vnode,t.nodes[D],t.nodes[v],t.nodes[v],void 0,void 0,!0,"locked","locked","voltageSource"),M2:new N(e.transformations,"nmos",4,0,t.nodes.M2_gate,t.nodes.Vnode,t.nodes[D],t.nodes[v],t.nodes[v],void 0,void 0,!1,"locked","locked","voltageSource")},t.devices.voltageSources={V1:new nt(...t.devices.mosfets.M1.getAnchorPointWithTransformations("Vg_drive_Vsource"),t.nodes[v],t.nodes.M1_gate,"V1","gnd",!0),V2:new nt(...t.devices.mosfets.M2.getAnchorPointWithTransformations("Vg_drive_Vsource"),t.nodes[v],t.nodes.M2_gate,"V2","gnd"),Vb:new nt(...t.devices.mosfets.Mb.getAnchorPointWithTransformations("Vg_drive_Vsource"),t.nodes[v],t.nodes.Mb_gate,"Vb","gnd")},t.schematic=new Pt(t.transformations,[new q(...t.devices.mosfets.Mb.getAnchorPointWithTransformations("SourceSupply")),new q(...t.devices.voltageSources.Vb.getAnchorPointWithTransformations("gnd")),new q(...t.devices.voltageSources.V1.getAnchorPointWithTransformations("gnd")),new q(...t.devices.voltageSources.V2.getAnchorPointWithTransformations("gnd"))],[new ft(...t.devices.mosfets.M1.getAnchorPointWithTransformations("DrainSupply")),new ft(...t.devices.mosfets.M2.getAnchorPointWithTransformations("DrainSupply"))],[],Object.values(t.devices.mosfets),Object.values(t.nodes),[{node:t.nodes[v],lines:[new g(t.transformations,{x:0,y:8},t.transformations,{x:0,y:9}),new g(...t.devices.voltageSources.Vb.getAnchorPointWithTransformations("Vminus"),...t.devices.voltageSources.Vb.getAnchorPointWithTransformations("gnd")),new g(...t.devices.voltageSources.V1.getAnchorPointWithTransformations("Vminus"),...t.devices.voltageSources.V1.getAnchorPointWithTransformations("gnd")),new g(...t.devices.voltageSources.V2.getAnchorPointWithTransformations("Vminus"),...t.devices.voltageSources.V2.getAnchorPointWithTransformations("gnd"))],voltageDisplayLabel:"",voltageDisplayLocations:[]},{node:t.nodes[D],lines:[new g(...t.devices.mosfets.M1.getAnchorPointWithTransformations("Vd"),...t.devices.mosfets.M1.getAnchorPointWithTransformations("DrainSupply")),new g(...t.devices.mosfets.M2.getAnchorPointWithTransformations("Vd"),...t.devices.mosfets.M2.getAnchorPointWithTransformations("DrainSupply"))],voltageDisplayLabel:"",voltageDisplayLocations:[]},{node:t.nodes.M1_gate,lines:[new g(...t.devices.mosfets.M1.getAnchorPointWithTransformations("Vg"),...t.devices.mosfets.M1.getAnchorPointWithTransformations("Vg_drive_gate")),new g(...t.devices.voltageSources.V1.getAnchorPointWithTransformations("Vplus"),...t.devices.mosfets.M1.getAnchorPointWithTransformations("Vg_drive_gate"))],voltageDisplayLabel:"",voltageDisplayLocations:[]},{node:t.nodes.M2_gate,lines:[new g(...t.devices.mosfets.M2.getAnchorPointWithTransformations("Vg"),...t.devices.mosfets.M2.getAnchorPointWithTransformations("Vg_drive_gate")),new g(...t.devices.voltageSources.V2.getAnchorPointWithTransformations("Vplus"),...t.devices.mosfets.M2.getAnchorPointWithTransformations("Vg_drive_gate"))],voltageDisplayLabel:"",voltageDisplayLocations:[]},{node:t.nodes.Mb_gate,lines:[new g(...t.devices.mosfets.Mb.getAnchorPointWithTransformations("Vg"),...t.devices.mosfets.Mb.getAnchorPointWithTransformations("Vg_drive_gate")),new g(...t.devices.voltageSources.Vb.getAnchorPointWithTransformations("Vplus"),...t.devices.mosfets.Mb.getAnchorPointWithTransformations("Vg_drive_gate"))],voltageDisplayLabel:"",voltageDisplayLocations:[]},{node:t.nodes.Vnode,lines:[new g(i.transformations,{x:-4,y:3},...t.devices.mosfets.M1.getAnchorPointWithTransformations("Vs")),new g(i.transformations,{x:4,y:3},...t.devices.mosfets.M2.getAnchorPointWithTransformations("Vs")),new g(i.transformations,{x:-4,y:3},i.transformations,{x:4,y:3}),new g(...t.devices.mosfets.Mb.getAnchorPointWithTransformations("Vd"),i.transformations,{x:0,y:3})],voltageDisplayLabel:"V",voltageDisplayLocations:[new b(i.transformations,{x:-1,y:2.5})]}]),t.finishSetup(),t};class ni extends ${constructor(e=[],i,n,a){super(e,new P().translate(n).scale(1/30));c(this,"node");c(this,"extraNodeLines");c(this,"currentDots");c(this,"gndSymbol");this.node=i,this.extraNodeLines=a,this.currentDots=new es([{start:{x:10,y:-60},end:{x:10,y:60}}]),this.gndSymbol=new q(this.transformations,{x:0,y:30})}draw(e){this.transformationMatrix.scale(.5).transformCanvas(e);const i=7,n=[{start:{x:0,y:50},end:{x:0,y:i}},{start:{x:-30,y:i},end:{x:30,y:i}},{start:{x:-30,y:-i},end:{x:30,y:-i}},{start:{x:0,y:-60},end:{x:0,y:-i}}],a=this.transformationMatrix.transformPath(this.extraNodeLines);Vt(e,n,this.localLineThickness,"black"),Vt(e,a,this.localLineThickness,"black"),e.clearRect(-30-this.localLineThickness,-i+this.localLineThickness/2,60+2*this.localLineThickness,2*i-2*this.localLineThickness/2),this.gndSymbol.draw(e),this.transformationMatrix.scale(.5).transformCanvas(e),this.currentDots.draw(e)}}c(ni,"displayCurrent",!1);const rn=()=>{const t=new Qt("nMos5TransistorOpAmp",{x:0,y:0},25,28);t.nodes={[v]:w(new C(0,!0)),[D]:w(new C(5,!0)),M1_gate:w(new C(2,!1)),M1_drain:w(new C(4,!1)),M2_gate:w(new C(2,!1)),Mb_gate:w(new C(.7,!1)),Vout:w(new C(4,!1)),Vnode:w(new C(1,!1))};const s=new T(t.transformations,A(()=>it([{start:{x:0,y:1},end:{x:0,y:-7}}],H(0,5,Math.max(t.nodes.M1_gate.value.voltage,t.nodes.Vnode.value.voltage))/5))),e=new T(t.transformations,A(()=>it([{start:{x:0,y:1},end:{x:0,y:-7}}],H(0,5,Math.max(t.nodes.M2_gate.value.voltage,t.nodes.Vnode.value.voltage))/5))),i=new T(t.transformations,A(()=>({x:0,y:-4}))),n=new T(t.transformations,A(()=>it([{start:{x:0,y:0},end:{x:0,y:-8}}],H(0,5,t.nodes.Vnode.value.voltage)/5))),a=new T(t.transformations,A(()=>it([{start:{x:0,y:2},end:{x:0,y:-6}}],H(0,5,Math.max(t.nodes.Vout.value.voltage,t.nodes.M2_gate.value.voltage-1.25))/5))),o=new T(s.transformations,A(()=>t.devices.mosfets.Mb.selected.value?{x:5,y:2}:{x:0,y:0})),l=new T(s.transformations,A(()=>t.devices.mosfets.M1.selected.value?{x:-8,y:0}:{x:0,y:0})),h=new T(e.transformations,A(()=>t.devices.mosfets.M2.selected.value?{x:8,y:0}:{x:0,y:0})),d=new T(i.transformations,A(()=>t.devices.mosfets.M3.selected.value?{x:-3,y:-3}:{x:0,y:0})),f=new T(i.transformations,A(()=>t.devices.mosfets.M4.selected.value?{x:3,y:-3}:{x:0,y:0}));return t.boundingBox=[new b(l.transformations,{x:-12,y:-14}),new b(h.transformations,{x:12,y:-14}),new b(d.transformations,{x:-12,y:-14}),new b(f.transformations,{x:12,y:-14}),new b(t.transformations,{x:-12,y:14}),new b(o.transformations,{x:12,y:14})],t.devices.mosfets={Mb:new N(t.transformations,"nmos",0,6,t.nodes.Mb_gate,t.nodes[v],t.nodes.Vnode,t.nodes[v],t.nodes[v],void 0,void 0,!1,"locked","locked","lowerVoltageSource"),M1:new N(s.transformations,"nmos",-4,0,t.nodes.M1_gate,t.nodes.Vnode,t.nodes.M1_drain,t.nodes[v],t.nodes[v],void 0,void 0,!0,"locked","locked","voltageSource"),M2:new N(e.transformations,"nmos",4,0,t.nodes.M2_gate,t.nodes.Vnode,t.nodes.Vout,t.nodes[v],t.nodes[v],void 0,void 0,!1,"locked","locked","voltageSource"),M3:new N(i.transformations,"pmos",-4,-9,t.nodes.M1_drain,t.nodes[D],t.nodes.M1_drain,t.nodes[D],t.nodes[v],void 0,void 0,!1,"locked","locked","lowerBase"),M4:new N(i.transformations,"pmos",4,-9,t.nodes.M1_drain,t.nodes[D],t.nodes.Vout,t.nodes[D],t.nodes[v],void 0,void 0,!0,"locked","locked","lowerBase")},t.devices.voltageSources={V1:new nt(...t.devices.mosfets.M1.getAnchorPointWithTransformations("Vg_drive_Vsource"),t.nodes[v],t.nodes.M1_gate,"V1","gnd",!0),V2:new nt(...t.devices.mosfets.M2.getAnchorPointWithTransformations("Vg_drive_Vsource"),t.nodes[v],t.nodes.M2_gate,"V2","gnd"),Vb:new nt(...t.devices.mosfets.Mb.getAnchorPointWithTransformations("Vg_drive_Vsource"),t.nodes[v],t.nodes.Mb_gate,"Vb","gnd")},t.schematic=new Pt(t.transformations,[new q(...t.devices.mosfets.Mb.getAnchorPointWithTransformations("SourceSupply")),new q(...t.devices.voltageSources.Vb.getAnchorPointWithTransformations("gnd")),new q(...t.devices.voltageSources.V1.getAnchorPointWithTransformations("gnd")),new q(...t.devices.voltageSources.V2.getAnchorPointWithTransformations("gnd"))],[new ft(...t.devices.mosfets.M3.getAnchorPointWithTransformations("SourceSupply")),new ft(...t.devices.mosfets.M4.getAnchorPointWithTransformations("SourceSupply"))],[new ni(a.transformations,t.nodes.Vout,{x:6,y:-4},[{start:{x:6,y:-5},end:{x:6,y:-4}}])],Object.values(t.devices.mosfets),Object.values(t.nodes),[{node:t.nodes[v],lines:[new g(...t.devices.mosfets.Mb.getAnchorPointWithTransformations("Vs"),...t.devices.mosfets.Mb.getAnchorPointWithTransformations("SourceSupply")),new g(...t.devices.voltageSources.Vb.getAnchorPointWithTransformations("Vminus"),...t.devices.voltageSources.Vb.getAnchorPointWithTransformations("gnd")),new g(...t.devices.voltageSources.V1.getAnchorPointWithTransformations("Vminus"),...t.devices.voltageSources.V1.getAnchorPointWithTransformations("gnd")),new g(...t.devices.voltageSources.V2.getAnchorPointWithTransformations("Vminus"),...t.devices.voltageSources.V2.getAnchorPointWithTransformations("gnd"))],voltageDisplayLabel:"",voltageDisplayLocations:[]},{node:t.nodes[D],lines:[new g(...t.devices.mosfets.M3.getAnchorPointWithTransformations("Vs"),...t.devices.mosfets.M3.getAnchorPointWithTransformations("SourceSupply")),new g(...t.devices.mosfets.M4.getAnchorPointWithTransformations("Vs"),...t.devices.mosfets.M4.getAnchorPointWithTransformations("SourceSupply"))],voltageDisplayLabel:"",voltageDisplayLocations:[]},{node:t.nodes.M1_gate,lines:[new g(...t.devices.mosfets.M1.getAnchorPointWithTransformations("Vg"),...t.devices.mosfets.M1.getAnchorPointWithTransformations("Vg_drive_gate")),new g(...t.devices.voltageSources.V1.getAnchorPointWithTransformations("Vplus"),...t.devices.mosfets.M1.getAnchorPointWithTransformations("Vg_drive_gate"))],voltageDisplayLabel:"",voltageDisplayLocations:[]},{node:t.nodes.M2_gate,lines:[new g(...t.devices.mosfets.M2.getAnchorPointWithTransformations("Vg"),...t.devices.mosfets.M2.getAnchorPointWithTransformations("Vg_drive_gate")),new g(...t.devices.voltageSources.V2.getAnchorPointWithTransformations("Vplus"),...t.devices.mosfets.M2.getAnchorPointWithTransformations("Vg_drive_gate"))],voltageDisplayLabel:"",voltageDisplayLocations:[]},{node:t.nodes.Mb_gate,lines:[new g(...t.devices.mosfets.Mb.getAnchorPointWithTransformations("Vg"),...t.devices.mosfets.Mb.getAnchorPointWithTransformations("Vg_drive_gate")),new g(...t.devices.voltageSources.Vb.getAnchorPointWithTransformations("Vplus"),...t.devices.mosfets.Mb.getAnchorPointWithTransformations("Vg_drive_gate"))],voltageDisplayLabel:"",voltageDisplayLocations:[]},{node:t.nodes.Vnode,lines:[new g(n.transformations,{x:-4,y:3},...t.devices.mosfets.M1.getAnchorPointWithTransformations("Vs")),new g(n.transformations,{x:4,y:3},...t.devices.mosfets.M2.getAnchorPointWithTransformations("Vs")),new g(n.transformations,{x:-4,y:3},n.transformations,{x:4,y:3}),new g(...t.devices.mosfets.Mb.getAnchorPointWithTransformations("Vd"),n.transformations,{x:0,y:3})],voltageDisplayLabel:"V",voltageDisplayLocations:[new b(n.transformations,{x:-1,y:2.5})]},{node:t.nodes.M1_drain,lines:[new g(...t.devices.mosfets.M1.getAnchorPointWithTransformations("Vd"),...t.devices.mosfets.M3.getAnchorPointWithTransformations("Vd")),new g(...t.devices.mosfets.M3.getAnchorPointWithTransformations("Vg_mirror_gate"),...t.devices.mosfets.M3.getAnchorPointWithTransformations("Vg_mirror_corner")),new g(...t.devices.mosfets.M3.getAnchorPointWithTransformations("Vg_mirror_drain"),...t.devices.mosfets.M3.getAnchorPointWithTransformations("Vg_mirror_corner")),new g(...t.devices.mosfets.M3.getAnchorPointWithTransformations("Vg"),...t.devices.mosfets.M4.getAnchorPointWithTransformations("Vg"))],voltageDisplayLabel:"",voltageDisplayLocations:[]},{node:t.nodes.Vout,lines:[new g(...t.devices.mosfets.M2.getAnchorPointWithTransformations("Vd"),...t.devices.mosfets.M4.getAnchorPointWithTransformations("Vd")),new g(a.transformations,{x:4,y:-5},a.transformations,{x:6,y:-5})],voltageDisplayLabel:"Vout",voltageDisplayLocations:[new b(a.transformations,{x:6.5,y:-5})]}]),t.finishSetup(),t},ln=()=>{const t=new Qt("nMos9TransistorOpAmp",{x:10,y:-2},50,30);t.nodes={[v]:w(new C(0,!0)),[D]:w(new C(5,!0)),M1_gate:w(new C(2,!1)),M1_drain:w(new C(4,!1)),M2_gate:w(new C(2,!1)),M2_drain:w(new C(4,!1)),M7_drain:w(new C(1,!1)),Mb_gate:w(new C(.7,!1)),Vout:w(new C(4,!1)),Vnode:w(new C(1,!1))};const s=new T(t.transformations,A(()=>it([{start:{x:0,y:1},end:{x:0,y:-7}}],H(0,5,Math.max(t.nodes.M1_gate.value.voltage,t.nodes.Vnode.value.voltage))/5))),e=new T(t.transformations,A(()=>it([{start:{x:0,y:1},end:{x:0,y:-7}}],H(0,5,Math.max(t.nodes.M2_gate.value.voltage,t.nodes.Vnode.value.voltage))/5))),i=new T(t.transformations,A(()=>t.devices.mosfets.M5.selected.value||t.devices.mosfets.M6.selected.value?{x:0,y:t.devices.mosfets.M2.selected.value?-14:-10}:{x:0,y:-5})),n=new T(t.transformations,A(()=>{let S=[t.devices.mosfets.M2.selected.value,t.devices.mosfets.M5.selected.value,t.devices.mosfets.M6.selected.value,t.devices.mosfets.Mb.selected.value,t.devices.mosfets.M7.selected.value].filter(Boolean).length;return S==0?{x:0,y:0}:S==1?{x:5,y:0}:t.devices.mosfets.M5.selected.value&&t.devices.mosfets.M6.selected.value||t.devices.mosfets.Mb.selected.value&&t.devices.mosfets.M7.selected.value?{x:10,y:0}:{x:5,y:0}})),a=new T(i.transformations,A(()=>{let S=[t.devices.mosfets.M2.selected.value,t.devices.mosfets.M5.selected.value,t.devices.mosfets.M6.selected.value,t.devices.mosfets.Mb.selected.value,t.devices.mosfets.M7.selected.value].filter(Boolean).length;return S==0?{x:0,y:0}:S==1?{x:5,y:0}:t.devices.mosfets.M5.selected.value&&t.devices.mosfets.M6.selected.value||t.devices.mosfets.Mb.selected.value&&t.devices.mosfets.M7.selected.value?{x:10,y:0}:{x:5,y:0}})),o=new T(t.transformations,A(()=>it([{start:{x:0,y:0},end:{x:0,y:-8}}],H(0,5,t.nodes.Vnode.value.voltage)/5))),l=new T(n.transformations,A(()=>it([{start:{x:0,y:8.5},end:t.devices.mosfets.M5.selected.value||t.devices.mosfets.M6.selected.value?{x:0,y:t.devices.mosfets.M2.selected.value?-20:-15}:{x:0,y:-9}}],H(0,5,t.nodes.Vout.value.voltage)/5))),h=new T(t.transformations,A(()=>t.devices.mosfets.Mb.selected.value||t.devices.mosfets.M7.selected.value||t.devices.mosfets.M8.selected.value?{x:0,y:2}:{x:0,y:0})),d=new T(t.transformations,A(()=>t.devices.mosfets.M1.selected.value?{x:-8,y:0}:{x:0,y:0})),f=new T(i.transformations,A(()=>t.devices.mosfets.M3.selected.value?{x:-3,y:-4}:{x:0,y:0})),u=new T(a.transformations,A(()=>t.devices.mosfets.M4.selected.value?{x:2,y:-4}:{x:0,y:0})),M=new T(n.transformations,A(()=>t.devices.mosfets.M8.selected.value?{x:2,y:2}:{x:0,y:0}));return t.boundingBox=[new b(f.transformations,{x:-12,y:-16}),new b(u.transformations,{x:33,y:-16}),new b(h.transformations,{x:-12,y:12}),new b(d.transformations,{x:-12,y:0}),new b(M.transformations,{x:33,y:12})],t.devices.mosfets={Mb:new N(t.transformations,"nmos",0,6,t.nodes.Mb_gate,t.nodes[v],t.nodes.Vnode,t.nodes[v],t.nodes[v],void 0,void 0,!1,"locked","locked","lowerVoltageSource"),M1:new N(s.transformations,"nmos",-4,0,t.nodes.M1_gate,t.nodes.Vnode,t.nodes.M1_drain,t.nodes[v],t.nodes[v],void 0,void 0,!0,"locked","locked","voltageSource"),M2:new N(e.transformations,"nmos",4,0,t.nodes.M2_gate,t.nodes.Vnode,t.nodes.M2_drain,t.nodes[v],t.nodes[v],void 0,void 0,!1,"locked","locked","voltageSource"),M3:new N(i.transformations,"pmos",-4,-12,t.nodes.M1_drain,t.nodes[D],t.nodes.M1_drain,t.nodes[D],t.nodes[v],void 0,void 0,!1,"locked","locked","lowerBase"),M4:new N(a.transformations,"pmos",24,-12,t.nodes.M1_drain,t.nodes[D],t.nodes.Vout,t.nodes[D],t.nodes[v],void 0,void 0,!0,"locked","locked","lowerBase"),M5:new N(i.transformations,"pmos",4,-7,t.nodes.M2_drain,t.nodes[D],t.nodes.M2_drain,t.nodes[D],t.nodes[v],void 0,void 0,!1,"locked","locked","mirrorDriver"),M6:new N(a.transformations,"pmos",16,-7,t.nodes.M2_drain,t.nodes[D],t.nodes.M7_drain,t.nodes[D],t.nodes[v],void 0,void 0,!0,"locked","locked","mirrorDriver"),M7:new N(n.transformations,"nmos",16,6,t.nodes.M7_drain,t.nodes[v],t.nodes.M7_drain,t.nodes[v],t.nodes[v],void 0,void 0,!1,"locked","locked","lowerBase"),M8:new N(n.transformations,"nmos",24,6,t.nodes.M7_drain,t.nodes[v],t.nodes.Vout,t.nodes[v],t.nodes[v],void 0,void 0,!0,"locked","locked","lowerBase")},t.devices.voltageSources={V1:new nt(...t.devices.mosfets.M1.getAnchorPointWithTransformations("Vg_drive_Vsource"),t.nodes[v],t.nodes.M1_gate,"V1","gnd",!0),V2:new nt(...t.devices.mosfets.M2.getAnchorPointWithTransformations("Vg_drive_Vsource"),t.nodes[v],t.nodes.M2_gate,"V2","gnd"),Vb:new nt(...t.devices.mosfets.Mb.getAnchorPointWithTransformations("Vg_drive_Vsource"),t.nodes[v],t.nodes.Mb_gate,"Vb","gnd")},t.schematic=new Pt(t.transformations,[new q(...t.devices.mosfets.Mb.getAnchorPointWithTransformations("SourceSupply")),new q(...t.devices.mosfets.M7.getAnchorPointWithTransformations("SourceSupply")),new q(...t.devices.mosfets.M8.getAnchorPointWithTransformations("SourceSupply")),new q(...t.devices.voltageSources.Vb.getAnchorPointWithTransformations("gnd")),new q(...t.devices.voltageSources.V1.getAnchorPointWithTransformations("gnd")),new q(...t.devices.voltageSources.V2.getAnchorPointWithTransformations("gnd"))],[new ft(...t.devices.mosfets.M3.getAnchorPointWithTransformations("SourceSupply")),new ft(...t.devices.mosfets.M4.getAnchorPointWithTransformations("SourceSupply")),new ft(...t.devices.mosfets.M5.getAnchorPointWithTransformations("SourceSupply")),new ft(...t.devices.mosfets.M6.getAnchorPointWithTransformations("SourceSupply"))],[],Object.values(t.devices.mosfets),Object.values(t.nodes),[{node:t.nodes[v],lines:[new g(...t.devices.mosfets.Mb.getAnchorPointWithTransformations("Vs"),...t.devices.mosfets.Mb.getAnchorPointWithTransformations("SourceSupply")),new g(...t.devices.mosfets.M7.getAnchorPointWithTransformations("Vs"),...t.devices.mosfets.M7.getAnchorPointWithTransformations("SourceSupply")),new g(...t.devices.mosfets.M8.getAnchorPointWithTransformations("Vs"),...t.devices.mosfets.M8.getAnchorPointWithTransformations("SourceSupply")),new g(...t.devices.voltageSources.Vb.getAnchorPointWithTransformations("Vminus"),...t.devices.voltageSources.Vb.getAnchorPointWithTransformations("gnd")),new g(...t.devices.voltageSources.V1.getAnchorPointWithTransformations("Vminus"),...t.devices.voltageSources.V1.getAnchorPointWithTransformations("gnd")),new g(...t.devices.voltageSources.V2.getAnchorPointWithTransformations("Vminus"),...t.devices.voltageSources.V2.getAnchorPointWithTransformations("gnd"))],voltageDisplayLabel:"",voltageDisplayLocations:[]},{node:t.nodes[D],lines:[new g(...t.devices.mosfets.M3.getAnchorPointWithTransformations("Vs"),...t.devices.mosfets.M3.getAnchorPointWithTransformations("SourceSupply")),new g(...t.devices.mosfets.M4.getAnchorPointWithTransformations("Vs"),...t.devices.mosfets.M4.getAnchorPointWithTransformations("SourceSupply")),new g(...t.devices.mosfets.M5.getAnchorPointWithTransformations("Vs"),...t.devices.mosfets.M5.getAnchorPointWithTransformations("SourceSupply")),new g(...t.devices.mosfets.M6.getAnchorPointWithTransformations("Vs"),...t.devices.mosfets.M6.getAnchorPointWithTransformations("SourceSupply"))],voltageDisplayLabel:"",voltageDisplayLocations:[]},{node:t.nodes.M1_gate,lines:[new g(...t.devices.mosfets.M1.getAnchorPointWithTransformations("Vg"),...t.devices.mosfets.M1.getAnchorPointWithTransformations("Vg_drive_gate")),new g(...t.devices.voltageSources.V1.getAnchorPointWithTransformations("Vplus"),...t.devices.mosfets.M1.getAnchorPointWithTransformations("Vg_drive_gate"))],voltageDisplayLabel:"",voltageDisplayLocations:[]},{node:t.nodes.M2_gate,lines:[new g(...t.devices.mosfets.M2.getAnchorPointWithTransformations("Vg"),...t.devices.mosfets.M2.getAnchorPointWithTransformations("Vg_drive_gate")),new g(...t.devices.voltageSources.V2.getAnchorPointWithTransformations("Vplus"),...t.devices.mosfets.M2.getAnchorPointWithTransformations("Vg_drive_gate"))],voltageDisplayLabel:"",voltageDisplayLocations:[]},{node:t.nodes.Mb_gate,lines:[new g(...t.devices.mosfets.Mb.getAnchorPointWithTransformations("Vg"),...t.devices.mosfets.Mb.getAnchorPointWithTransformations("Vg_drive_gate")),new g(...t.devices.voltageSources.Vb.getAnchorPointWithTransformations("Vplus"),...t.devices.mosfets.Mb.getAnchorPointWithTransformations("Vg_drive_gate"))],voltageDisplayLabel:"",voltageDisplayLocations:[]},{node:t.nodes.Vnode,lines:[new g(o.transformations,{x:-4,y:3},...t.devices.mosfets.M1.getAnchorPointWithTransformations("Vs")),new g(o.transformations,{x:4,y:3},...t.devices.mosfets.M2.getAnchorPointWithTransformations("Vs")),new g(o.transformations,{x:-4,y:3},o.transformations,{x:4,y:3}),new g(...t.devices.mosfets.Mb.getAnchorPointWithTransformations("Vd"),o.transformations,{x:0,y:3})],voltageDisplayLabel:"V",voltageDisplayLocations:[new b(o.transformations,{x:-1,y:2.5})]},{node:t.nodes.M1_drain,lines:[new g(...t.devices.mosfets.M1.getAnchorPointWithTransformations("Vd"),...t.devices.mosfets.M3.getAnchorPointWithTransformations("Vd")),new g(...t.devices.mosfets.M3.getAnchorPointWithTransformations("Vg_mirror_gate"),...t.devices.mosfets.M3.getAnchorPointWithTransformations("Vg_mirror_corner")),new g(...t.devices.mosfets.M3.getAnchorPointWithTransformations("Vg_mirror_drain"),...t.devices.mosfets.M3.getAnchorPointWithTransformations("Vg_mirror_corner")),new g(...t.devices.mosfets.M3.getAnchorPointWithTransformations("Vg"),...t.devices.mosfets.M4.getAnchorPointWithTransformations("Vg"))],voltageDisplayLabel:"",voltageDisplayLocations:[]},{node:t.nodes.M2_drain,lines:[new g(...t.devices.mosfets.M2.getAnchorPointWithTransformations("Vd"),...t.devices.mosfets.M5.getAnchorPointWithTransformations("Vd")),new g(...t.devices.mosfets.M5.getAnchorPointWithTransformations("Vg"),...t.devices.mosfets.M6.getAnchorPointWithTransformations("Vg")),new g(...t.devices.mosfets.M5.getAnchorPointWithTransformations("Vg_mirror_gate"),...t.devices.mosfets.M5.getAnchorPointWithTransformations("Vg_mirror_corner")),new g(...t.devices.mosfets.M5.getAnchorPointWithTransformations("Vg_mirror_drain"),...t.devices.mosfets.M5.getAnchorPointWithTransformations("Vg_mirror_corner"))],voltageDisplayLabel:"",voltageDisplayLocations:[]},{node:t.nodes.M7_drain,lines:[new g(...t.devices.mosfets.M6.getAnchorPointWithTransformations("Vd"),...t.devices.mosfets.M7.getAnchorPointWithTransformations("Vd")),new g(...t.devices.mosfets.M7.getAnchorPointWithTransformations("Vg"),...t.devices.mosfets.M8.getAnchorPointWithTransformations("Vg")),new g(...t.devices.mosfets.M7.getAnchorPointWithTransformations("Vg_mirror_gate"),...t.devices.mosfets.M7.getAnchorPointWithTransformations("Vg_mirror_corner")),new g(...t.devices.mosfets.M7.getAnchorPointWithTransformations("Vg_mirror_drain"),...t.devices.mosfets.M7.getAnchorPointWithTransformations("Vg_mirror_corner"))],voltageDisplayLabel:"",voltageDisplayLocations:[]},{node:t.nodes.Vout,lines:[new g(...t.devices.mosfets.M8.getAnchorPointWithTransformations("Vd"),...t.devices.mosfets.M4.getAnchorPointWithTransformations("Vd")),new g(l.transformations,{x:24,y:-5},l.transformations,{x:28,y:-5})],voltageDisplayLabel:"Vout",voltageDisplayLocations:[new b(l.transformations,{x:28.5,y:-5})]}]),t.finishSetup(),t},cn=()=>{const t=new Qt("pMosSingle",{x:0,y:3},10,20);t.nodes={[v]:w(new C(0,!0)),[D]:w(new C(5,!0)),M1_drain:w(new C(2,!1)),M1_gate:w(new C(1,!1))};const s=new T(t.transformations,A(()=>it([{start:{x:0,y:4},end:{x:0,y:-2}}],H(0,5,t.nodes.M1_drain.value.voltage)/5))),e=new T(t.transformations,A(()=>({x:0,y:4}))),i=new T(t.transformations,A(()=>t.devices.mosfets.M1.selected.value?{x:7,y:0}:{x:0,y:0}));return t.boundingBox=[new b(t.transformations,{x:-5,y:-6}),new b(i.transformations,{x:5,y:-6}),new b(e.transformations,{x:-5,y:12}),new b(e.transformations,{x:5,y:12})],t.devices.mosfets={M1:new N(t.transformations,"pmos",0,0,t.nodes.M1_gate,t.nodes[D],t.nodes.M1_drain,t.nodes[D],t.nodes[v],3,5,!1,"visible","visible","furtherGate")},t.devices.mosfets.M1.vgsChart.originalVisibility="visible",t.devices.mosfets.M1.vdsChart.originalVisibility="visible",t.devices.voltageSources={Vd:new nt(s.transformations,{x:0,y:6},t.nodes[v],t.nodes.M1_drain,"Vd","gnd",!0)},t.schematic=new Pt(t.transformations,[new q(e.transformations,{x:0,y:8})],[new ft(...t.devices.mosfets.M1.getAnchorPointWithTransformations("Vs"))],[],Object.values(t.devices.mosfets),Object.values(t.nodes),[{node:t.nodes.M1_drain,lines:[new g(...t.devices.mosfets.M1.getAnchorPointWithTransformations("Vd"),...t.devices.voltageSources.Vd.getAnchorPointWithTransformations("Vplus"))],voltageDisplayLabel:"Drain",voltageDisplayLocations:[new b(s.transformations,{x:.5,y:4.5})]},{node:t.nodes[v],lines:[new g(e.transformations,{x:0,y:8},...t.devices.voltageSources.Vd.getAnchorPointWithTransformations("Vminus"))],voltageDisplayLabel:"",voltageDisplayLocations:[]}]),t.finishSetup(),t},hn={nMosSingle:an(),nMosDiffPair:on(),pMosSingle:cn(),nMos5TransistorOpAmp:rn(),nMos9TransistorOpAmp:ln()},dn=(t,s=10)=>{for(let e in t.nodes){const i=t.nodes[e];i.value.netCurrent=0}for(let e in t.devices.mosfets){const i=t.devices.mosfets[e],n=i.getMosfetCurrent();i.mosfetType=="nmos"?(i.Vd.value.netCurrent-=n,i.Vs.value.netCurrent+=n):i.mosfetType=="pmos"&&(i.Vd.value.netCurrent+=n,i.Vs.value.netCurrent-=n)}for(let e in t.devices.voltageSources){const i=t.devices.voltageSources[e];i.fixedAt=="gnd"?(i.current=i.vplus.value.netCurrent,i.vminus.value.netCurrent+=i.current,i.vplus.value.netCurrent=0):i.fixedAt=="vdd"?(i.current=-i.vminus.value.netCurrent,i.vplus.value.netCurrent+=i.current,i.vminus.value.netCurrent=0):console.log("Cannot solve voltage source not attached to GND or VDD")}for(let e in t.nodes){const i=t.nodes[e];if(e==v){i.value.voltage=0;continue}if(e==D){i.value.voltage=5;continue}if(i.value.fixed)continue;fn(i);let n=i.value.netCurrent/i.value.capacitance*(s/1e3)*.5;n>.1?n=.1:n<-.1&&(n=-.1),i.value.voltage+=n,i.value.historicVoltages.dequeue(),i.value.historicVoltages.enqueue(i.value.voltage)}},fn=t=>{let s=0,e=0,i=!0;t.value.historicVoltages.toArray().forEach((n,a)=>{const o=n-e>0;n-e==0||o!==i&&(s+=1),i=o,e=n,a<=1&&(s=0)}),s>=2&&(t.value.capacitance+=t.value.originalCapacitance),t.value.capacitance<t.value.originalCapacitance&&(t.value.capacitance=t.value.originalCapacitance)},ai=Object.fromEntries(Object.entries(hn).map(([t,s])=>[t,s.copy()]));let os="nMosDiffPair",ze=ai[os];onmessage=function(t){const s=JSON.parse(t.data);s[0]!=os&&(ze=ai[s[0]],os=s[0]),ze.nodeVoltagesFromJson(t.data),postMessage(ze.nodeVoltagesToJson())};const oi=20,ri=()=>{dn(ze,oi),setTimeout(ri,oi)};ri()})();
