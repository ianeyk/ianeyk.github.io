var ra=Object.defineProperty;var la=(j,F,q)=>F in j?ra(j,F,{enumerable:!0,configurable:!0,writable:!0,value:q}):j[F]=q;var h=(j,F,q)=>(la(j,typeof F!="symbol"?F+"":F,q),q),js=(j,F,q)=>{if(!F.has(j))throw TypeError("Cannot "+q)};var r=(j,F,q)=>(js(j,F,"read from private field"),q?q.call(j):F.get(j)),A=(j,F,q)=>{if(F.has(j))throw TypeError("Cannot add the same private member more than once");F instanceof WeakSet?F.add(j):F.set(j,q)},V=(j,F,q,p)=>(js(j,F,"write to private field"),p?p.call(j,q):F.set(j,q),q);var is=(j,F,q,p)=>({set _(R){V(j,F,R,q)},get _(){return r(j,F,p)}}),m=(j,F,q)=>(js(j,F,"access private method"),q);(function(){"use strict";var Fi,gt,xe,he,Ve,Se,vt,mt,Y,Te,K,N,_,ne,de,se,X,_e,$,Ae,Ce,fe,Pe,qe,ae,Lt,Ns,st,Ie,Wt,ue,ss,Ii,it,pt,Ot,Le,Ke,We,Je,Et,Gs,oa,yt,ns,bt,as,z,G,Rt,Hs,nt,Ft,Oe,Ye,kt,Bs;const p="GND",R="VDD";var ji=Object.defineProperty,Ni=(e,s,t)=>s in e?ji(e,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[s]=t,Mt=(e,s,t)=>(Ni(e,typeof s!="symbol"?s+"":s,t),t);class te{constructor(s,t,i){Mt(this,"_rows"),Mt(this,"_columns"),Mt(this,"_values"),this._rows=Math.max(s,1),this._columns=Math.max(t,1),this._values=new Array(this._rows).fill([]).map(()=>new Array(this._columns).fill(0)),i&&(this.values=i)}get rows(){return this._rows}get columns(){return this._columns}get values(){return this._values}set values(s){const t=Math.min(s.length,this.rows),i=Math.min(s[0].length,this.columns);for(let n=0;n<t;n++)for(let a=0;a<i;a++)this.values[n][a]=s[n][a]}at(s,t){return this.values[s][t]}reset(){this.values=this.values.map(s=>s.map(()=>0))}addAColumn(){return new te(this.rows,this.columns+1,this.values)}addARow(){return new te(this.rows+1,this.columns,this.values)}equals(s){return this.rows===s.rows&&this.columns===s.columns&&this.values.reduce((t,i,n)=>t&&i.reduce((a,o,l)=>a&&s.at(n,l)===o,t),!0)}setAsIdentity(){if(this.rows!==this.columns)throw new Error("Dimension error! The matrix isn't squared!");return this.values.forEach((s,t)=>{s.forEach((i,n)=>{this.values[t][n]=t===n?1:0})}),this}static identity(s){if(s<1)throw Error("Dimension error! Matrix dimension must be positive.");return new te(s,s).setAsIdentity()}multiply(s){if(this.columns!==s.rows)throw new Error("Dimension error! The operand matrix must have the same number of rows as 'this' matrix columns!");const t=new te(this.rows,s.columns);return t.values=t.values.map((i,n)=>i.map((a,o)=>this.values[n].reduce((l,c,d)=>l+c*s.at(d,o),0))),t}indexOf(s){for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)if(this.values[t][i]===s)return[t,i];return[-1,-1]}max(){return this.values.reduce((s,t)=>Math.max(s,...t),-1/0)}min(){return this.values.reduce((s,t)=>Math.min(s,...t),1/0)}round(){return new te(this.rows,this.columns,this.values.map(s=>s.map(t=>Math.round(t))))}determinant(){if(this.rows!==this.columns)throw new Error("Dimension error! The matrix isn't squared!");if(this.rows===this.columns&&this.columns===1)return this.values[0][0];let s=0,t=1;if(this.rows===2)s=this.values[0][0]*this.values[1][1]-this.values[1][0]*this.values[0][1];else for(let i=0;i<this.rows;i++){const n=this.getCofactor(0,i);s+=t*this.at(0,i)*n.determinant(),t=-t}return s}getCofactor(s,t){return new te(this.rows-1,this.columns-1,this.values.filter((i,n)=>n!==s).map(i=>i.filter((n,a)=>a!==t)))}transpose(){return new te(this.columns,this.rows,new Array(this.columns).fill([]).map((s,t)=>new Array(this.rows).fill(0).map((i,n)=>this.at(n,t))))}inverse(){if(this.rows!==this.columns)throw new Error("Dimension error! The matrix isn't squared!");const s=this.determinant();if(s===0)throw new Error("Determinant is 0, can't compute inverse.");const t=new te(this.rows,this.columns,this.values.map((i,n)=>i.map((a,o)=>Math.pow(-1,n+o)*this.getCofactor(n,o).determinant()))).transpose();return new te(this.rows,this.columns,this.values.map((i,n)=>i.map((a,o)=>t.at(n,o)/s)))}toString(){return`[${this.values.map(s=>`[${s.join(", ")}]`).join(`,
`)}]`}}const Gi=1e-5,pe=class{constructor(e){Mt(this,"values",new Float32Array(4)),e!==void 0&&(this.xyzw=e)}get x(){return this.values[0]}set x(e){this.values[0]=e}get y(){return this.values[1]}set y(e){this.values[1]=e}get z(){return this.values[2]}set z(e){this.values[2]=e}get w(){return this.values[3]}set w(e){this.values[3]=e}get xy(){return[this.values[0],this.values[1]]}set xy(e){this.values[0]=e[0],this.values[1]=e[1]}get xyz(){return[this.values[0],this.values[1],this.values[2]]}set xyz(e){this.values[0]=e[0],this.values[1]=e[1],this.values[2]=e[2]}get xyzw(){return[this.values[0],this.values[1],this.values[2],this.values[3]]}set xyzw(e){this.values[0]=e[0],this.values[1]=e[1],this.values[2]=e[2],this.values[3]=e[3]}at(e){return this.values[e]}reset(){for(let e=0;e<4;e++)this.values[e]=0}copy(e){e||(e=new pe);for(let s=0;s<4;s++)e.values[s]=this.values[s];return e}roll(){const e=this.x,s=this.y,t=this.z,i=this.w;return Math.atan2(2*(e*s+i*t),i*i+e*e-s*s-t*t)}pitch(){const e=this.x,s=this.y,t=this.z,i=this.w;return Math.atan2(2*(s*t+i*e),i*i-e*e-s*s+t*t)}yaw(){return Math.asin(2*(this.x*this.z-this.w*this.y))}equals(e,s=Gi){for(let t=0;t<4;t++)if(Math.abs(this.values[t]-e.at(t))>s)return!1;return!0}setIdentity(){return this.x=0,this.y=0,this.z=0,this.w=1,this}calculateW(){const e=this.x,s=this.y,t=this.z;return this.w=-Math.sqrt(Math.abs(1-e*e-s*s-t*t)),this}inverse(){const e=pe.dot(this,this);if(!e)return this.xyzw=[0,0,0,0],this;const s=e?1/e:0;return this.x*=-s,this.y*=-s,this.z*=-s,this.w*=s,this}conjugate(){return this.values[0]*=-1,this.values[1]*=-1,this.values[2]*=-1,this}length(){const e=this.x,s=this.y,t=this.z,i=this.w;return Math.sqrt(e*e+s*s+t*t+i*i)}normalize(e){e||(e=this);const s=this.x,t=this.y,i=this.z,n=this.w;let a=Math.sqrt(s*s+t*t+i*i+n*n);return a?(a=1/a,e.x=s*a,e.y=t*a,e.z=i*a,e.w=n*a,e):(e.x=0,e.y=0,e.z=0,e.w=0,e)}add(e){for(let s=0;s<4;s++)this.values[s]+=e.at(s);return this}multiply(e){const s=this.values[0],t=this.values[1],i=this.values[2],n=this.values[3],a=e.x,o=e.y,l=e.z,c=e.w;return this.x=s*c+n*a+t*l-i*o,this.y=t*c+n*o+i*a-s*l,this.z=i*c+n*l+s*o-t*a,this.w=n*c-s*a-t*o-i*l,this}static dot(e,s){return e.x*s.x+e.y*s.y+e.z*s.z+e.w*s.w}static sum(e,s){const t=new pe;return t.x=e.x+s.x,t.y=e.y+s.y,t.z=e.z+s.z,t.w=e.w+s.w,t}static product(e,s){const t=new pe,i=e.x,n=e.y,a=e.z,o=e.w,l=s.x,c=s.y,d=s.z,f=s.w;return t.x=i*f+o*l+n*d-a*c,t.y=n*f+o*c+a*l-i*d,t.z=a*f+o*d+i*c-n*l,t.w=o*f-i*l-n*c-a*d,t}static cross(e,s){const t=new pe,i=e.x,n=e.y,a=e.z,o=e.w,l=s.x,c=s.y,d=s.z,f=s.w;return t.x=o*d+a*f+i*c-n*l,t.y=o*f-i*l-n*c-a*d,t.z=o*l+i*f+n*d-a*c,t.w=o*c+n*f+a*l-i*d,t}static shortMix(e,s,t){const i=new pe;if(t<=0)return i.xyzw=e.xyzw,i;if(t>=1)return i.xyzw=s.xyzw,i;let n=pe.dot(e,s);const a=s.copy();n<0&&(a.inverse(),n=-n);let o,l;if(n>.9999)o=1-t,l=0+t;else{const c=Math.sqrt(1-n*n),d=Math.atan2(c,n),f=1/c;o=Math.sin((1-t)*d)*f,l=Math.sin((0+t)*d)*f}return i.x=o*e.x+l*a.x,i.y=o*e.y+l*a.y,i.z=o*e.z+l*a.z,i.w=o*e.w+l*a.w,i}static mix(e,s,t){const i=new pe,n=e.x*s.x+e.y*s.y+e.z*s.z+e.w*s.w;if(Math.abs(n)>=1)return i.xyzw=e.xyzw,i;const a=Math.acos(n),o=Math.sqrt(1-n*n);if(Math.abs(o)<.001)return i.x=e.x*.5+s.x*.5,i.y=e.y*.5+s.y*.5,i.z=e.z*.5+s.z*.5,i.w=e.w*.5+s.w*.5,i;const l=Math.sin((1-t)*a)/o,c=Math.sin(t*a)/o;return i.x=e.x*l+s.x*c,i.y=e.y*l+s.y*c,i.z=e.z*l+s.z*c,i.w=e.w*l+s.w*c,i}static fromAxisAngle(e,s){if(e.rows!==3)throw new Error("The axis vector must be in 3D!");const t=new pe;s*=.5;const i=Math.sin(s);return t.x=e.at(0)*i,t.y=e.at(1)*i,t.z=e.at(2)*i,t.w=Math.cos(s),t}};Mt(pe,"identity",new pe().setIdentity());class W{constructor(){h(this,"matrix");this.matrix=new te(3,3,[[1,0,0],[0,1,0],[0,0,1]])}get scaleX(){return Math.sqrt(this.matrix.at(0,0)**2+this.matrix.at(1,0)**2)}get scaleY(){return Math.sqrt(this.matrix.at(0,1)**2+this.matrix.at(1,1)**2)}get relativeScale(){return Math.sqrt(Math.abs(this.matrix.determinant()))}get rotation(){return Math.atan2(-1*this.matrix.at(0,1),this.matrix.at(0,0))}get isMirrored(){return this.matrix.determinant()<0}get translation(){return{x:this.matrix.at(0,2),y:this.matrix.at(1,2)}}set scaleX(s){this.scale(1/this.scaleX,1,!0),this.scale(s,1,!0)}set scaleY(s){this.scale(1,1/this.scaleY,!0),this.scale(1,s,!0)}set relativeScale(s){this.scale(1/this.relativeScale,1/this.relativeScale,!0),this.scale(s,s,!0)}set rotation(s){this.rotate(-this.rotation,!0),this.rotate(s,!0)}set isMirrored(s){this.isMirrored!=s&&this.mirror(!0,!1,!0)}set translation(s){this.translate({x:-this.translation.x,y:-this.translation.y},!0),this.translate(s,!0)}rotate(s,t=!1){const i=new W;return Object.assign(i,this),i.matrix=this.matrix.multiply(new te(3,3,[[Math.cos(s),-Math.sin(s),0],[Math.sin(s),Math.cos(s),0],[0,0,1]])),t&&Object.assign(this,i),i}translate(s,t=!1){const i=new W;return Object.assign(i,this),i.matrix=this.matrix.multiply(new te(3,3,[[1,0,s.x],[0,1,s.y],[0,0,1]])),t&&Object.assign(this,i),i}mirror(s,t=!1,i=!1){const n=new W;Object.assign(n,this);const a=s?-1:1,o=t?-1:1;return n.matrix=this.matrix.multiply(new te(3,3,[[a,0,0],[0,o,0],[0,0,1]])),i&&Object.assign(this,n),n}scale(s,t=s,i=!1){const n=new W;return Object.assign(n,this),n.matrix=this.matrix.multiply(new te(3,3,[[s,0,0],[0,t,0],[0,0,1]])),i&&Object.assign(this,n),n}inverse(s=!1){const t=new W;return Object.assign(t,this),t.matrix=t.matrix.inverse(),s&&Object.assign(this,t),t}multiply(s,t=!1){const i=new W;return Object.assign(i,this),i.matrix=i.matrix.multiply(s.matrix),t&&Object.assign(this,i),i}transformCanvas(s,t=!0){t?s.setTransform(this.matrix.at(0,0),this.matrix.at(1,0),this.matrix.at(0,1),this.matrix.at(1,1),this.matrix.at(0,2),this.matrix.at(1,2)):s.transform(this.matrix.at(0,0),this.matrix.at(1,0),this.matrix.at(0,1),this.matrix.at(1,1),this.matrix.at(0,2),this.matrix.at(1,2))}transformPoint(s){const t=this.matrix.multiply(new te(3,1,[[s.x],[s.y],[1]]));return{x:t.at(0,0),y:t.at(1,0)}}transformLine(s){return{start:this.transformPoint(s.start),end:this.transformPoint(s.end)}}transformPath(s){return s.map(t=>this.transformLine(t))}}/**
* @vue/shared v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**//*! #__NO_SIDE_EFFECTS__ */function Hi(e){const s=Object.create(null);for(const t of e.split(","))s[t]=1;return t=>t in s}const os={},It=()=>{},Us=Object.assign,Bi=Object.prototype.hasOwnProperty,rs=(e,s)=>Bi.call(e,s),ye=Array.isArray,xt=e=>jt(e)==="[object Map]",Ui=e=>jt(e)==="[object Set]",je=e=>typeof e=="function",qi=e=>typeof e=="string",Vt=e=>typeof e=="symbol",at=e=>e!==null&&typeof e=="object",Ki=e=>(at(e)||je(e))&&je(e.then)&&je(e.catch),Ji=Object.prototype.toString,jt=e=>Ji.call(e),Yi=e=>jt(e).slice(8,-1),Xi=e=>jt(e)==="[object Object]",ls=e=>qi(e)&&e!=="NaN"&&e[0]!=="-"&&""+parseInt(e,10)===e,Ne=(e,s)=>!Object.is(e,s);let qs;const cs=()=>qs||(qs=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});/**
* @vue/reactivity v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let I;const hs=new WeakSet;class $i{constructor(s){this.fn=s,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0}pause(){this.flags|=64}resume(){this.flags&64&&(this.flags&=-65,hs.has(this)&&(hs.delete(this),this.trigger()))}notify(){this.flags&2&&!(this.flags&32)||this.flags&8||Js(this)}run(){if(!(this.flags&1))return this.fn();this.flags|=2,Zs(this),Ys(this);const s=I,t=be;I=this,be=!0;try{return this.fn()}finally{Xs(this),I=s,be=t,this.flags&=-3}}stop(){if(this.flags&1){for(let s=this.deps;s;s=s.nextDep)gs(s);this.deps=this.depsTail=void 0,Zs(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){this.flags&64?hs.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){us(this)&&this.run()}get dirty(){return us(this)}}let Ks=0,St,Tt;function Js(e,s=!1){if(e.flags|=8,s){e.next=Tt,Tt=e;return}e.next=St,St=e}function ds(){Ks++}function fs(){if(--Ks>0)return;if(Tt){let s=Tt;for(Tt=void 0;s;){const t=s.next;s.next=void 0,s.flags&=-9,s=t}}let e;for(;St;){let s=St;for(St=void 0;s;){const t=s.next;if(s.next=void 0,s.flags&=-9,s.flags&1)try{s.trigger()}catch(i){e||(e=i)}s=t}}if(e)throw e}function Ys(e){for(let s=e.deps;s;s=s.nextDep)s.version=-1,s.prevActiveLink=s.dep.activeLink,s.dep.activeLink=s}function Xs(e){let s,t=e.depsTail,i=t;for(;i;){const n=i.prevDep;i.version===-1?(i===t&&(t=n),gs(i),Qi(i)):s=i,i.dep.activeLink=i.prevActiveLink,i.prevActiveLink=void 0,i=n}e.deps=s,e.depsTail=t}function us(e){for(let s=e.deps;s;s=s.nextDep)if(s.dep.version!==s.version||s.dep.computed&&($s(s.dep.computed)||s.dep.version!==s.version))return!0;return!!e._dirty}function $s(e){if(e.flags&4&&!(e.flags&16)||(e.flags&=-17,e.globalVersion===_t))return;e.globalVersion=_t;const s=e.dep;if(e.flags|=2,s.version>0&&!e.isSSR&&e.deps&&!us(e)){e.flags&=-3;return}const t=I,i=be;I=e,be=!0;try{Ys(e);const n=e.fn(e._value);(s.version===0||Ne(n,e._value))&&(e._value=n,s.version++)}catch(n){throw s.version++,n}finally{I=t,be=i,Xs(e),e.flags&=-3}}function gs(e,s=!1){const{dep:t,prevSub:i,nextSub:n}=e;if(i&&(i.nextSub=n,e.prevSub=void 0),n&&(n.prevSub=i,e.nextSub=void 0),t.subs===e&&(t.subs=i,!i&&t.computed)){t.computed.flags&=-5;for(let a=t.computed.deps;a;a=a.nextDep)gs(a,!0)}!s&&!--t.sc&&t.map&&t.map.delete(t.key)}function Qi(e){const{prevDep:s,nextDep:t}=e;s&&(s.nextDep=t,e.prevDep=void 0),t&&(t.prevDep=s,e.nextDep=void 0)}let be=!0;const Qs=[];function vs(){Qs.push(be),be=!1}function ms(){const e=Qs.pop();be=e===void 0?!0:e}function Zs(e){const{cleanup:s}=e;if(e.cleanup=void 0,s){const t=I;I=void 0;try{s()}finally{I=t}}}let _t=0;class Zi{constructor(s,t){this.sub=s,this.dep=t,this.version=t.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class ps{constructor(s){this.computed=s,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0}track(s){if(!I||!be||I===this.computed)return;let t=this.activeLink;if(t===void 0||t.sub!==I)t=this.activeLink=new Zi(I,this),I.deps?(t.prevDep=I.depsTail,I.depsTail.nextDep=t,I.depsTail=t):I.deps=I.depsTail=t,ei(t);else if(t.version===-1&&(t.version=this.version,t.nextDep)){const i=t.nextDep;i.prevDep=t.prevDep,t.prevDep&&(t.prevDep.nextDep=i),t.prevDep=I.depsTail,t.nextDep=void 0,I.depsTail.nextDep=t,I.depsTail=t,I.deps===t&&(I.deps=i)}return t}trigger(s){this.version++,_t++,this.notify(s)}notify(s){ds();try{for(let t=this.subs;t;t=t.prevSub)t.sub.notify()&&t.sub.dep.notify()}finally{fs()}}}function ei(e){if(e.dep.sc++,e.sub.flags&4){const s=e.dep.computed;if(s&&!e.dep.subs){s.flags|=20;for(let i=s.deps;i;i=i.nextDep)ei(i)}const t=e.dep.subs;t!==e&&(e.prevSub=t,t&&(t.nextSub=e)),e.dep.subs=e}}const ys=new WeakMap,Xe=Symbol(""),bs=Symbol(""),At=Symbol("");function oe(e,s,t){if(be&&I){let i=ys.get(e);i||ys.set(e,i=new Map);let n=i.get(t);n||(i.set(t,n=new ps),n.map=i,n.key=t),n.track()}}function Ge(e,s,t,i,n,a){const o=ys.get(e);if(!o){_t++;return}const l=c=>{c&&c.trigger()};if(ds(),s==="clear")o.forEach(l);else{const c=ye(e),d=c&&ls(t);if(c&&t==="length"){const f=Number(i);o.forEach((u,b)=>{(b==="length"||b===At||!Vt(b)&&b>=f)&&l(u)})}else switch((t!==void 0||o.has(void 0))&&l(o.get(t)),d&&l(o.get(At)),s){case"add":c?d&&l(o.get("length")):(l(o.get(Xe)),xt(e)&&l(o.get(bs)));break;case"delete":c||(l(o.get(Xe)),xt(e)&&l(o.get(bs)));break;case"set":xt(e)&&l(o.get(Xe));break}}fs()}function ot(e){const s=k(e);return s===e?s:(oe(s,"iterate",At),we(e)?s:s.map(ie))}function ws(e){return oe(e=k(e),"iterate",At),e}const en={__proto__:null,[Symbol.iterator](){return Ms(this,Symbol.iterator,ie)},concat(...e){return ot(this).concat(...e.map(s=>ye(s)?ot(s):s))},entries(){return Ms(this,"entries",e=>(e[1]=ie(e[1]),e))},every(e,s){return Re(this,"every",e,s,void 0,arguments)},filter(e,s){return Re(this,"filter",e,s,t=>t.map(ie),arguments)},find(e,s){return Re(this,"find",e,s,ie,arguments)},findIndex(e,s){return Re(this,"findIndex",e,s,void 0,arguments)},findLast(e,s){return Re(this,"findLast",e,s,ie,arguments)},findLastIndex(e,s){return Re(this,"findLastIndex",e,s,void 0,arguments)},forEach(e,s){return Re(this,"forEach",e,s,void 0,arguments)},includes(...e){return xs(this,"includes",e)},indexOf(...e){return xs(this,"indexOf",e)},join(e){return ot(this).join(e)},lastIndexOf(...e){return xs(this,"lastIndexOf",e)},map(e,s){return Re(this,"map",e,s,void 0,arguments)},pop(){return Ct(this,"pop")},push(...e){return Ct(this,"push",e)},reduce(e,...s){return ti(this,"reduce",e,s)},reduceRight(e,...s){return ti(this,"reduceRight",e,s)},shift(){return Ct(this,"shift")},some(e,s){return Re(this,"some",e,s,void 0,arguments)},splice(...e){return Ct(this,"splice",e)},toReversed(){return ot(this).toReversed()},toSorted(e){return ot(this).toSorted(e)},toSpliced(...e){return ot(this).toSpliced(...e)},unshift(...e){return Ct(this,"unshift",e)},values(){return Ms(this,"values",ie)}};function Ms(e,s,t){const i=ws(e),n=i[s]();return i!==e&&!we(e)&&(n._next=n.next,n.next=()=>{const a=n._next();return a.value&&(a.value=t(a.value)),a}),n}const tn=Array.prototype;function Re(e,s,t,i,n,a){const o=ws(e),l=o!==e&&!we(e),c=o[s];if(c!==tn[s]){const u=c.apply(e,a);return l?ie(u):u}let d=t;o!==e&&(l?d=function(u,b){return t.call(this,ie(u),b,e)}:t.length>2&&(d=function(u,b){return t.call(this,u,b,e)}));const f=c.call(o,d,i);return l&&n?n(f):f}function ti(e,s,t,i){const n=ws(e);let a=t;return n!==e&&(we(e)?t.length>3&&(a=function(o,l,c){return t.call(this,o,l,c,e)}):a=function(o,l,c){return t.call(this,o,ie(l),c,e)}),n[s](a,...i)}function xs(e,s,t){const i=k(e);oe(i,"iterate",At);const n=i[s](...t);return(n===-1||n===!1)&&pn(t[0])?(t[0]=k(t[0]),i[s](...t)):n}function Ct(e,s,t=[]){vs(),ds();const i=k(e)[s].apply(e,t);return fs(),ms(),i}const sn=Hi("__proto__,__v_isRef,__isVue"),si=new Set(Object.getOwnPropertyNames(Symbol).filter(e=>e!=="arguments"&&e!=="caller").map(e=>Symbol[e]).filter(Vt));function nn(e){Vt(e)||(e=String(e));const s=k(this);return oe(s,"has",e),s.hasOwnProperty(e)}class ii{constructor(s=!1,t=!1){this._isReadonly=s,this._isShallow=t}get(s,t,i){if(t==="__v_skip")return s.__v_skip;const n=this._isReadonly,a=this._isShallow;if(t==="__v_isReactive")return!n;if(t==="__v_isReadonly")return n;if(t==="__v_isShallow")return a;if(t==="__v_raw")return i===(n?a?gn:oi:a?un:ai).get(s)||Object.getPrototypeOf(s)===Object.getPrototypeOf(i)?s:void 0;const o=ye(s);if(!n){let c;if(o&&(c=en[t]))return c;if(t==="hasOwnProperty")return nn}const l=Reflect.get(s,t,ke(s)?s:i);return(Vt(t)?si.has(t):sn(t))||(n||oe(s,"get",t),a)?l:ke(l)?o&&ls(t)?l:l.value:at(l)?n?li(l):ri(l):l}}class an extends ii{constructor(s=!1){super(!1,s)}set(s,t,i,n){let a=s[t];if(!this._isShallow){const c=$e(a);if(!we(i)&&!$e(i)&&(a=k(a),i=k(i)),!ye(s)&&ke(a)&&!ke(i))return c?!1:(a.value=i,!0)}const o=ye(s)&&ls(t)?Number(t)<s.length:rs(s,t),l=Reflect.set(s,t,i,ke(s)?s:n);return s===k(n)&&(o?Ne(i,a)&&Ge(s,"set",t,i):Ge(s,"add",t,i)),l}deleteProperty(s,t){const i=rs(s,t);s[t];const n=Reflect.deleteProperty(s,t);return n&&i&&Ge(s,"delete",t,void 0),n}has(s,t){const i=Reflect.has(s,t);return(!Vt(t)||!si.has(t))&&oe(s,"has",t),i}ownKeys(s){return oe(s,"iterate",ye(s)?"length":Xe),Reflect.ownKeys(s)}}class on extends ii{constructor(s=!1){super(!0,s)}set(s,t){return!0}deleteProperty(s,t){return!0}}const rn=new an,ln=new on,Vs=e=>e,Nt=e=>Reflect.getPrototypeOf(e);function cn(e,s,t){return function(...i){const n=this.__v_raw,a=k(n),o=xt(a),l=e==="entries"||e===Symbol.iterator&&o,c=e==="keys"&&o,d=n[e](...i),f=t?Vs:s?Ss:ie;return!s&&oe(a,"iterate",c?bs:Xe),{next(){const{value:u,done:b}=d.next();return b?{value:u,done:b}:{value:l?[f(u[0]),f(u[1])]:f(u),done:b}},[Symbol.iterator](){return this}}}}function Gt(e){return function(...s){return e==="delete"?!1:e==="clear"?void 0:this}}function hn(e,s){const t={get(n){const a=this.__v_raw,o=k(a),l=k(n);e||(Ne(n,l)&&oe(o,"get",n),oe(o,"get",l));const{has:c}=Nt(o),d=s?Vs:e?Ss:ie;if(c.call(o,n))return d(a.get(n));if(c.call(o,l))return d(a.get(l));a!==o&&a.get(n)},get size(){const n=this.__v_raw;return!e&&oe(k(n),"iterate",Xe),Reflect.get(n,"size",n)},has(n){const a=this.__v_raw,o=k(a),l=k(n);return e||(Ne(n,l)&&oe(o,"has",n),oe(o,"has",l)),n===l?a.has(n):a.has(n)||a.has(l)},forEach(n,a){const o=this,l=o.__v_raw,c=k(l),d=s?Vs:e?Ss:ie;return!e&&oe(c,"iterate",Xe),l.forEach((f,u)=>n.call(a,d(f),d(u),o))}};return Us(t,e?{add:Gt("add"),set:Gt("set"),delete:Gt("delete"),clear:Gt("clear")}:{add(n){!s&&!we(n)&&!$e(n)&&(n=k(n));const a=k(this);return Nt(a).has.call(a,n)||(a.add(n),Ge(a,"add",n,n)),this},set(n,a){!s&&!we(a)&&!$e(a)&&(a=k(a));const o=k(this),{has:l,get:c}=Nt(o);let d=l.call(o,n);d||(n=k(n),d=l.call(o,n));const f=c.call(o,n);return o.set(n,a),d?Ne(a,f)&&Ge(o,"set",n,a):Ge(o,"add",n,a),this},delete(n){const a=k(this),{has:o,get:l}=Nt(a);let c=o.call(a,n);c||(n=k(n),c=o.call(a,n)),l&&l.call(a,n);const d=a.delete(n);return c&&Ge(a,"delete",n,void 0),d},clear(){const n=k(this),a=n.size!==0,o=n.clear();return a&&Ge(n,"clear",void 0,void 0),o}}),["keys","values","entries",Symbol.iterator].forEach(n=>{t[n]=cn(n,e,s)}),t}function ni(e,s){const t=hn(e,s);return(i,n,a)=>n==="__v_isReactive"?!e:n==="__v_isReadonly"?e:n==="__v_raw"?i:Reflect.get(rs(t,n)&&n in i?t:i,n,a)}const dn={get:ni(!1,!1)},fn={get:ni(!0,!1)},ai=new WeakMap,un=new WeakMap,oi=new WeakMap,gn=new WeakMap;function vn(e){switch(e){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function mn(e){return e.__v_skip||!Object.isExtensible(e)?0:vn(Yi(e))}function ri(e){return $e(e)?e:ci(e,!1,rn,dn,ai)}function li(e){return ci(e,!0,ln,fn,oi)}function ci(e,s,t,i,n){if(!at(e)||e.__v_raw&&!(s&&e.__v_isReactive))return e;const a=n.get(e);if(a)return a;const o=mn(e);if(o===0)return e;const l=new Proxy(e,o===2?i:t);return n.set(e,l),l}function Ht(e){return $e(e)?Ht(e.__v_raw):!!(e&&e.__v_isReactive)}function $e(e){return!!(e&&e.__v_isReadonly)}function we(e){return!!(e&&e.__v_isShallow)}function pn(e){return e?!!e.__v_raw:!1}function k(e){const s=e&&e.__v_raw;return s?k(s):e}const ie=e=>at(e)?ri(e):e,Ss=e=>at(e)?li(e):e;function ke(e){return e?e.__v_isRef===!0:!1}function w(e){return yn(e,!1)}function yn(e,s){return ke(e)?e:new bn(e,s)}class bn{constructor(s,t){this.dep=new ps,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=t?s:k(s),this._value=t?s:ie(s),this.__v_isShallow=t}get value(){return this.dep.track(),this._value}set value(s){const t=this._rawValue,i=this.__v_isShallow||we(s)||$e(s);s=i?s:k(s),Ne(s,t)&&(this._rawValue=s,this._value=i?s:ie(s),this.dep.trigger())}}class wn{constructor(s,t,i){this.fn=s,this.setter=t,this._value=void 0,this.dep=new ps(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=_t-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!t,this.isSSR=i}notify(){if(this.flags|=16,!(this.flags&8)&&I!==this)return Js(this,!0),!0}get value(){const s=this.dep.track();return $s(this),s&&(s.version=this.dep.version),this._value}set value(s){this.setter&&this.setter(s)}}function Mn(e,s,t=!1){let i,n;return je(e)?i=e:(i=e.get,n=e.set),new wn(i,n,t)}const Bt={},Ut=new WeakMap;let Qe;function xn(e,s=!1,t=Qe){if(t){let i=Ut.get(t);i||Ut.set(t,i=[]),i.push(e)}}function Vn(e,s,t=os){const{immediate:i,deep:n,once:a,scheduler:o,augmentJob:l,call:c}=t,d=T=>n?T:we(T)||n===!1||n===0?He(T,1):He(T);let f,u,b,y,C=!1,x=!1;if(ke(e)?(u=()=>e.value,C=we(e)):Ht(e)?(u=()=>d(e),C=!0):ye(e)?(x=!0,C=e.some(T=>Ht(T)||we(T)),u=()=>e.map(T=>{if(ke(T))return T.value;if(Ht(T))return d(T);if(je(T))return c?c(T,2):T()})):je(e)?s?u=c?()=>c(e,2):e:u=()=>{if(b){vs();try{b()}finally{ms()}}const T=Qe;Qe=f;try{return c?c(e,3,[y]):e(y)}finally{Qe=T}}:u=It,s&&n){const T=u,E=n===!0?1/0:n;u=()=>He(T(),E)}const S=()=>{f.stop()};if(a&&s){const T=s;s=(...E)=>{T(...E),S()}}let v=x?new Array(e.length).fill(Bt):Bt;const L=T=>{if(!(!(f.flags&1)||!f.dirty&&!T))if(s){const E=f.run();if(n||C||(x?E.some((Q,me)=>Ne(Q,v[me])):Ne(E,v))){b&&b();const Q=Qe;Qe=f;try{const me=[E,v===Bt?void 0:x&&v[0]===Bt?[]:v,y];c?c(s,3,me):s(...me),v=E}finally{Qe=Q}}}else f.run()};return l&&l(L),f=new $i(u),f.scheduler=o?()=>o(L,!1):L,y=T=>xn(T,!1,f),b=f.onStop=()=>{const T=Ut.get(f);if(T){if(c)c(T,4);else for(const E of T)E();Ut.delete(f)}},s?i?L(!0):v=f.run():o?o(L.bind(null,!0),!0):f.run(),S.pause=f.pause.bind(f),S.resume=f.resume.bind(f),S.stop=S,S}function He(e,s=1/0,t){if(s<=0||!at(e)||e.__v_skip||(t=t||new Set,t.has(e)))return e;if(t.add(e),s--,ke(e))He(e.value,s,t);else if(ye(e))for(let i=0;i<e.length;i++)He(e[i],s,t);else if(Ui(e)||xt(e))e.forEach(i=>{He(i,s,t)});else if(Xi(e)){for(const i in e)He(e[i],s,t);for(const i of Object.getOwnPropertySymbols(e))Object.prototype.propertyIsEnumerable.call(e,i)&&He(e[i],s,t)}return e}/**
* @vue/runtime-core v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function Ts(e,s,t,i){try{return i?e(...i):e()}catch(n){di(n,s,t)}}function hi(e,s,t,i){if(je(e)){const n=Ts(e,s,t,i);return n&&Ki(n)&&n.catch(a=>{di(a,s,t)}),n}if(ye(e)){const n=[];for(let a=0;a<e.length;a++)n.push(hi(e[a],s,t,i));return n}}function di(e,s,t,i=!0){const n=s?s.vnode:null,{errorHandler:a,throwUnhandledErrorInProduction:o}=s&&s.appContext.config||os;if(s){let l=s.parent;const c=s.proxy,d=`https://vuejs.org/error-reference/#runtime-${t}`;for(;l;){const f=l.ec;if(f){for(let u=0;u<f.length;u++)if(f[u](e,c,d)===!1)return}l=l.parent}if(a){vs(),Ts(a,null,10,[e,c,d]),ms();return}}Sn(e,t,n,i,o)}function Sn(e,s,t,i=!0,n=!1){if(n)throw e;console.error(e)}const ge=[];let ze=-1;const rt=[];let Be=null,lt=0;const Tn=Promise.resolve();let _s=null;function _n(e){let s=ze+1,t=ge.length;for(;s<t;){const i=s+t>>>1,n=ge[i],a=Pt(n);a<e||a===e&&n.flags&2?s=i+1:t=i}return s}function An(e){if(!(e.flags&1)){const s=Pt(e),t=ge[ge.length-1];!t||!(e.flags&2)&&s>=Pt(t)?ge.push(e):ge.splice(_n(s),0,e),e.flags|=1,fi()}}function fi(){_s||(_s=Tn.then(ui))}function Cn(e){ye(e)?rt.push(...e):Be&&e.id===-1?Be.splice(lt+1,0,e):e.flags&1||(rt.push(e),e.flags|=1),fi()}function Pn(e){if(rt.length){const s=[...new Set(rt)].sort((t,i)=>Pt(t)-Pt(i));if(rt.length=0,Be){Be.push(...s);return}for(Be=s,lt=0;lt<Be.length;lt++){const t=Be[lt];t.flags&4&&(t.flags&=-2),t.flags&8||t(),t.flags&=-2}Be=null,lt=0}}const Pt=e=>e.id==null?e.flags&2?-1:1/0:e.id;function ui(e){try{for(ze=0;ze<ge.length;ze++){const s=ge[ze];s&&!(s.flags&8)&&(s.flags&4&&(s.flags&=-2),Ts(s,s.i,s.i?15:14),s.flags&4||(s.flags&=-2))}}finally{for(;ze<ge.length;ze++){const s=ge[ze];s&&(s.flags&=-2)}ze=-1,ge.length=0,Pn(),_s=null,(ge.length||rt.length)&&ui()}}let Dn=null;cs().requestIdleCallback,cs().cancelIdleCallback;let Ln=null;function Wn(e,s,t=!1){const i=As||Dn;if(i||Ln){const n=i?i.parent==null?i.vnode.appContext&&i.vnode.appContext.provides:i.parent.provides:void 0;if(n&&e in n)return n[e];if(arguments.length>1)return t&&je(s)?s.call(i&&i.proxy):s}}const On=zn,En=Symbol.for("v-scx"),Rn=()=>Wn(En);function gi(e,s,t){return kn(e,s,t)}function kn(e,s,t=os){const{immediate:i,deep:n,flush:a,once:o}=t,l=Us({},t),c=s&&i||!s&&a!=="post";let d;if(qt){if(a==="sync"){const y=Rn();d=y.__watcherHandles||(y.__watcherHandles=[])}else if(!c){const y=()=>{};return y.stop=It,y.resume=It,y.pause=It,y}}const f=As;l.call=(y,C,x)=>hi(y,f,C,x);let u=!1;a==="post"?l.scheduler=y=>{On(y,f&&f.suspense)}:a!=="sync"&&(u=!0,l.scheduler=(y,C)=>{C?y():An(y)}),l.augmentJob=y=>{s&&(y.flags|=4),u&&(y.flags|=2,f&&(y.id=f.uid,y.i=f))};const b=Vn(e,s,l);return qt&&(d?d.push(b):c&&b()),b}function zn(e,s){s&&s.pendingBranch?ye(e)?s.effects.push(...e):s.effects.push(e):Cn(e)}let As=null;{const e=cs(),s=(t,i)=>{let n;return(n=e[t])||(n=e[t]=[]),n.push(i),a=>{n.length>1?n.forEach(o=>o(a)):n[0](a)}};s("__VUE_INSTANCE_SETTERS__",t=>As=t),s("__VUE_SSR_SETTERS__",t=>qt=t)}let qt=!1;const P=(e,s)=>Mn(e,s,qt),vi=(e,s,[t,...i])=>t===void 0?s:vi(e,e(t,s),i),ce=e=>e*Math.PI/180,ct=(e,s)=>(e%s+s)%s,B=(e,s,t)=>{const i=Math.max(e,s),n=Math.min(e,s);return t>i?i:t<n?n:t};class Fn{constructor(){h(this,"updated",w(!1))}react(){this.updated.value=!this.updated.value}}const Me=class Me extends Fn{constructor(t=[],i=new W,n="main"){super();h(this,"transformations",[]);h(this,"anchorPoints",{});h(this,"_transformationMatrix");h(this,"canvasId");h(this,"key","");t.forEach(a=>{this.transformations.push(a)}),this.transformations.push(w(i)),this._transformationMatrix=P(()=>vi((a,o)=>o.multiply(a.value),new W,this.transformations)),Me.allCtxArtists.push(this),this.canvasId=n}get transformationMatrix(){return this._transformationMatrix.value}get localTransformationMatrix(){return this.transformations[this.transformations.length-1].value}getAnchorPoint(t){return this.anchorPoints[t]==null&&console.error("Cannot find anchor point",t,"on CtxArtist"),Me.circuitTransformationMatrix.inverse().multiply(this.transformationMatrix).transformPoint(this.anchorPoints[t])}getAnchorPointWithTransformations(t){return[this.transformations.slice(0,-1),this.getAnchorPoint(t)]}moveTo(t){this.transformations[this.transformations.length-1].value.translation=t}get localLineThickness(){return this.getLocalLineThickness()}fillTextGlobalReferenceFrame(t,i,n,a=!1,o=!1,l=16){if(Me.textTransformationMatrix.transformCanvas(t),a){const d=this.transformationMatrix.transformPoint({x:0,y:0}),f=this.transformationMatrix.transformPoint(i);f.x<d.x==!o?t.textAlign="right":f.x>d.x==!o?t.textAlign="left":t.textAlign="center"}const c=Me.textTransformationMatrix.inverse().transformPoint(this.transformationMatrix.transformPoint(i));return t.fillText(n,c.x,c.y),this.transformationMatrix.transformCanvas(t),this.transformationMatrix.inverse().transformPoint(Me.textTransformationMatrix.transformPoint({x:c.x,y:c.y+l}))}getRelativeScaling(){return Me.textTransformationMatrix.relativeScale/this.transformationMatrix.relativeScale}getLocalLineThickness(t=5){return t*this.getRelativeScaling()}};h(Me,"textTransformationMatrix",new W),h(Me,"circuitTransformationMatrix",new W),h(Me,"allCtxArtists",[]);let Z=Me;const Kt=e=>Math.sqrt((e.end.x-e.start.x)**2+(e.end.y-e.start.y)**2),mi=e=>{let s=0;return e.forEach(t=>{s+=Kt(t)}),s},pi=(e,s)=>(s=B(0,1,s),{x:e.start.x+(e.end.x-e.start.x)*s,y:e.start.y+(e.end.y-e.start.y)*s}),re=(e,s)=>{const t=mi(e),i=s*t;let n=0;for(let a of e){const o=Kt(a);if(n+=o,n>=i){const l=n-o,d=(i-l)/o;return pi(a,d)}}return console.error("Error finding point along path"),{x:0,y:0}},In=(e,s,t,i=5)=>{const n=t.x-s.x,a=t.y-s.y,o=Math.sqrt(n**2+a**2),l=i/2/o*-a,c=i/2/o*n,d=i/2/o*n,f=i/2/o*a,u={x:s.x+l-d,y:s.y+c-f},b={x:s.x-l-d,y:s.y-c-f},y={x:t.x-l+d,y:t.y-c+f},C={x:t.x+l+d,y:t.y+c+f};e.moveTo(u.x,u.y),e.lineTo(b.x,b.y),e.lineTo(y.x,y.y),e.lineTo(C.x,C.y)},jn=(e,s,t)=>{const i=s.outerDiameter,n=i-2*t;e.moveTo(s.center.x,s.center.y),e.arc(s.center.x,s.center.y,i/2,0,2*Math.PI,!1),n>0&&e.arc(s.center.x,s.center.y,n/2,0,2*Math.PI,!0)},yi=(e,s,t,i="rgba(200, 200, 200, 1)")=>{const n=e.createRadialGradient(s.x,s.y,0,s.x,s.y,t);return n.addColorStop(0,i),n.addColorStop(.5,i),n.addColorStop(.99,"rgba(0, 0, 0, 1)"),n.addColorStop(1,"rgba(0, 0, 0, 0)"),n},bi=(e,s)=>()=>{e.save(),e.clip(),e.fillStyle=s,e.fill(),e.resetTransform(),e.fillRect(0,0,e.canvas.clientWidth,e.canvas.clientHeight),e.restore(),e.beginPath()},wi=(e,s="black")=>()=>{e.fillStyle=s,e.fill(),e.beginPath()},Mi=(e,s,t=5,i)=>{const n=bi(e,i);for(let a=0;a<4;a++)xi(e,s,t,n)},De=(e,s,t=5,i="black")=>{const n=wi(e,i);for(let a=0;a<4;a++)xi(e,s,t,n)},xi=(e,s,t=5,i)=>{e.beginPath(),s.forEach(n=>{In(e,n.start,n.end,t),i()})},Nn=(e,s,t=5,i)=>{const n=bi(e,i);Vi(e,s,t,n)},Cs=(e,s,t=5,i="black")=>{const n=wi(e,i);Vi(e,s,t,n)},Vi=(e,s,t=5,i)=>{e.beginPath(),s.forEach(n=>{jn(e,n,t)}),i()},Ze=(e,s,t=3)=>{if(e==0)return"0"+s;const i=e>=0?"":"-",n=Math.abs(e),a={30:"Q",27:"R",24:"Y",21:"Z",18:"E",15:"P",12:"T",9:"G",6:"M",3:"k",0:"","-3":"m","-6":"Âµ","-9":"n","-12":"p","-15":"f","-18":"a","-21":"z","-24":"y","-27":"r","-30":"q"},o=Math.floor(Math.log10(n)/3)*3;let l=a[o.toString()];l==null&&(l="e"+o.toString()+" ");const c=parseFloat((n/10**o).toPrecision(t));return i+c+l+s};class Fe extends Z{constructor(t=[],i=[],n=[],a=[],o=[],l=[],c=[]){super(t,new W);h(this,"gndSymbols");h(this,"vddSymbols");h(this,"parasiticCapacitors");h(this,"mosfets");h(this,"nodes");h(this,"wires");this.gndSymbols=i,this.vddSymbols=n,this.parasiticCapacitors=a,this.mosfets=o,this.nodes=l,this.wires=c}copy(t){return new Fe([t].concat(this.transformations.slice(1)),this.gndSymbols.map(n=>n.copy(t)),this.vddSymbols.map(n=>n.copy(t)),[],this.mosfets,this.nodes,this.wires.map(n=>({node:n.node,lines:n.lines,voltageDisplayLabel:"",voltageDisplayLocations:[]})))}draw(t){this.transformationMatrix.transformCanvas(t),this.gndSymbols.forEach(i=>{i.draw(t)}),this.vddSymbols.forEach(i=>{i.draw(t)}),this.parasiticCapacitors.forEach(i=>{i.draw(t)}),this.transformationMatrix.transformCanvas(t),this.nodes.forEach(i=>{i.value.schematicEffects=[]}),this.mosfets.forEach(i=>{Object.values(i.schematicEffects).forEach(n=>{const a=Fe.flattenSchematicEffect(n);n.node.value.schematicEffects.push(a)})}),this.wires.forEach(i=>{De(t,i.lines.map(n=>n.toLine()),this.localLineThickness,"black"),i.node.value.schematicEffects.forEach(n=>{const a=n.origin,o=yi(t,a,n.gradientSize,n.color);Mi(t,i.lines.map(l=>l.toLine()),this.localLineThickness,o)}),i.voltageDisplayLocations.forEach(n=>{t.fillStyle="black",t.font="18px sans-serif",this.fillTextGlobalReferenceFrame(t,n.toPoint(),i.voltageDisplayLabel+" = "+Ze(i.node.value.voltage,"V"),!1)})})}static flattenSchematicEffect(t){return{origin:t.origin.toPoint(),color:t.color,gradientSize:t.gradientSize}}}class Ps extends Z{constructor(t=[],i=new W,n,a,o,l,c,d,f="visible",u="visible",b="main"){super(t,i);h(this,"visibility");h(this,"originalVisibility");h(this,"fromNode");h(this,"toNode");h(this,"dragging",!1);h(this,"location",{x:0,y:0});h(this,"minValue");h(this,"maxValue");h(this,"value");h(this,"drivenNode");h(this,"canvasId");h(this,"displayText","sliderName");h(this,"selected");h(this,"selectionChanged",w(!1));h(this,"preciseDragging",!1);h(this,"temporaryMinValue");h(this,"temporaryMaxValue");h(this,"previousValue");h(this,"valueRateOfChange",0);this.originalVisibility=f,this.visibility=u,this.fromNode=n,this.toNode=a,this.minValue=l,this.maxValue=c,this.value=l,this.temporaryMinValue=l,this.temporaryMaxValue=c,this.selected=d,this.previousValue=l,this.drivenNode=o,this.canvasId=b,gi(this.selected,()=>{this.selectionChanged.value=!0})}draw(t){throw new Error("draw is a virtual function on the CtxSlider class. (Received"+t+")")}updateLocationBasedOnValue(){throw new Error("updateLocationBasedOnValue is a virtual function on the CtxSlider class.")}updateValueBasedOnMousePosition(t){throw new Error("updateValueBasedOnMousePosition is a virtual function on the CtxSlider class. (Received "+t+")")}mouseDownIntiatesDrag(t){throw new Error("mouseDownIntiatesDrag is a virtual function on the CtxSlider class. (Received "+t+")")}updateValueBasedOnNodeVoltages(){this.value=B(this.temporaryMinValue,this.temporaryMaxValue,this.toNode.value.voltage-this.fromNode.value.voltage),this.updateLocationBasedOnValue()}updateNodeVoltagesBasedOnValue(){this.dragging&&(this.drivenNode=="toNode"?(this.toNode.value.fixed=!0,this.toNode.value.voltage=this.fromNode.value.voltage+this.value):(this.fromNode.value.fixed=!0,this.fromNode.value.voltage=this.toNode.value.voltage-this.value))}dragSlider(t){if(this.dragging){const i=this.transformationMatrix.inverse().transformPoint(t);this.updateValueBasedOnMousePosition(i),this.value=B(this.temporaryMinValue,this.temporaryMaxValue,this.value);const n=B(0,1,(this.value-this.temporaryMinValue)/(this.temporaryMaxValue-this.temporaryMinValue));n<.05&&this.value<=this.previousValue?this.valueRateOfChange=-.01:n>.95&&this.value>=this.previousValue?this.valueRateOfChange=.01:this.valueRateOfChange=0,this.updateLocationBasedOnValue(),this.updateNodeVoltagesBasedOnValue(),this.previousValue=this.value,this.react()}}releaseSlider(){this.temporaryMinValue=this.minValue,this.temporaryMaxValue=this.maxValue,this.preciseDragging=!1,this.dragging=!1,this.drivenNode=="toNode"?this.toNode.value.fixed=!1:this.fromNode.value.fixed=!1,this.react()}adjustPreciseSlider(t=10){if(this.dragging&&this.preciseDragging){if(this.value>=this.maxValue||this.temporaryMaxValue>this.maxValue)this.value=B(this.minValue,this.maxValue,this.value),this.temporaryMaxValue=this.maxValue,this.temporaryMinValue=this.maxValue-1.5,this.valueRateOfChange=0;else if(this.value<=this.minValue||this.temporaryMinValue<this.minValue)this.value=B(this.minValue,this.maxValue,this.value),this.temporaryMinValue=this.minValue,this.temporaryMaxValue=this.minValue+1.5,this.valueRateOfChange=0;else{const i=this.valueRateOfChange*(t/1e3)*70;this.temporaryMinValue+=i,this.temporaryMaxValue+=i,this.value+=i}this.react()}}checkDrag(t,i){if(this.visibility!="visible")return!1;const n=this.transformationMatrix.inverse().transformPoint(t);if(this.mouseDownIntiatesDrag(n)&&(this.dragging=!0),this.dragging){if(i){this.preciseDragging=!0;const a=(this.value-this.minValue)/(this.maxValue-this.minValue);this.temporaryMinValue=this.value-1.5*a,this.temporaryMaxValue=this.value+1.5*(1-a)}else this.temporaryMinValue=this.minValue,this.temporaryMaxValue=this.maxValue;this.react()}}toHtmlSlider(){return new Gn(this.transformations,this.fromNode,this.toNode,this.drivenNode,this.minValue,this.maxValue,this.displayText,this.selected,this.visibility)}}class Gn extends Ps{constructor(t,i,n,a,o,l,c,d,f){super(t,new W,i,n,a,o,l,d,f,f);h(this,"name");h(this,"tabIndex",w(-1));this.name=c}draw(){}updateLocationBasedOnValue(){}updateValueBasedOnMousePosition(){}mouseDownIntiatesDrag(){return this.dragging}}const Si=w(!1),Ti=w(!1);w(!1);const et=w(2),_i=w("canvas");w("canvas"),w(!1);const Ai=w({width:1,height:1});w({width:1,height:1});const Jt=w(!1);class ht extends Ps{constructor(t=[],i,n,a,o,l,c,d,f,u,b,y,C,x,S,v="main"){super(t,new W().translate({x:o,y:l}).rotate(d).mirror(!1,u),i,n,a,b,y,x,S,S,v);h(this,"radius");h(this,"originalRadius");h(this,"endAngle");this.radius=c,this.originalRadius=c,this.endAngle=f,this.displayText=C}draw(t){if(this.visibility=="hidden")return;if(this.transformationMatrix.transformCanvas(t),this.dragging&&this.preciseDragging?this.radius=this.originalRadius+10:this.radius=this.originalRadius,this.selected.value&&(_i.value=="keyboard"||_i.value=="htmlSlider")&&this.drawSliderPath(t,"blue",2),this.drawSliderPath(t,this.visibility=="visible"?"orange":"lightgrey"),this.dragging&&this.preciseDragging){const a=(l,c=!0)=>{const d=this.radius+(c?15:8);t.beginPath(),t.moveTo(this.radius*Math.cos(l),this.radius*Math.sin(l)),t.lineTo(d*Math.cos(l),d*Math.sin(l)),t.stroke()};let o=Math.ceil(this.temporaryMinValue);for(;o<this.temporaryMaxValue;){const l=(o-this.temporaryMinValue)/(this.temporaryMaxValue-this.temporaryMinValue);a(this.endAngle*l,!0),o+=1}for(o=Math.ceil(this.temporaryMinValue+.5)-.5;o<this.temporaryMaxValue;){const l=(o-this.temporaryMinValue)/(this.temporaryMaxValue-this.temporaryMinValue);a(this.endAngle*l,!1),o+=1}}t.beginPath(),t.arc(this.location.x,this.location.y,5,0,Math.PI*2),t.fillStyle=this.visibility=="visible"?"rgb(255, 0, 0)":"lightgrey",t.fill(),t.fillStyle=this.visibility=="visible"?"#000":"lightgrey";const i={x:this.location.x*(this.radius+15)/this.radius,y:this.location.y*(this.radius+15)/this.radius};t.font="18px Arial";const n=this.fillTextGlobalReferenceFrame(t,i,this.displayText,!0,!1,18);t.font="16px Arial",this.fillTextGlobalReferenceFrame(t,n,Ze(this.value,"V",3),!0)}drawSliderPath(t,i="orange",n=1){t.strokeStyle=i,t.lineWidth=this.localLineThickness*n,t.lineCap="round",t.beginPath(),t.arc(0,0,this.radius,0,this.endAngle,!1);const a=this.endAngle,o=0,l=7;t.moveTo((this.radius+l)*Math.cos(o),(this.radius+l)*Math.sin(o)),t.lineTo((this.radius-l)*Math.cos(o),(this.radius-l)*Math.sin(o));const c=7,d=ce(-5);t.moveTo((this.radius+c)*Math.cos(a+d),(this.radius+c)*Math.sin(a+d)),t.lineTo(this.radius*Math.cos(a),this.radius*Math.sin(a)),t.lineTo((this.radius-c)*Math.cos(a+d),(this.radius-c)*Math.sin(a+d)),t.stroke()}updateLocationBasedOnValue(){const i=(this.value-this.temporaryMinValue)/(this.temporaryMaxValue-this.temporaryMinValue)*this.endAngle;this.location={x:this.radius*Math.cos(i),y:this.radius*Math.sin(i)}}updateValueBasedOnMousePosition(t){const i=d=>ct(d,2*Math.PI)<this.endAngle+.3||ct(d,2*Math.PI)>2*Math.PI-.3;let n=Math.atan2(t.y,t.x);if(!i(n)&&(n=ct(this.endAngle-n-Math.PI,Math.PI),!i(n)))return;const o=B(0,1,n/this.endAngle)*(this.temporaryMaxValue-this.temporaryMinValue)+this.temporaryMinValue;if(t.x**2+t.y**2<20**2){const d=Math.abs(this.maxValue-this.minValue)/10;Math.abs(o-this.value)>d?o-this.value>0?this.value+=d:o-this.value<0&&(this.value-=d):this.value=o}else this.value=o;this.updateLocationBasedOnValue()}mouseDownIntiatesDrag(t){const i=t.x**2+t.y**2,n=(t.x-this.location.x)**2+(t.y-this.location.y)**2,o=Math.atan2(t.y,t.x)/this.endAngle;return n<=10**2||(this.radius-20)**2<i&&i<(this.radius+20)**2&&0<o&&o<1}}const Ci=["up","down","left","right"],ts=class ts extends Z{constructor(t=[],i=P(()=>({x:0,y:0})),n=!1,a=P(()=>({x:0,y:0})),o={}){super(t,new W);h(this,"currentLocation",{x:0,y:0});h(this,"homeLocation");h(this,"desiredLocation");h(this,"locationIsFunctionOfChartVisibility");this.desiredLocation=i,this.locationIsFunctionOfChartVisibility=n,this.homeLocation=a,this.anchorPoints=o,ts.allTectonicPlates.push(this)}moveTowardDesiredLocation(){this.moveTowardLocation(this.desiredLocation.value)}moveTowardHomeLocation(){this.moveTowardLocation(this.homeLocation.value)}moveTowardLocation(t){const n={start:this.currentLocation,end:t};let a={x:0,y:0};Kt(Z.textTransformationMatrix.transformLine(n))<.1?a=t:a=pi(n,.1),this.moveTo(a),this.currentLocation=a}};h(ts,"allTectonicPlates",[]);let D=ts;class M extends Z{constructor(t=[],i={x:0,y:0}){super(t,new W);h(this,"point");this.point=i}toPoint(){return this.transformations[0].value.inverse().multiply(this.transformationMatrix).transformPoint(this.point)}}class g{constructor(s,t,i,n){h(this,"start");h(this,"end");this.start=new M(s,t),this.end=new M(i,n)}toLine(){return{start:this.start.toPoint(),end:this.end.toPoint()}}}class Pi extends Z{constructor(t=[],i=new W,n="main"){super(t,i,n);h(this,"order",0);h(this,"isDuplicate",!1);h(this,"mouseDownInsideSelectionArea",!1);h(this,"showCharts",w(!1));h(this,"selected",w(!1));h(this,"selectionChanged",w(!1));h(this,"boundingBox");h(this,"adjacentDevices",{});this.boundingBox=[new M(this.transformations,{x:-120,y:0}),new M(this.transformations,{x:120,y:0}),new M(this.transformations,{x:0,y:-120}),new M(this.transformations,{x:0,y:120})],gi(this.selected,()=>this.selectionChanged.value=!0)}finishSetup(){Object.keys(this.adjacentDevices).forEach(t=>{Ci.includes(t)||console.error("Adjacency direction must be one of "+String(Ci)+" (inside of "+String(this.key)+")")})}checkSelectionArea(t){const i=this.transformationMatrix.inverse().transformPoint(t);return Kt({start:{x:0,y:0},end:i})<60}drawSelectedHalo(t){if(this.selected.value&&!this.isDuplicate){const i=t.createRadialGradient(0,0,0,0,0,100);i.addColorStop(0,"rgba(0, 0, 255, 0)"),i.addColorStop(.5,"rgba(0, 0, 255, 0)"),i.addColorStop(.8,"rgba(0, 0, 255, 0.2)"),i.addColorStop(1,"rgba(0, 0, 255, 0)"),t.fillStyle=i,t.arc(0,0,200,0,2*Math.PI),t.fill()}}get htmlSliders(){return console.error("Getter function device.htmlSliders is a virtual function."),[]}get namedHtmlSliders(){return{name:this.key,selectionChanged:this.selectionChanged,deviceType:"other",deviceSelected:this.selected,adjacencyList:this.adjacentDevices,value:this.htmlSliders}}}class le extends Pi{constructor(t=[],i,n,a,o,l,c=!1,d="main"){super(t,new W().translate(i).mirror(c,!1).scale(1/30),d);h(this,"voltageDrop");h(this,"vplus");h(this,"vminus");h(this,"schematicEffects");h(this,"current");h(this,"fixedAt");h(this,"isDuplicate",!1);h(this,"mouseDownInsideSelectionArea",!1);h(this,"htmlSlider");h(this,"sliderSelected",w(!1));this.vplus=a,this.vminus=n,this.fixedAt=l,l=="gnd"?this.voltageDrop=new ht(this.transformations,n,a,"toNode",0,0,50,ce(40),ce(80),!0,0,5,o,this.sliderSelected,"visible",d):this.voltageDrop=new ht(this.transformations.concat([w(new W().mirror(!1,!0))]),n,a,"fromNode",0,0,50,ce(40),ce(80),!0,0,5,o,this.sliderSelected,"visible",d),this.schematicEffects={},this.current=0,this.htmlSlider=this.voltageDrop.toHtmlSlider(),this.anchorPoints={Vplus:{x:0,y:-30},Vminus:{x:0,y:30},vdd:{x:0,y:-60},gnd:{x:0,y:60}}}get htmlSliders(){return[this.htmlSlider]}copy(t,i="main"){const n=new le([t].concat(this.transformations.slice(1)),{x:0,y:0},this.vminus,this.vplus,this.voltageDrop.displayText,this.fixedAt,this.fixedAt=="gnd"==this.transformationMatrix.isMirrored,i);return n.transformations[n.transformations.length-1].value=new W,n}draw(t){this.transformationMatrix.transformCanvas(t),this.drawSelectedHalo(t);const i=30,n=11,a=10;t.strokeStyle="black",t.lineWidth=this.localLineThickness;const o=[],l=[{start:{x:n/2,y:-a},end:{x:-n/2,y:-a}},{start:{x:0,y:-a-n/2},end:{x:0,y:-a+n/2}},{start:{x:n/2,y:a},end:{x:-n/2,y:a}}],c=[{center:{x:0,y:0},outerDiameter:2*i}];De(t,o,this.localLineThickness,"black"),De(t,l,this.localLineThickness*.8,"black"),Cs(t,c,this.localLineThickness,"black"),this.voltageDrop.draw(t)}}const Hn=55,Bn=30,Ds=(e,s=0,t=5,i=0)=>{const n=e-i,a=s-i,o=t-i,l=.0256,c=.648,d=.8051,f=164e-8,u=f*Math.log(1+Math.exp((d*(n-c)-a)/(2*l)))**2+1e-15,b=f*Math.log(1+Math.exp((d*(n-c)-o)/(2*l)))**2;let y=1;if(Jt.value){const S=Hn;y=1+(t-s)/S}const C=(u-b)*y,x=C/u;return{I:C,IF:u,saturationLevel:x}},Ls=(e,s=5,t=0,i=5)=>{const n=i-e,a=i-s,o=i-t,l=.0256,c=.7283,d=.7609,f=6108e-10,u=f*Math.log(1+Math.exp((d*(n-c)-a)/(2*l)))**2+1e-15,b=f*Math.log(1+Math.exp((d*(n-c)-o)/(2*l)))**2;let y=1;if(Jt.value){const S=Bn;y=1+(s-t)/S}const C=(u-b)*y,x=C/u;return{I:C,IF:u,saturationLevel:x}};function Yt(e){for(var s=e.length/6|0,t=new Array(s),i=0;i<s;)t[i]="#"+e.slice(i*6,++i*6);return t}function Xt(e){var s=e.length;return function(t){return e[Math.max(0,Math.min(s-1,Math.floor(t*s)))]}}Xt(Yt("44015444025645045745055946075a46085c460a5d460b5e470d60470e6147106347116447136548146748166848176948186a481a6c481b6d481c6e481d6f481f70482071482173482374482475482576482677482878482979472a7a472c7a472d7b472e7c472f7d46307e46327e46337f463480453581453781453882443983443a83443b84433d84433e85423f854240864241864142874144874045884046883f47883f48893e49893e4a893e4c8a3d4d8a3d4e8a3c4f8a3c508b3b518b3b528b3a538b3a548c39558c39568c38588c38598c375a8c375b8d365c8d365d8d355e8d355f8d34608d34618d33628d33638d32648e32658e31668e31678e31688e30698e306a8e2f6b8e2f6c8e2e6d8e2e6e8e2e6f8e2d708e2d718e2c718e2c728e2c738e2b748e2b758e2a768e2a778e2a788e29798e297a8e297b8e287c8e287d8e277e8e277f8e27808e26818e26828e26828e25838e25848e25858e24868e24878e23888e23898e238a8d228b8d228c8d228d8d218e8d218f8d21908d21918c20928c20928c20938c1f948c1f958b1f968b1f978b1f988b1f998a1f9a8a1e9b8a1e9c891e9d891f9e891f9f881fa0881fa1881fa1871fa28720a38620a48621a58521a68522a78522a88423a98324aa8325ab8225ac8226ad8127ad8128ae8029af7f2ab07f2cb17e2db27d2eb37c2fb47c31b57b32b67a34b67935b77937b87838b9773aba763bbb753dbc743fbc7340bd7242be7144bf7046c06f48c16e4ac16d4cc26c4ec36b50c46a52c56954c56856c66758c7655ac8645cc8635ec96260ca6063cb5f65cb5e67cc5c69cd5b6ccd5a6ece5870cf5773d05675d05477d1537ad1517cd2507fd34e81d34d84d44b86d54989d5488bd6468ed64590d74393d74195d84098d83e9bd93c9dd93ba0da39a2da37a5db36a8db34aadc32addc30b0dd2fb2dd2db5de2bb8de29bade28bddf26c0df25c2df23c5e021c8e020cae11fcde11dd0e11cd2e21bd5e21ad8e219dae319dde318dfe318e2e418e5e419e7e419eae51aece51befe51cf1e51df4e61ef6e620f8e621fbe723fde725")),Xt(Yt("00000401000501010601010802010902020b02020d03030f03031204041405041606051806051a07061c08071e0907200a08220b09240c09260d0a290e0b2b100b2d110c2f120d31130d34140e36150e38160f3b180f3d19103f1a10421c10441d11471e114920114b21114e22115024125325125527125829115a2a115c2c115f2d11612f116331116533106734106936106b38106c390f6e3b0f703d0f713f0f72400f74420f75440f764510774710784910784a10794c117a4e117b4f127b51127c52137c54137d56147d57157e59157e5a167e5c167f5d177f5f187f601880621980641a80651a80671b80681c816a1c816b1d816d1d816e1e81701f81721f817320817521817621817822817922827b23827c23827e24828025828125818326818426818627818827818928818b29818c29818e2a81902a81912b81932b80942c80962c80982d80992d809b2e7f9c2e7f9e2f7fa02f7fa1307ea3307ea5317ea6317da8327daa337dab337cad347cae347bb0357bb2357bb3367ab5367ab73779b83779ba3878bc3978bd3977bf3a77c03a76c23b75c43c75c53c74c73d73c83e73ca3e72cc3f71cd4071cf4070d0416fd2426fd3436ed5446dd6456cd8456cd9466bdb476adc4869de4968df4a68e04c67e24d66e34e65e44f64e55064e75263e85362e95462ea5661eb5760ec5860ed5a5fee5b5eef5d5ef05f5ef1605df2625df2645cf3655cf4675cf4695cf56b5cf66c5cf66e5cf7705cf7725cf8745cf8765cf9785df9795df97b5dfa7d5efa7f5efa815ffb835ffb8560fb8761fc8961fc8a62fc8c63fc8e64fc9065fd9266fd9467fd9668fd9869fd9a6afd9b6bfe9d6cfe9f6dfea16efea36ffea571fea772fea973feaa74feac76feae77feb078feb27afeb47bfeb67cfeb77efeb97ffebb81febd82febf84fec185fec287fec488fec68afec88cfeca8dfecc8ffecd90fecf92fed194fed395fed597fed799fed89afdda9cfddc9efddea0fde0a1fde2a3fde3a5fde5a7fde7a9fde9aafdebacfcecaefceeb0fcf0b2fcf2b4fcf4b6fcf6b8fcf7b9fcf9bbfcfbbdfcfdbf"));var Un=Xt(Yt("00000401000501010601010802010a02020c02020e03021004031204031405041706041907051b08051d09061f0a07220b07240c08260d08290e092b10092d110a30120a32140b34150b37160b39180c3c190c3e1b0c411c0c431e0c451f0c48210c4a230c4c240c4f260c51280b53290b552b0b572d0b592f0a5b310a5c320a5e340a5f3609613809623909633b09643d09653e0966400a67420a68440a68450a69470b6a490b6a4a0c6b4c0c6b4d0d6c4f0d6c510e6c520e6d540f6d550f6d57106e59106e5a116e5c126e5d126e5f136e61136e62146e64156e65156e67166e69166e6a176e6c186e6d186e6f196e71196e721a6e741a6e751b6e771c6d781c6d7a1d6d7c1d6d7d1e6d7f1e6c801f6c82206c84206b85216b87216b88226a8a226a8c23698d23698f24699025689225689326679526679727669827669a28659b29649d29649f2a63a02a63a22b62a32c61a52c60a62d60a82e5fa92e5eab2f5ead305dae305cb0315bb1325ab3325ab43359b63458b73557b93556ba3655bc3754bd3853bf3952c03a51c13a50c33b4fc43c4ec63d4dc73e4cc83f4bca404acb4149cc4248ce4347cf4446d04545d24644d34743d44842d54a41d74b3fd84c3ed94d3dda4e3cdb503bdd513ade5238df5337e05536e15635e25734e35933e45a31e55c30e65d2fe75e2ee8602de9612bea632aeb6429eb6628ec6726ed6925ee6a24ef6c23ef6e21f06f20f1711ff1731df2741cf3761bf37819f47918f57b17f57d15f67e14f68013f78212f78410f8850ff8870ef8890cf98b0bf98c0af98e09fa9008fa9207fa9407fb9606fb9706fb9906fb9b06fb9d07fc9f07fca108fca309fca50afca60cfca80dfcaa0ffcac11fcae12fcb014fcb216fcb418fbb61afbb81dfbba1ffbbc21fbbe23fac026fac228fac42afac62df9c72ff9c932f9cb35f8cd37f8cf3af7d13df7d340f6d543f6d746f5d949f5db4cf4dd4ff4df53f4e156f3e35af3e55df2e661f2e865f2ea69f1ec6df1ed71f1ef75f1f179f2f27df2f482f3f586f3f68af4f88ef5f992f6fa96f8fb9af9fc9dfafda1fcffa4"));Xt(Yt("0d088710078813078916078a19068c1b068d1d068e20068f2206902406912605912805922a05932c05942e05952f059631059733059735049837049938049a3a049a3c049b3e049c3f049c41049d43039e44039e46039f48039f4903a04b03a14c02a14e02a25002a25102a35302a35502a45601a45801a45901a55b01a55c01a65e01a66001a66100a76300a76400a76600a76700a86900a86a00a86c00a86e00a86f00a87100a87201a87401a87501a87701a87801a87a02a87b02a87d03a87e03a88004a88104a78305a78405a78606a68707a68808a68a09a58b0aa58d0ba58e0ca48f0da4910ea3920fa39410a29511a19613a19814a099159f9a169f9c179e9d189d9e199da01a9ca11b9ba21d9aa31e9aa51f99a62098a72197a82296aa2395ab2494ac2694ad2793ae2892b02991b12a90b22b8fb32c8eb42e8db52f8cb6308bb7318ab83289ba3388bb3488bc3587bd3786be3885bf3984c03a83c13b82c23c81c33d80c43e7fc5407ec6417dc7427cc8437bc9447aca457acb4679cc4778cc4977cd4a76ce4b75cf4c74d04d73d14e72d24f71d35171d45270d5536fd5546ed6556dd7566cd8576bd9586ada5a6ada5b69db5c68dc5d67dd5e66de5f65de6164df6263e06363e16462e26561e26660e3685fe4695ee56a5de56b5de66c5ce76e5be76f5ae87059e97158e97257ea7457eb7556eb7655ec7754ed7953ed7a52ee7b51ef7c51ef7e50f07f4ff0804ef1814df1834cf2844bf3854bf3874af48849f48948f58b47f58c46f68d45f68f44f79044f79143f79342f89441f89540f9973ff9983ef99a3efa9b3dfa9c3cfa9e3bfb9f3afba139fba238fca338fca537fca636fca835fca934fdab33fdac33fdae32fdaf31fdb130fdb22ffdb42ffdb52efeb72dfeb82cfeba2cfebb2bfebd2afebe2afec029fdc229fdc328fdc527fdc627fdc827fdca26fdcb26fccd25fcce25fcd025fcd225fbd324fbd524fbd724fad824fada24f9dc24f9dd25f8df25f8e125f7e225f7e425f6e626f6e826f5e926f5eb27f4ed27f3ee27f3f027f2f227f1f426f1f525f0f724f0f921"));function Dt(e,s,t){this.k=e,this.x=s,this.y=t}Dt.prototype={constructor:Dt,scale:function(e){return e===1?this:new Dt(this.k*e,this.x,this.y)},translate:function(e,s){return e===0&s===0?this:new Dt(this.k,this.x+this.k*e,this.y+this.k*s)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}},Dt.prototype;class Ws{constructor(s=[]){h(this,"dotPath");h(this,"dotPercentage");h(this,"dotSize");h(this,"dotSpacing");h(this,"gradientSize");this.dotPath=s,this.dotPercentage=0,this.dotSize=8,this.dotSpacing=20,s.length==0?this.gradientSize=0:this.gradientSize=Math.sqrt((s[s.length-1].end.x-s[0].start.x)**2+(s[s.length-1].end.y-s[0].start.y)**2)/2}draw(s){const t=this.getMovingDotPositions(this.dotPath,this.dotSpacing).map(n=>({center:n,outerDiameter:this.dotSize})),i=s.createRadialGradient(0,0,0,0,0,this.gradientSize);i.addColorStop(0,"rgba(0, 0, 255, 1)"),i.addColorStop(1,"rgba(0, 0, 255, 0)"),Nn(s,t,this.dotSize/2,i)}updateDotPositionBasedOnTimestamp(s,t=10){const i=this.getDotSpeedFromCurrent(s);this.dotPercentage=ct(this.dotPercentage+i*(t/1e3),1)}getMovingDotPositions(s,t){const i=mi(s),n=[],a=Math.floor(i/t);for(let o=0;o<a;o++){const l=(o+this.dotPercentage)/a,c=re(s,l);n.push(c)}return n}getDotSpeedFromCurrent(s){let n=1,a=!1;return s==0?0:(s<0&&(s=Math.abs(s),a=!0),s>1e-4?n=(Math.log10(s/1e-4)+1)**2*1:n=1/(1-Math.log10(s/1e-4))**2*1,n>5*1?n=5*1:n<.001*1&&(n=.001*1),a?-n:n)}}const qn=(e,s)=>Math.floor(e/s)*s,Os=(e,s,t=!1)=>{if(t)return Jn(e,s);const i=s-e;let n=10**Math.floor(Math.log10(i));const a=Math.floor(i/n);a>=5?n=n*5:a>=4?n=n*2:a<=2&&(n=n/2);let l=qn(e,n),c=[];for(;l<=s;)c.push(l),l=l+n;return c.push(l),c},Kn=e=>Math.abs(Math.round(e)-e)<.1?10**Math.round(3*e):5*10**Math.floor(3*e),Jn=(e,s)=>{e<=0&&console.error(`Lower bound, ${e} <= 0. Log will return NaN`);const t=Math.log10(e)/3,i=Math.log10(s)/3;return i-t<1?Os(e,s):Os(t,i).map(Kn)},$t=(e,s,t)=>{if(t<=0)throw new Error("num must be a positive integer");if(t===1)return[e];const i=(s-e)/(t-1),n=[];for(let a=0;a<t;a++)n.push(e+i*a);return n},dt=typeof performance=="object"&&performance&&typeof performance.now=="function"?performance:Date,Di=new Set,Es=typeof process=="object"&&process?process:{},Li=(e,s,t,i)=>{typeof Es.emitWarning=="function"?Es.emitWarning(e,s,t,i):console.error(`[${t}] ${s}: ${e}`)};let Qt=globalThis.AbortController,Wi=globalThis.AbortSignal;if(typeof Qt>"u"){Wi=class{constructor(){h(this,"onabort");h(this,"_onabort",[]);h(this,"reason");h(this,"aborted",!1)}addEventListener(i,n){this._onabort.push(n)}},Qt=class{constructor(){h(this,"signal",new Wi);s()}abort(i){var n,a;if(!this.signal.aborted){this.signal.reason=i,this.signal.aborted=!0;for(const o of this.signal._onabort)o(i);(a=(n=this.signal).onabort)==null||a.call(n,i)}}};let e=((Fi=Es.env)==null?void 0:Fi.LRU_CACHE_IGNORE_AC_WARNING)!=="1";const s=()=>{e&&(e=!1,Li("AbortController is not defined. If using lru-cache in node 14, load an AbortController polyfill from the `node-abort-controller` package. A minimal polyfill is provided for use by LRUCache.fetch(), but it should not be relied upon in other contexts (eg, passing it to other APIs that use AbortController/AbortSignal might have undesirable effects). You may disable this with LRU_CACHE_IGNORE_AC_WARNING=1 in the env.","NO_ABORT_CONTROLLER","ENOTSUP",s))}}const Yn=e=>!Di.has(e),Ue=e=>e&&e===Math.floor(e)&&e>0&&isFinite(e),Oi=e=>Ue(e)?e<=Math.pow(2,8)?Uint8Array:e<=Math.pow(2,16)?Uint16Array:e<=Math.pow(2,32)?Uint32Array:e<=Number.MAX_SAFE_INTEGER?Zt:null:null;class Zt extends Array{constructor(s){super(s),this.fill(0)}}const tt=class tt{constructor(s,t){h(this,"heap");h(this,"length");if(!r(tt,gt))throw new TypeError("instantiate Stack using Stack.create(n)");this.heap=new t(s),this.length=0}static create(s){const t=Oi(s);if(!t)return[];V(tt,gt,!0);const i=new tt(s,t);return V(tt,gt,!1),i}push(s){this.heap[this.length++]=s}pop(){return this.heap[--this.length]}};gt=new WeakMap,A(tt,gt,!1);let Rs=tt;const Fs=class Fs{constructor(s){A(this,Lt);A(this,ss);A(this,Le);A(this,We);A(this,Et);A(this,yt);A(this,bt);A(this,z);A(this,Rt);A(this,nt);A(this,Oe);A(this,kt);A(this,xe,void 0);A(this,he,void 0);A(this,Ve,void 0);A(this,Se,void 0);A(this,vt,void 0);A(this,mt,void 0);h(this,"ttl");h(this,"ttlResolution");h(this,"ttlAutopurge");h(this,"updateAgeOnGet");h(this,"updateAgeOnHas");h(this,"allowStale");h(this,"noDisposeOnSet");h(this,"noUpdateTTL");h(this,"maxEntrySize");h(this,"sizeCalculation");h(this,"noDeleteOnFetchRejection");h(this,"noDeleteOnStaleGet");h(this,"allowStaleOnFetchAbort");h(this,"allowStaleOnFetchRejection");h(this,"ignoreFetchAbort");A(this,Y,void 0);A(this,Te,void 0);A(this,K,void 0);A(this,N,void 0);A(this,_,void 0);A(this,ne,void 0);A(this,de,void 0);A(this,se,void 0);A(this,X,void 0);A(this,_e,void 0);A(this,$,void 0);A(this,Ae,void 0);A(this,Ce,void 0);A(this,fe,void 0);A(this,Pe,void 0);A(this,qe,void 0);A(this,ae,void 0);A(this,st,()=>{});A(this,Ie,()=>{});A(this,Wt,()=>{});A(this,ue,()=>!1);A(this,it,s=>{});A(this,pt,(s,t,i)=>{});A(this,Ot,(s,t,i,n)=>{if(i||n)throw new TypeError("cannot set size without setting maxSize or maxEntrySize on cache");return 0});h(this,oa,"LRUCache");const{max:t=0,ttl:i,ttlResolution:n=1,ttlAutopurge:a,updateAgeOnGet:o,updateAgeOnHas:l,allowStale:c,dispose:d,disposeAfter:f,noDisposeOnSet:u,noUpdateTTL:b,maxSize:y=0,maxEntrySize:C=0,sizeCalculation:x,fetchMethod:S,memoMethod:v,noDeleteOnFetchRejection:L,noDeleteOnStaleGet:T,allowStaleOnFetchRejection:E,allowStaleOnFetchAbort:Q,ignoreFetchAbort:me}=s;if(t!==0&&!Ue(t))throw new TypeError("max option must be a nonnegative integer");const Ee=t?Oi(t):Array;if(!Ee)throw new Error("invalid max value: "+t);if(V(this,xe,t),V(this,he,y),this.maxEntrySize=C||r(this,he),this.sizeCalculation=x,this.sizeCalculation){if(!r(this,he)&&!this.maxEntrySize)throw new TypeError("cannot set sizeCalculation without setting maxSize or maxEntrySize");if(typeof this.sizeCalculation!="function")throw new TypeError("sizeCalculation set to non-function")}if(v!==void 0&&typeof v!="function")throw new TypeError("memoMethod must be a function if defined");if(V(this,mt,v),S!==void 0&&typeof S!="function")throw new TypeError("fetchMethod must be a function if specified");if(V(this,vt,S),V(this,qe,!!S),V(this,K,new Map),V(this,N,new Array(t).fill(void 0)),V(this,_,new Array(t).fill(void 0)),V(this,ne,new Ee(t)),V(this,de,new Ee(t)),V(this,se,0),V(this,X,0),V(this,_e,Rs.create(t)),V(this,Y,0),V(this,Te,0),typeof d=="function"&&V(this,Ve,d),typeof f=="function"?(V(this,Se,f),V(this,$,[])):(V(this,Se,void 0),V(this,$,void 0)),V(this,Pe,!!r(this,Ve)),V(this,ae,!!r(this,Se)),this.noDisposeOnSet=!!u,this.noUpdateTTL=!!b,this.noDeleteOnFetchRejection=!!L,this.allowStaleOnFetchRejection=!!E,this.allowStaleOnFetchAbort=!!Q,this.ignoreFetchAbort=!!me,this.maxEntrySize!==0){if(r(this,he)!==0&&!Ue(r(this,he)))throw new TypeError("maxSize must be a positive integer if specified");if(!Ue(this.maxEntrySize))throw new TypeError("maxEntrySize must be a positive integer if specified");m(this,ss,Ii).call(this)}if(this.allowStale=!!c,this.noDeleteOnStaleGet=!!T,this.updateAgeOnGet=!!o,this.updateAgeOnHas=!!l,this.ttlResolution=Ue(n)||n===0?n:1,this.ttlAutopurge=!!a,this.ttl=i||0,this.ttl){if(!Ue(this.ttl))throw new TypeError("ttl must be a positive integer if specified");m(this,Lt,Ns).call(this)}if(r(this,xe)===0&&this.ttl===0&&r(this,he)===0)throw new TypeError("At least one of max, maxSize, or ttl is required");if(!this.ttlAutopurge&&!r(this,xe)&&!r(this,he)){const wt="LRU_CACHE_UNBOUNDED";Yn(wt)&&(Di.add(wt),Li("TTL caching without ttlAutopurge, max, or maxSize can result in unbounded memory consumption.","UnboundedCacheWarning",wt,Fs))}}static unsafeExposeInternals(s){return{starts:r(s,Ce),ttls:r(s,fe),sizes:r(s,Ae),keyMap:r(s,K),keyList:r(s,N),valList:r(s,_),next:r(s,ne),prev:r(s,de),get head(){return r(s,se)},get tail(){return r(s,X)},free:r(s,_e),isBackgroundFetch:t=>{var i;return m(i=s,z,G).call(i,t)},backgroundFetch:(t,i,n,a)=>{var o;return m(o=s,bt,as).call(o,t,i,n,a)},moveToTail:t=>{var i;return m(i=s,nt,Ft).call(i,t)},indexes:t=>{var i;return m(i=s,Le,Ke).call(i,t)},rindexes:t=>{var i;return m(i=s,We,Je).call(i,t)},isStale:t=>{var i;return r(i=s,ue).call(i,t)}}}get max(){return r(this,xe)}get maxSize(){return r(this,he)}get calculatedSize(){return r(this,Te)}get size(){return r(this,Y)}get fetchMethod(){return r(this,vt)}get memoMethod(){return r(this,mt)}get dispose(){return r(this,Ve)}get disposeAfter(){return r(this,Se)}getRemainingTTL(s){return r(this,K).has(s)?1/0:0}*entries(){for(const s of m(this,Le,Ke).call(this))r(this,_)[s]!==void 0&&r(this,N)[s]!==void 0&&!m(this,z,G).call(this,r(this,_)[s])&&(yield[r(this,N)[s],r(this,_)[s]])}*rentries(){for(const s of m(this,We,Je).call(this))r(this,_)[s]!==void 0&&r(this,N)[s]!==void 0&&!m(this,z,G).call(this,r(this,_)[s])&&(yield[r(this,N)[s],r(this,_)[s]])}*keys(){for(const s of m(this,Le,Ke).call(this)){const t=r(this,N)[s];t!==void 0&&!m(this,z,G).call(this,r(this,_)[s])&&(yield t)}}*rkeys(){for(const s of m(this,We,Je).call(this)){const t=r(this,N)[s];t!==void 0&&!m(this,z,G).call(this,r(this,_)[s])&&(yield t)}}*values(){for(const s of m(this,Le,Ke).call(this))r(this,_)[s]!==void 0&&!m(this,z,G).call(this,r(this,_)[s])&&(yield r(this,_)[s])}*rvalues(){for(const s of m(this,We,Je).call(this))r(this,_)[s]!==void 0&&!m(this,z,G).call(this,r(this,_)[s])&&(yield r(this,_)[s])}[Symbol.iterator](){return this.entries()}find(s,t={}){for(const i of m(this,Le,Ke).call(this)){const n=r(this,_)[i],a=m(this,z,G).call(this,n)?n.__staleWhileFetching:n;if(a!==void 0&&s(a,r(this,N)[i],this))return this.get(r(this,N)[i],t)}}forEach(s,t=this){for(const i of m(this,Le,Ke).call(this)){const n=r(this,_)[i],a=m(this,z,G).call(this,n)?n.__staleWhileFetching:n;a!==void 0&&s.call(t,a,r(this,N)[i],this)}}rforEach(s,t=this){for(const i of m(this,We,Je).call(this)){const n=r(this,_)[i],a=m(this,z,G).call(this,n)?n.__staleWhileFetching:n;a!==void 0&&s.call(t,a,r(this,N)[i],this)}}purgeStale(){let s=!1;for(const t of m(this,We,Je).call(this,{allowStale:!0}))r(this,ue).call(this,t)&&(m(this,Oe,Ye).call(this,r(this,N)[t],"expire"),s=!0);return s}info(s){const t=r(this,K).get(s);if(t===void 0)return;const i=r(this,_)[t],n=m(this,z,G).call(this,i)?i.__staleWhileFetching:i;if(n===void 0)return;const a={value:n};if(r(this,fe)&&r(this,Ce)){const o=r(this,fe)[t],l=r(this,Ce)[t];if(o&&l){const c=o-(dt.now()-l);a.ttl=c,a.start=Date.now()}}return r(this,Ae)&&(a.size=r(this,Ae)[t]),a}dump(){const s=[];for(const t of m(this,Le,Ke).call(this,{allowStale:!0})){const i=r(this,N)[t],n=r(this,_)[t],a=m(this,z,G).call(this,n)?n.__staleWhileFetching:n;if(a===void 0||i===void 0)continue;const o={value:a};if(r(this,fe)&&r(this,Ce)){o.ttl=r(this,fe)[t];const l=dt.now()-r(this,Ce)[t];o.start=Math.floor(Date.now()-l)}r(this,Ae)&&(o.size=r(this,Ae)[t]),s.unshift([i,o])}return s}load(s){this.clear();for(const[t,i]of s){if(i.start){const n=Date.now()-i.start;i.start=dt.now()-n}this.set(t,i.value,i)}}set(s,t,i={}){var b,y,C,x,S;if(t===void 0)return this.delete(s),this;const{ttl:n=this.ttl,start:a,noDisposeOnSet:o=this.noDisposeOnSet,sizeCalculation:l=this.sizeCalculation,status:c}=i;let{noUpdateTTL:d=this.noUpdateTTL}=i;const f=r(this,Ot).call(this,s,t,i.size||0,l);if(this.maxEntrySize&&f>this.maxEntrySize)return c&&(c.set="miss",c.maxEntrySizeExceeded=!0),m(this,Oe,Ye).call(this,s,"set"),this;let u=r(this,Y)===0?void 0:r(this,K).get(s);if(u===void 0)u=r(this,Y)===0?r(this,X):r(this,_e).length!==0?r(this,_e).pop():r(this,Y)===r(this,xe)?m(this,yt,ns).call(this,!1):r(this,Y),r(this,N)[u]=s,r(this,_)[u]=t,r(this,K).set(s,u),r(this,ne)[r(this,X)]=u,r(this,de)[u]=r(this,X),V(this,X,u),is(this,Y)._++,r(this,pt).call(this,u,f,c),c&&(c.set="add"),d=!1;else{m(this,nt,Ft).call(this,u);const v=r(this,_)[u];if(t!==v){if(r(this,qe)&&m(this,z,G).call(this,v)){v.__abortController.abort(new Error("replaced"));const{__staleWhileFetching:L}=v;L!==void 0&&!o&&(r(this,Pe)&&((b=r(this,Ve))==null||b.call(this,L,s,"set")),r(this,ae)&&((y=r(this,$))==null||y.push([L,s,"set"])))}else o||(r(this,Pe)&&((C=r(this,Ve))==null||C.call(this,v,s,"set")),r(this,ae)&&((x=r(this,$))==null||x.push([v,s,"set"])));if(r(this,it).call(this,u),r(this,pt).call(this,u,f,c),r(this,_)[u]=t,c){c.set="replace";const L=v&&m(this,z,G).call(this,v)?v.__staleWhileFetching:v;L!==void 0&&(c.oldValue=L)}}else c&&(c.set="update")}if(n!==0&&!r(this,fe)&&m(this,Lt,Ns).call(this),r(this,fe)&&(d||r(this,Wt).call(this,u,n,a),c&&r(this,Ie).call(this,c,u)),!o&&r(this,ae)&&r(this,$)){const v=r(this,$);let L;for(;L=v==null?void 0:v.shift();)(S=r(this,Se))==null||S.call(this,...L)}return this}pop(){var s;try{for(;r(this,Y);){const t=r(this,_)[r(this,se)];if(m(this,yt,ns).call(this,!0),m(this,z,G).call(this,t)){if(t.__staleWhileFetching)return t.__staleWhileFetching}else if(t!==void 0)return t}}finally{if(r(this,ae)&&r(this,$)){const t=r(this,$);let i;for(;i=t==null?void 0:t.shift();)(s=r(this,Se))==null||s.call(this,...i)}}}has(s,t={}){const{updateAgeOnHas:i=this.updateAgeOnHas,status:n}=t,a=r(this,K).get(s);if(a!==void 0){const o=r(this,_)[a];if(m(this,z,G).call(this,o)&&o.__staleWhileFetching===void 0)return!1;if(r(this,ue).call(this,a))n&&(n.has="stale",r(this,Ie).call(this,n,a));else return i&&r(this,st).call(this,a),n&&(n.has="hit",r(this,Ie).call(this,n,a)),!0}else n&&(n.has="miss");return!1}peek(s,t={}){const{allowStale:i=this.allowStale}=t,n=r(this,K).get(s);if(n===void 0||!i&&r(this,ue).call(this,n))return;const a=r(this,_)[n];return m(this,z,G).call(this,a)?a.__staleWhileFetching:a}async fetch(s,t={}){const{allowStale:i=this.allowStale,updateAgeOnGet:n=this.updateAgeOnGet,noDeleteOnStaleGet:a=this.noDeleteOnStaleGet,ttl:o=this.ttl,noDisposeOnSet:l=this.noDisposeOnSet,size:c=0,sizeCalculation:d=this.sizeCalculation,noUpdateTTL:f=this.noUpdateTTL,noDeleteOnFetchRejection:u=this.noDeleteOnFetchRejection,allowStaleOnFetchRejection:b=this.allowStaleOnFetchRejection,ignoreFetchAbort:y=this.ignoreFetchAbort,allowStaleOnFetchAbort:C=this.allowStaleOnFetchAbort,context:x,forceRefresh:S=!1,status:v,signal:L}=t;if(!r(this,qe))return v&&(v.fetch="get"),this.get(s,{allowStale:i,updateAgeOnGet:n,noDeleteOnStaleGet:a,status:v});const T={allowStale:i,updateAgeOnGet:n,noDeleteOnStaleGet:a,ttl:o,noDisposeOnSet:l,size:c,sizeCalculation:d,noUpdateTTL:f,noDeleteOnFetchRejection:u,allowStaleOnFetchRejection:b,allowStaleOnFetchAbort:C,ignoreFetchAbort:y,status:v,signal:L};let E=r(this,K).get(s);if(E===void 0){v&&(v.fetch="miss");const Q=m(this,bt,as).call(this,s,E,T,x);return Q.__returned=Q}else{const Q=r(this,_)[E];if(m(this,z,G).call(this,Q)){const Is=i&&Q.__staleWhileFetching!==void 0;return v&&(v.fetch="inflight",Is&&(v.returnedStale=!0)),Is?Q.__staleWhileFetching:Q.__returned=Q}const me=r(this,ue).call(this,E);if(!S&&!me)return v&&(v.fetch="hit"),m(this,nt,Ft).call(this,E),n&&r(this,st).call(this,E),v&&r(this,Ie).call(this,v,E),Q;const Ee=m(this,bt,as).call(this,s,E,T,x),zt=Ee.__staleWhileFetching!==void 0&&i;return v&&(v.fetch=me?"stale":"refresh",zt&&me&&(v.returnedStale=!0)),zt?Ee.__staleWhileFetching:Ee.__returned=Ee}}async forceFetch(s,t={}){const i=await this.fetch(s,t);if(i===void 0)throw new Error("fetch() returned undefined");return i}memo(s,t={}){const i=r(this,mt);if(!i)throw new Error("no memoMethod provided to constructor");const{context:n,forceRefresh:a,...o}=t,l=this.get(s,o);if(!a&&l!==void 0)return l;const c=i(s,l,{options:o,context:n});return this.set(s,c,o),c}get(s,t={}){const{allowStale:i=this.allowStale,updateAgeOnGet:n=this.updateAgeOnGet,noDeleteOnStaleGet:a=this.noDeleteOnStaleGet,status:o}=t,l=r(this,K).get(s);if(l!==void 0){const c=r(this,_)[l],d=m(this,z,G).call(this,c);return o&&r(this,Ie).call(this,o,l),r(this,ue).call(this,l)?(o&&(o.get="stale"),d?(o&&i&&c.__staleWhileFetching!==void 0&&(o.returnedStale=!0),i?c.__staleWhileFetching:void 0):(a||m(this,Oe,Ye).call(this,s,"expire"),o&&i&&(o.returnedStale=!0),i?c:void 0)):(o&&(o.get="hit"),d?c.__staleWhileFetching:(m(this,nt,Ft).call(this,l),n&&r(this,st).call(this,l),c))}else o&&(o.get="miss")}delete(s){return m(this,Oe,Ye).call(this,s,"delete")}clear(){return m(this,kt,Bs).call(this,"delete")}};oa=Symbol.toStringTag,xe=new WeakMap,he=new WeakMap,Ve=new WeakMap,Se=new WeakMap,vt=new WeakMap,mt=new WeakMap,Y=new WeakMap,Te=new WeakMap,K=new WeakMap,N=new WeakMap,_=new WeakMap,ne=new WeakMap,de=new WeakMap,se=new WeakMap,X=new WeakMap,_e=new WeakMap,$=new WeakMap,Ae=new WeakMap,Ce=new WeakMap,fe=new WeakMap,Pe=new WeakMap,qe=new WeakMap,ae=new WeakMap,Lt=new WeakSet,Ns=function(){const s=new Zt(r(this,xe)),t=new Zt(r(this,xe));V(this,fe,s),V(this,Ce,t),V(this,Wt,(a,o,l=dt.now())=>{if(t[a]=o!==0?l:0,s[a]=o,o!==0&&this.ttlAutopurge){const c=setTimeout(()=>{r(this,ue).call(this,a)&&m(this,Oe,Ye).call(this,r(this,N)[a],"expire")},o+1);c.unref&&c.unref()}}),V(this,st,a=>{t[a]=s[a]!==0?dt.now():0}),V(this,Ie,(a,o)=>{if(s[o]){const l=s[o],c=t[o];if(!l||!c)return;a.ttl=l,a.start=c,a.now=i||n();const d=a.now-c;a.remainingTTL=l-d}});let i=0;const n=()=>{const a=dt.now();if(this.ttlResolution>0){i=a;const o=setTimeout(()=>i=0,this.ttlResolution);o.unref&&o.unref()}return a};this.getRemainingTTL=a=>{const o=r(this,K).get(a);if(o===void 0)return 0;const l=s[o],c=t[o];if(!l||!c)return 1/0;const d=(i||n())-c;return l-d},V(this,ue,a=>{const o=t[a],l=s[a];return!!l&&!!o&&(i||n())-o>l})},st=new WeakMap,Ie=new WeakMap,Wt=new WeakMap,ue=new WeakMap,ss=new WeakSet,Ii=function(){const s=new Zt(r(this,xe));V(this,Te,0),V(this,Ae,s),V(this,it,t=>{V(this,Te,r(this,Te)-s[t]),s[t]=0}),V(this,Ot,(t,i,n,a)=>{if(m(this,z,G).call(this,i))return 0;if(!Ue(n))if(a){if(typeof a!="function")throw new TypeError("sizeCalculation must be a function");if(n=a(i,t),!Ue(n))throw new TypeError("sizeCalculation return invalid (expect positive integer)")}else throw new TypeError("invalid size value (must be positive integer). When maxSize or maxEntrySize is used, sizeCalculation or size must be set.");return n}),V(this,pt,(t,i,n)=>{if(s[t]=i,r(this,he)){const a=r(this,he)-s[t];for(;r(this,Te)>a;)m(this,yt,ns).call(this,!0)}V(this,Te,r(this,Te)+s[t]),n&&(n.entrySize=i,n.totalCalculatedSize=r(this,Te))})},it=new WeakMap,pt=new WeakMap,Ot=new WeakMap,Le=new WeakSet,Ke=function*({allowStale:s=this.allowStale}={}){if(r(this,Y))for(let t=r(this,X);!(!m(this,Et,Gs).call(this,t)||((s||!r(this,ue).call(this,t))&&(yield t),t===r(this,se)));)t=r(this,de)[t]},We=new WeakSet,Je=function*({allowStale:s=this.allowStale}={}){if(r(this,Y))for(let t=r(this,se);!(!m(this,Et,Gs).call(this,t)||((s||!r(this,ue).call(this,t))&&(yield t),t===r(this,X)));)t=r(this,ne)[t]},Et=new WeakSet,Gs=function(s){return s!==void 0&&r(this,K).get(r(this,N)[s])===s},yt=new WeakSet,ns=function(s){var a,o;const t=r(this,se),i=r(this,N)[t],n=r(this,_)[t];return r(this,qe)&&m(this,z,G).call(this,n)?n.__abortController.abort(new Error("evicted")):(r(this,Pe)||r(this,ae))&&(r(this,Pe)&&((a=r(this,Ve))==null||a.call(this,n,i,"evict")),r(this,ae)&&((o=r(this,$))==null||o.push([n,i,"evict"]))),r(this,it).call(this,t),s&&(r(this,N)[t]=void 0,r(this,_)[t]=void 0,r(this,_e).push(t)),r(this,Y)===1?(V(this,se,V(this,X,0)),r(this,_e).length=0):V(this,se,r(this,ne)[t]),r(this,K).delete(i),is(this,Y)._--,t},bt=new WeakSet,as=function(s,t,i,n){const a=t===void 0?void 0:r(this,_)[t];if(m(this,z,G).call(this,a))return a;const o=new Qt,{signal:l}=i;l==null||l.addEventListener("abort",()=>o.abort(l.reason),{signal:o.signal});const c={signal:o.signal,options:i,context:n},d=(x,S=!1)=>{const{aborted:v}=o.signal,L=i.ignoreFetchAbort&&x!==void 0;if(i.status&&(v&&!S?(i.status.fetchAborted=!0,i.status.fetchError=o.signal.reason,L&&(i.status.fetchAbortIgnored=!0)):i.status.fetchResolved=!0),v&&!L&&!S)return u(o.signal.reason);const T=y;return r(this,_)[t]===y&&(x===void 0?T.__staleWhileFetching?r(this,_)[t]=T.__staleWhileFetching:m(this,Oe,Ye).call(this,s,"fetch"):(i.status&&(i.status.fetchUpdated=!0),this.set(s,x,c.options))),x},f=x=>(i.status&&(i.status.fetchRejected=!0,i.status.fetchError=x),u(x)),u=x=>{const{aborted:S}=o.signal,v=S&&i.allowStaleOnFetchAbort,L=v||i.allowStaleOnFetchRejection,T=L||i.noDeleteOnFetchRejection,E=y;if(r(this,_)[t]===y&&(!T||E.__staleWhileFetching===void 0?m(this,Oe,Ye).call(this,s,"fetch"):v||(r(this,_)[t]=E.__staleWhileFetching)),L)return i.status&&E.__staleWhileFetching!==void 0&&(i.status.returnedStale=!0),E.__staleWhileFetching;if(E.__returned===E)throw x},b=(x,S)=>{var L;const v=(L=r(this,vt))==null?void 0:L.call(this,s,a,c);v&&v instanceof Promise&&v.then(T=>x(T===void 0?void 0:T),S),o.signal.addEventListener("abort",()=>{(!i.ignoreFetchAbort||i.allowStaleOnFetchAbort)&&(x(void 0),i.allowStaleOnFetchAbort&&(x=T=>d(T,!0)))})};i.status&&(i.status.fetchDispatched=!0);const y=new Promise(b).then(d,f),C=Object.assign(y,{__abortController:o,__staleWhileFetching:a,__returned:void 0});return t===void 0?(this.set(s,C,{...c.options,status:void 0}),t=r(this,K).get(s)):r(this,_)[t]=C,C},z=new WeakSet,G=function(s){if(!r(this,qe))return!1;const t=s;return!!t&&t instanceof Promise&&t.hasOwnProperty("__staleWhileFetching")&&t.__abortController instanceof Qt},Rt=new WeakSet,Hs=function(s,t){r(this,de)[t]=s,r(this,ne)[s]=t},nt=new WeakSet,Ft=function(s){s!==r(this,X)&&(s===r(this,se)?V(this,se,r(this,ne)[s]):m(this,Rt,Hs).call(this,r(this,de)[s],r(this,ne)[s]),m(this,Rt,Hs).call(this,r(this,X),s),V(this,X,s))},Oe=new WeakSet,Ye=function(s,t){var n,a,o,l;let i=!1;if(r(this,Y)!==0){const c=r(this,K).get(s);if(c!==void 0)if(i=!0,r(this,Y)===1)m(this,kt,Bs).call(this,t);else{r(this,it).call(this,c);const d=r(this,_)[c];if(m(this,z,G).call(this,d)?d.__abortController.abort(new Error("deleted")):(r(this,Pe)||r(this,ae))&&(r(this,Pe)&&((n=r(this,Ve))==null||n.call(this,d,s,t)),r(this,ae)&&((a=r(this,$))==null||a.push([d,s,t]))),r(this,K).delete(s),r(this,N)[c]=void 0,r(this,_)[c]=void 0,c===r(this,X))V(this,X,r(this,de)[c]);else if(c===r(this,se))V(this,se,r(this,ne)[c]);else{const f=r(this,de)[c];r(this,ne)[f]=r(this,ne)[c];const u=r(this,ne)[c];r(this,de)[u]=r(this,de)[c]}is(this,Y)._--,r(this,_e).push(c)}}if(r(this,ae)&&((o=r(this,$))!=null&&o.length)){const c=r(this,$);let d;for(;d=c==null?void 0:c.shift();)(l=r(this,Se))==null||l.call(this,...d)}return i},kt=new WeakSet,Bs=function(s){var t,i,n;for(const a of m(this,We,Je).call(this,{allowStale:!0})){const o=r(this,_)[a];if(m(this,z,G).call(this,o))o.__abortController.abort(new Error("deleted"));else{const l=r(this,N)[a];r(this,Pe)&&((t=r(this,Ve))==null||t.call(this,o,l,s)),r(this,ae)&&((i=r(this,$))==null||i.push([o,l,s]))}}if(r(this,K).clear(),r(this,_).fill(void 0),r(this,N).fill(void 0),r(this,fe)&&r(this,Ce)&&(r(this,fe).fill(0),r(this,Ce).fill(0)),r(this,Ae)&&r(this,Ae).fill(0),V(this,se,0),V(this,X,0),r(this,_e).length=0,V(this,Te,0),V(this,Y,0),r(this,ae)&&r(this,$)){const a=r(this,$);let o;for(;o=a==null?void 0:a.shift();)(n=r(this,Se))==null||n.call(this,...o)}};let ks=Fs;const ee=class ee extends Ps{constructor(t=[],i,n,a,o,l,c,d,f,u,b=5,y="x Var",C="y Var",x="xUnit",S="yUnit",v="linear",L="log",T=250,E=200,Q,me="visible",Ee="main"){const wt=u,zt=n=="Vgs"?l:d;super(t,new W().translate({x:a,y:o}),wt,zt,"toNode",0,b,Q,"hidden",me,Ee);h(this,"points");h(this,"xAxisLabel");h(this,"yAxisLabel");h(this,"xUnit");h(this,"yUnit");h(this,"width");h(this,"height");h(this,"axesWidth");h(this,"axesHeight");h(this,"cornerToCornerGraph",!0);h(this,"plottingValues",[]);h(this,"yValue",0);h(this,"pointsCache",new ks({max:1e3}));h(this,"cacheAttempts",0);h(this,"cacheHits",0);h(this,"memoize",!1);h(this,"Vg");h(this,"Vs");h(this,"Vd");h(this,"Vb");h(this,"mosfetType");h(this,"chartType");h(this,"originalMaxValue");h(this,"xScaleType");h(this,"yScaleType");h(this,"yMin",0);h(this,"yMax",0);h(this,"xTicks",[]);h(this,"yTicks",[]);h(this,"xScale",0);h(this,"yScale",0);h(this,"boundingBox");this.transformationMatrix.isMirrored&&this.transformations[this.transformations.length-1].value.mirror(!0,!1,!0),this.transformations[this.transformations.length-1].value.rotate(-this.transformationMatrix.rotation,!0),this.transformations[this.transformations.length-1].value.mirror(!1,!0,!0),n=="Vgs"?this.transformations[this.transformations.length-1].value.translate({x:-T/2,y:0},!0):this.transformations[this.transformations.length-1].value.translate({x:-T/2,y:-E},!0),this.transformations[this.transformations.length-1].value.translate({x:ee.paddingL,y:ee.paddingB},!0),this.displayText=y,this.points=[],this.xAxisLabel=y,this.yAxisLabel=C,this.xUnit=x,this.yUnit=S,this.xScaleType=v,this.yScaleType=L,this.width=T,this.height=E,this.axesWidth=T-ee.paddingL-ee.paddingR,this.axesHeight=E-ee.paddingT-ee.paddingB,this.Vg=l,this.Vs=c,this.Vd=d,this.Vb=f,this.mosfetType=i,this.chartType=n,this.originalMaxValue=b,this.temporaryMinValue=this.minValue,this.temporaryMaxValue=this.maxValue,this.boundingBox=[new M(this.transformations,{x:-100,y:0}),new M(this.transformations,{x:100,y:0}),new M(this.transformations,{x:0,y:-100}),new M(this.transformations,{x:0,y:100})]}copy(t,i="main"){return new ee([t],this.mosfetType,this.chartType,0,0,this.Vg,this.Vs,this.Vd,this.Vb,this.fromNode,this.maxValue,this.xAxisLabel,this.yAxisLabel,this.xUnit,this.yUnit,this.xScaleType,this.yScaleType,this.width,this.height,this.selected,this.visibility,i)}draw(t){if(this.visibility=="hidden")return;this.transformationMatrix.transformCanvas(t);const i=this.localLineThickness/2,n=this.localLineThickness/4;this.chartType=="Vgs"?this.sweepGateVoltages():this.sweepDrainVoltages(),this.preciseDragging?this.xTicks=Os(this.temporaryMinValue,this.temporaryMaxValue,this.xScaleType=="log").filter(f=>f>=this.temporaryMinValue&&f<=this.temporaryMaxValue):this.xTicks=[0,1,2,3,4,5],this.chartType=="Vgs"?this.yTicks=[.001,1e-6,1e-9,1e-12].filter(f=>f>=this.yMin&&f<=this.yMax):this.yTicks=[25,50,75,100].filter(f=>f>=this.yMin&&f<=this.yMax);const a=this.xValueToLocation(this.value),o=(this.temporaryMaxValue-this.temporaryMinValue)/4;this.xTicks=this.xTicks.filter(f=>!(this.value-o/2<f&&f<this.value+o/2)),this.plottingValues=this.points.map(f=>({x:this.xValueToLocation(f.x),y:this.yValueToLocation(f.y)})),t.clearRect(-ee.paddingL,-ee.paddingB,this.width,this.height),t.strokeStyle="#000",De(t,[{start:{x:0,y:0},end:{x:this.axesWidth,y:0}},{start:{x:0,y:0},end:{x:0,y:this.axesHeight}}],i,"black"),t.font="16px Arial",t.textAlign="center";let l=this.fillTextGlobalReferenceFrame(t,{x:a,y:-16},this.xAxisLabel,!1);t.font="12px Arial",this.fillTextGlobalReferenceFrame(t,{x:l.x,y:l.y+3},Ze(this.value,"V"),!1),t.font="18px Arial",this.fillTextGlobalReferenceFrame(t,{x:-30,y:this.axesHeight+6},this.yAxisLabel,!0,!0),t.strokeStyle="#ccc",t.font="12px Arial",t.fillStyle="#000",t.textAlign="center",this.xTicks.forEach(f=>{const u=this.xValueToLocation(f),b=Ze(f,this.xUnit);De(t,[{start:{x:u,y:0},end:{x:u,y:-5}}],n,"black"),this.fillTextGlobalReferenceFrame(t,{x:u,y:-18},b)}),this.yTicks.forEach(f=>{const u=this.yValueToLocation(f),b=Ze(f,this.yUnit);De(t,[{start:{x:0,y:u},end:{x:-5,y:u}}],n,"black"),this.fillTextGlobalReferenceFrame(t,{x:-25,y:u-6},b)}),t.strokeStyle="#f00",t.lineWidth=i,t.beginPath(),this.plottingValues.forEach((f,u)=>{u===0?t.moveTo(f.x,f.y):t.lineTo(f.x,f.y)}),t.stroke(),t.lineWidth=n,this.updateLocationBasedOnValue(),t.beginPath(),t.arc(this.location.x,this.location.y,5,0,2*Math.PI),t.fill(),t.moveTo(this.location.x,0),t.lineTo(this.location.x,this.location.y),t.stroke();const c=Ze(this.yValue,this.yUnit),d=c.length*5;this.fillTextGlobalReferenceFrame(t,{x:this.location.x<this.axesWidth-d?Math.max(5,this.location.x+d):this.location.x-d,y:Math.max(5,this.location.y-15)},c),Ti.value&&(t.lineWidth=5,t.strokeStyle="black",t.strokeRect(-ee.paddingL,-ee.paddingB,this.width,this.height))}sweepGateVoltages(t=this.width/3){if(this.yMin=1/0,this.yMax=-1/0,$t(this.minValue,this.maxValue,5).forEach(o=>{const l=this.getMosfetCurrentFromGateVoltage(o);this.yMin=Math.min(this.yMin,l),this.yMax=Math.max(this.yMax,l)}),this.yMax=Math.max(this.yMax,1e-14),this.memoize){this.cacheAttempts+=1;const o=this.pointsCache.get(this.discretizeArgsForCache(this.temporaryMinValue,this.temporaryMaxValue,this.Vs.value.voltage,this.Vd.value.voltage,this.Vb.value.voltage));if(o!==void 0){this.points=o,this.cacheHits+=1;return}}this.points=[];let n={x:0,y:0};$t(this.temporaryMinValue,this.temporaryMaxValue,t).forEach(o=>{n={x:o,y:this.getMosfetCurrentFromGateVoltage(o)},this.points.push(n)}),this.memoize&&this.pointsCache.set(this.discretizeArgsForCache(this.temporaryMinValue,this.temporaryMaxValue,this.Vs.value.voltage,this.Vd.value.voltage,this.Vb.value.voltage),this.points)}sweepDrainVoltages(t=this.width/3){if(this.points=[],this.yMin=1/0,this.yMax=-1/0,$t(this.minValue,this.maxValue,5).forEach(o=>{let l=this.getMosfetSaturationFromDrainVoltage(o);l<0&&(l=0),this.yMax=Math.max(this.yMax,l)}),this.yMin=0,this.memoize){this.cacheAttempts+=1;const o=this.pointsCache.get(this.discretizeArgsForCache(this.temporaryMinValue,this.temporaryMaxValue,this.Vg.value.voltage,this.Vs.value.voltage,this.Vb.value.voltage));if(o!==void 0){this.points=o,this.cacheHits+=1;return}}const n=$t(this.temporaryMinValue,this.temporaryMaxValue,t);let a={x:0,y:0};n.forEach(o=>{a={x:o,y:this.getMosfetSaturationFromDrainVoltage(o)},a.y<0&&(a.y=0),this.points.push(a)}),this.memoize&&this.pointsCache.set(this.discretizeArgsForCache(this.temporaryMinValue,this.temporaryMaxValue,this.Vg.value.voltage,this.Vs.value.voltage,this.Vb.value.voltage),this.points)}discretizeArgsForCache(t,i,n,a,o){return JSON.stringify([t.toFixed(3),i.toFixed(3),n.toFixed(3),a.toFixed(3),o.toFixed(3)])}xLocationToValue(t){let i=0;return this.xScaleType=="linear"?i=t/this.axesWidth*(this.temporaryMaxValue-this.temporaryMinValue)+this.temporaryMinValue:i=10**(Math.log10(t)/this.axesWidth*(Math.log10(this.temporaryMaxValue)-Math.log10(this.temporaryMinValue))+Math.log10(this.temporaryMinValue)),i}xValueToLocation(t){return this.xScaleType=="linear"?(t-this.temporaryMinValue)/(this.temporaryMaxValue-this.temporaryMinValue)*this.axesWidth:(Math.log10(t)-Math.log10(this.temporaryMinValue))/(Math.log10(this.temporaryMaxValue)-Math.log10(this.temporaryMinValue))*this.axesWidth}yValueToLocation(t){return this.yScaleType=="linear"?(t-this.yMin)/(this.yMax-this.yMin)*this.axesHeight:(Math.log10(t)-Math.log10(this.yMin))/(Math.log10(this.yMax)-Math.log10(this.yMin))*this.axesHeight}toggleYAxisLog(){this.yScaleType=this.yScaleType==="log"?"linear":"log"}updateLocationBasedOnValue(){const t=this.value;this.chartType=="Vgs"?this.yValue=this.getMosfetCurrentFromGateVoltage(t):this.yValue=this.getMosfetSaturationFromDrainVoltage(t),this.location={x:this.xValueToLocation(t),y:this.yValueToLocation(this.yValue)}}getMosfetCurrentFromGateVoltage(t){return this.mosfetType=="nmos"?Ds(t,this.Vs.value.voltage,this.Vd.value.voltage,this.Vb.value.voltage).I:Ls(t,this.Vs.value.voltage,this.Vd.value.voltage,this.Vb.value.voltage).I}getMosfetSaturationFromDrainVoltage(t){return this.mosfetType=="nmos"?Ds(this.Vg.value.voltage,this.Vs.value.voltage,t,this.Vb.value.voltage).saturationLevel*100:Ls(this.Vg.value.voltage,this.Vs.value.voltage,t,this.Vb.value.voltage).saturationLevel*100}updateValueBasedOnMousePosition(t){this.value=this.xLocationToValue(t.x)}mouseDownIntiatesDrag(t){return t.x>0&&t.x<this.axesWidth&&t.y>0&&t.y<this.axesHeight}};h(ee,"paddingL",40),h(ee,"paddingR",10),h(ee,"paddingT",20),h(ee,"paddingB",30);let ft=ee;const H=class H extends Pi{constructor(t=[],i,n,a,o,l,c,d,f,u=3,b=5,y=!1,C="visible",x="visible",S="gate",v="main"){super(t,new W().translate({x:n,y:a}).scale(1/30).mirror(y,i=="pmos"),v);h(this,"mosfetType");h(this,"isDuplicate",!1);h(this,"currentDots");h(this,"gradientSize",100);h(this,"schematicEffects");h(this,"vgs");h(this,"vds");h(this,"Vg");h(this,"Vs");h(this,"Vd");h(this,"Vb");h(this,"gndNode");h(this,"mouseDownInsideSelectionArea",!1);h(this,"vgsChart");h(this,"vdsChart");h(this,"vgsHtmlSlider");h(this,"vdsHtmlSlider");h(this,"vgsSelected",w(!1));h(this,"vdsSelected",w(!1));this.mosfetType=i,this.schematicEffects={gate:{node:o,origin:new M(this.transformations,{x:60,y:0}),color:"red",gradientSize:2},saturation:{node:c,origin:new M(this.transformations,{x:0,y:-60}),color:"red",gradientSize:100}},this.Vg=o,this.Vs=l,this.Vd=c,this.Vb=d,this.gndNode=f,this.anchorPoints={Vg:{x:60,y:0},Vs:{x:0,y:60},Vd:{x:0,y:-60},Vb:{x:0,y:0},SourceSupply:{x:0,y:90},DrainSupply:{x:0,y:-90},Vg_mirror_gate:{x:90,y:0},Vg_mirror_corner:{x:90,y:-90},Vg_mirror_drain:{x:0,y:-90},Vg_drive_gate:{x:120,y:0},Vg_drive_Vsource:{x:120,y:90}};let L="main";v=="mosfet"&&(L="chart"),this.mosfetType=="nmos"?(this.vgs=new ht(this.transformations,l,o,"toNode",10,10,60,ce(75),ce(70),!0,0,u,"Vgs",this.vgsSelected,C,v),this.vds=new ht(this.transformations,l,c,"toNode",30,0,75,ce(140),ce(80),!1,0,b,"Vds",this.vdsSelected,x,v),this.vgsChart=new ft(this.transformations,i,"Vgs",H.chartLocations[S].x,H.chartLocations[S].y,o,l,c,d,f,5,"Vg","Current","V","A","linear","log",200,115,this.vgsSelected,"hidden",L),this.vdsChart=new ft(this.transformations,i,"Vds",H.chartLocations[S].x,H.chartLocations[S].y,o,l,c,d,f,5,"Vd","Saturation Level","V","%","linear","linear",200,115,this.vdsSelected,"hidden",L),this.currentDots=new Ws([{start:{x:-15,y:-60},end:{x:-15,y:60}}])):(this.vgs=new ht(this.transformations,o,l,"fromNode",10,10,60,ce(75),ce(70),!0,0,u,"Vsg",this.vgsSelected,C,v),this.vds=new ht(this.transformations,c,l,"fromNode",30,0,75,ce(140),ce(80),!1,0,b,"Vsd",this.vdsSelected,x,v),this.vgsChart=new ft(this.transformations,i,"Vgs",H.chartLocations[S].x,H.chartLocations[S].y,o,l,c,d,f,5,"Vg","Current","V","A","linear","log",200,115,this.vgsSelected,"hidden",L),this.vdsChart=new ft(this.transformations,i,"Vds",H.chartLocations[S].x,H.chartLocations[S].y,o,l,c,d,f,5,"Vd","Saturation Level","V","%","linear","linear",200,115,this.vdsSelected,"hidden",L),this.currentDots=new Ws([{start:{x:-15,y:60},end:{x:-15,y:-60}}])),this.vgsHtmlSlider=this.vgs.toHtmlSlider(),this.vdsHtmlSlider=this.vds.toHtmlSlider()}get htmlSliders(){return[this.vgsHtmlSlider,this.vdsHtmlSlider]}copy(t,i="main"){const n=new H([t].concat(this.transformations.slice(1)),this.mosfetType,0,0,this.Vg,this.Vs,this.Vd,this.Vb,this.gndNode,void 0,void 0,this.mosfetType=="nmos"==this.transformationMatrix.isMirrored,this.vgs.visibility,this.vds.visibility,"deviceOrigin",i);return n.vgsChart.visibility="hidden",n.vdsChart.visibility="hidden",n.isDuplicate=!0,n.transformations[n.transformations.length-1].value=new W,n}draw(t){this.transformationMatrix.transformCanvas(t),this.drawSelectedHalo(t);const i=[{start:{x:0,y:20},end:{x:0,y:59}},{start:{x:0,y:20},end:{x:26,y:20}},{start:{x:0,y:-20},end:{x:0,y:-59}},{start:{x:0,y:-20},end:{x:26,y:-20}},{start:{x:26,y:-40},end:{x:26,y:40}}],n=this.mosfetType=="nmos"?[{start:{x:40,y:30},end:{x:40,y:-30}},{start:{x:40,y:0},end:{x:60,y:0}}]:[{start:{x:40,y:30},end:{x:40,y:-30}},{start:{x:50,y:0},end:{x:60,y:0}}],a=this.mosfetType=="nmos"?[]:[{center:{x:45,y:0},outerDiameter:10}];this.gradientSize=this.getGradientSizeFromSaturationLevel();const l=yi(t,{x:0,y:-60},this.gradientSize,"rgba(200, 200, 200, 1)"),c=this.getForwardCurrentScaled(),d=this.getGateColorFromForwardCurrent();De(t,i,this.localLineThickness,"black"),De(t,n,this.localLineThickness,d),Cs(t,a,this.localLineThickness,d),Mi(t,i,this.localLineThickness,l),this.schematicEffects.saturation.gradientSize=this.gradientSize/30*3.5,this.schematicEffects.saturation.color="rgba(200, 200, 200, 1)",this.schematicEffects.gate.gradientSize=c*3.5,this.schematicEffects.gate.color=d,this.currentDots.draw(t);const f=Ze(this.current,"A");let u="";for(const C of f)"-0123456789.".indexOf(C)>-1&&(u+=C);const b=f.slice(u.length);t.fillStyle="black",t.font="14px sans-serif";const y=this.fillTextGlobalReferenceFrame(t,{x:20,y:this.mosfetType=="nmos"?-3:3},u,!0,!0,14);t.font="14px sans-serif",this.fillTextGlobalReferenceFrame(t,y,b,!0,!0),this.vgsChart.draw(t),this.vdsChart.draw(t),this.vgs.draw(t),this.vds.draw(t)}toggleSelected(){this.showCharts.value?(this.showCharts.value=!1,this.vgsChart.visibility="hidden",this.vdsChart.visibility="hidden"):(this.showCharts.value=!0,this.vgsChart.visibility=this.vgs.visibility,this.vdsChart.visibility=this.vds.visibility)}get current(){return this.getMosfetCurrent()}get saturationLevel(){return this.getMosfetSaturationLevel()}get forwardCurrent(){return this.getMosfetForwardCurrent()}getMosfetEkvResult(){return this.mosfetType=="pmos"?Ls(this.Vg.value.voltage,this.Vs.value.voltage,this.Vd.value.voltage,this.Vb.value.voltage):Ds(this.Vg.value.voltage,this.Vs.value.voltage,this.Vd.value.voltage,this.Vb.value.voltage)}getMosfetCurrent(){return this.getMosfetEkvResult().I}getMosfetSaturationLevel(){return this.getMosfetEkvResult().saturationLevel}getMosfetForwardCurrent(){return this.getMosfetEkvResult().IF}getGradientSizeFromSaturationLevel(){return this.getRelativeScaling()*60*B(0,1,1-this.saturationLevel)}getForwardCurrentScaled(){return B(0,1,Math.log10(this.forwardCurrent/.005)*.2+1)}getGateColorFromForwardCurrent(){const t=this.getForwardCurrentScaled();return Un(t)}};h(H,"chartWidth",200),h(H,"chartHeight",120),h(H,"chartLocations",{base:{x:-H.chartWidth/2-100,y:0},lowerBase:{x:-H.chartWidth/2-100,y:100},gate:{x:H.chartWidth/2+120,y:0},furtherGate:{x:H.chartWidth/2+150,y:0},voltageSource:{x:H.chartWidth/2+240,y:0},lowerVoltageSource:{x:H.chartWidth/2+240,y:100},mirrorDriver:{x:H.chartWidth/2+110,y:-H.chartHeight-20},mirrorReceiver:{x:H.chartWidth/2+50,y:-H.chartHeight-20},deviceOrigin:{x:0,y:0}});let U=H;class ut extends Z{constructor(t,i,n,a,o=new Fe,l={},c={},d={},f=new W){super([w(new W)],new W);h(this,"name");h(this,"boundingBox");h(this,"schematic");h(this,"devices");h(this,"selectedDeviceCharts",[]);h(this,"selectedDeviceChartsBoundingBox");h(this,"selectedDeviceChartsTransformationMatrix",w(new W));h(this,"selectedDeviceKey","none");h(this,"nodes");h(this,"textTransformationMatrix");h(this,"originalTextTransformationMatrix");h(this,"circuitCopy");h(this,"anyDevicesSelected",!1);h(this,"moveTectonicPlatesWhileDragging",!0);this.name=t,this.boundingBox=[new M(this.transformations,{x:i.x-n/2,y:i.y-a/2}),new M(this.transformations,{x:i.x+n/2,y:i.y-a/2}),new M(this.transformations,{x:i.x-n/2,y:i.y+a/2}),new M(this.transformations,{x:i.x+n/2,y:i.y+a/2})],this.schematic=o,this.devices={mosfets:l,voltageSources:c},this.nodes=d,this.originalTextTransformationMatrix=f,this.textTransformationMatrix=this.transformationMatrix.scale(1/30).multiply(this.originalTextTransformationMatrix),this.circuitCopy=this.copy(),this.selectedDeviceChartsBoundingBox=[new M(this.transformations,{x:-120,y:0}),new M(this.transformations,{x:120,y:0}),new M(this.transformations,{x:0,y:-120}),new M(this.transformations,{x:0,y:120})],Z.circuitTransformationMatrix=this.transformationMatrix,Z.textTransformationMatrix=this.textTransformationMatrix}assignKeysToDevices(){Object.entries(this.devices.mosfets).forEach(([t,i])=>{i.key=t}),Object.entries(this.devices.voltageSources).forEach(([t,i])=>{i.key=t})}finishSetup(){var t;this.assignKeysToDevices(),this.circuitCopy=this.copy(),(t=this.circuitCopy)==null||t.assignKeysToDevices(),this.allDevices.forEach(i=>{i.finishSetup()})}get allSliders(){return this.makeListOfSliders()}get htmlSliders(){const t=[];return Object.values(this.devices.voltageSources).sort((i,n)=>i.order-n.order).forEach(i=>{const n=i.namedHtmlSliders;n.deviceType="voltageSource",t.push(n)}),Object.values(this.devices.mosfets).sort((i,n)=>i.order-n.order).forEach(i=>{const n=i.namedHtmlSliders;n.deviceType="mosfet",t.push(n)}),t}get anySlidersDragging(){let t=!1;return this.allSliders.forEach(i=>{i.dragging&&(t=!0)}),t}get allDevices(){const t=Object.values(this.devices.mosfets),i=Object.values(this.devices.voltageSources);return t.concat(i)}copy(){const t=w(new W),i=new Xn(this.name,{x:0,y:0},10,10,this.schematic.copy(t),Object.fromEntries(Object.entries(this.devices.mosfets).map(([n,a])=>[n,a.copy(t,"mosfet")])),Object.fromEntries(Object.entries(this.devices.voltageSources).map(([n,a])=>[n,a.copy(t,"mosfet")])),this.nodes,this.textTransformationMatrix);return i.transformations[0]=t,i}draw(t){t.save(),this.setScaleBasedOnBoundingBox(t),this.transformationMatrix.transformCanvas(t),(!this.anySlidersDragging||this.moveTectonicPlatesWhileDragging)&&D.allTectonicPlates.forEach(i=>{i.locationIsFunctionOfChartVisibility||Si.value?i.moveTowardDesiredLocation():i.moveTowardHomeLocation()}),this.schematic.draw(t),Object.values(this.devices.mosfets).forEach(i=>{i.draw(t)}),Object.values(this.devices.voltageSources).forEach(i=>{i.draw(t)}),Ti.value&&this.drawGrid(t),t.restore()}drawSelectedDeviceCharts(t){const i=this.calculateTransformationMatrixBasedOnBoundingBox(t,this.selectedDeviceChartsBoundingBox);this.selectedDeviceChartsTransformationMatrix.value=i,Z.textTransformationMatrix.relativeScale=i.relativeScale,this.selectedDeviceCharts.forEach(n=>{n.draw(t)})}setSelectedDevice(t){if(this.circuitCopy&&(this.circuitCopy.boundingBox=t.boundingBox,this.anyDevicesSelected=!0,t.key!=this.selectedDeviceKey))if(this.selectedDeviceKey=t.key,t instanceof U){const i=this.circuitCopy.devices.mosfets[t.key];i.vgs.visibility=t.vgs.visibility,i.vds.visibility=t.vds.visibility,i.vgsChart.visibility="hidden",i.vdsChart.visibility="hidden",this.selectedDeviceCharts=[t.vgsChart.copy(this.selectedDeviceChartsTransformationMatrix,"chart"),t.vdsChart.copy(this.selectedDeviceChartsTransformationMatrix,"chart")],this.selectedDeviceCharts[0].visibility=t.vgs.visibility,this.selectedDeviceCharts[1].visibility=t.vds.visibility}else if(t instanceof le){const i=this.circuitCopy.devices.voltageSources[t.key];i.voltageDrop.visibility=t.voltageDrop.visibility,this.selectedDeviceCharts=[]}else this.selectedDeviceCharts=[]}resetSelectedDevice(){this.selectedDeviceCharts=[],this.anyDevicesSelected=!1,this.selectedDeviceKey="none",this.circuitCopy&&this.circuitCopy.allSliders.forEach(t=>{t.visibility="hidden"})}makeListOfSliders(){const t=[];for(const i in this.devices.mosfets){const n=this.devices.mosfets[i];t.push(n.vgs),t.push(n.vds),t.push(n.vgsChart),t.push(n.vdsChart),t.push(n.vgsHtmlSlider),t.push(n.vdsHtmlSlider)}for(const i in this.devices.voltageSources){const n=this.devices.voltageSources[i];t.push(n.voltageDrop),t.push(n.htmlSlider)}return this.selectedDeviceCharts.forEach(i=>{t.push(i)}),this.circuitCopy?t.concat(this.circuitCopy.allSliders):t}setSlidersActive(t){const i=a=>{t?(a.vgs.visibility="visible",a.vds.visibility="visible",a.vgsHtmlSlider.visibility="visible",a.vdsHtmlSlider.visibility="visible",(a.vgsChart.visibility=="visible"||a.vgsChart.visibility=="locked")&&(a.vgsChart.visibility="visible"),(a.vdsChart.visibility=="visible"||a.vdsChart.visibility=="locked")&&(a.vdsChart.visibility="visible")):(a.vgs.visibility=a.vgs.originalVisibility,a.vds.visibility=a.vds.originalVisibility,a.vgsHtmlSlider.visibility=a.vgsHtmlSlider.originalVisibility,a.vdsHtmlSlider.visibility=a.vdsHtmlSlider.originalVisibility,(a.vgsChart.visibility=="visible"||a.vgsChart.visibility=="locked")&&(a.vgsChart.visibility=a.vgs.visibility),(a.vdsChart.visibility=="visible"||a.vdsChart.visibility=="locked")&&(a.vdsChart.visibility=a.vds.visibility)),a.vgsHtmlSlider.react(),a.vdsHtmlSlider.react()};Object.values(this.devices.mosfets).forEach(a=>{i(a),a.selected.value&&this.circuitCopy&&i(this.circuitCopy.devices.mosfets[a.key])});const n=a=>{t?(a.voltageDrop.visibility="visible",a.htmlSlider.visibility="visible"):(a.voltageDrop.visibility=a.voltageDrop.originalVisibility,a.htmlSlider.visibility=a.htmlSlider.originalVisibility),a.htmlSlider.react()};if(Object.values(this.devices.voltageSources).forEach(a=>{n(a),a.selected.value&&this.circuitCopy&&n(this.circuitCopy.devices.voltageSources[a.key])}),this.selectedDeviceCharts.length>=2)if(t)(this.selectedDeviceCharts[0].visibility=="visible"||this.selectedDeviceCharts[0].visibility=="locked")&&(this.selectedDeviceCharts[0].visibility="visible"),(this.selectedDeviceCharts[1].visibility=="visible"||this.selectedDeviceCharts[1].visibility=="locked")&&(this.selectedDeviceCharts[1].visibility="visible");else{const a=Object.values(this.devices.mosfets).filter(o=>o.selected);if(a.length>=1){const o=a[0];(this.selectedDeviceCharts[0].visibility=="visible"||this.selectedDeviceCharts[0].visibility=="locked")&&(this.selectedDeviceCharts[0].visibility=o.vgs.visibility=="hidden"?"locked":o.vgs.visibility),(this.selectedDeviceCharts[1].visibility=="visible"||this.selectedDeviceCharts[1].visibility=="locked")&&(this.selectedDeviceCharts[1].visibility=o.vds.visibility=="hidden"?"locked":o.vds.visibility)}}}drawGrid(t){this.transformationMatrix.transformCanvas(t);const i=this.transformationMatrix.inverse().transformPoint({x:0,y:0}),n=this.transformationMatrix.inverse().transformPoint({x:Ai.value.width*et.value,y:Ai.value.height*et.value});for(let a=Math.floor(i.x);a<=Math.ceil(n.x);a+=1)for(let o=Math.floor(i.y);o<=Math.ceil(n.y);o+=1){let l=.1;(ct(a,10)==0||ct(o,10)==0)&&(l=.2),t.fillStyle="brown",(a==0||o==0)&&(t.fillStyle="black"),t.beginPath(),t.arc(a,o,l,0,2*Math.PI),t.fill()}Cs(t,this.boundingBox.map(a=>({center:a.toPoint(),outerDiameter:2})),.2,"purple")}calculateTransformationMatrixBasedOnBoundingBox(t,i=this.boundingBox){const n=Math.min(...i.map(S=>S.toPoint().x)),a=Math.max(...i.map(S=>S.toPoint().x)),o=Math.min(...i.map(S=>S.toPoint().y)),l=Math.max(...i.map(S=>S.toPoint().y)),c=Math.abs(o-l),d=Math.abs(a-n),f={x:n+d/2,y:o+c/2},u=Math.max(t.canvas.width,1),b=Math.max(t.canvas.height,1),y=Math.min(u/et.value/d,b/et.value/c),C={x:(u/et.value/y-d)/2,y:(b/et.value/y-c)/2};return new W().scale(et.value*y).translate(C).translate({x:-f.x+d/2,y:-f.y+c/2})}setScaleBasedOnBoundingBox(t,i=this.boundingBox){this.transformations[1].value=new W,this.transformations[0].value=this.calculateTransformationMatrixBasedOnBoundingBox(t,i),this.textTransformationMatrix=this.transformationMatrix.scale(1/30).multiply(this.originalTextTransformationMatrix),this.setCtxArtistScale()}setCtxArtistScale(){Z.circuitTransformationMatrix=this.transformationMatrix,Z.textTransformationMatrix=this.textTransformationMatrix}resetNodeCapacitance(){for(const t in this.nodes){const i=this.nodes[t].value;i.capacitance=i.originalCapacitance}}nodeVoltagesToJson(){const t=Object.fromEntries(Object.entries(this.nodes).map(([n,a])=>[n,a.value.voltage]));return JSON.stringify([this.name,t])}fixedNodeVoltagesToJson(){const t=Object.fromEntries(Object.entries(this.nodes).filter(([a,o])=>o.value.fixed).map(([a,o])=>[a,o.value.voltage])),i=[this.name,t,{earlyEffect:Jt.value}];return JSON.stringify(i)}nodeVoltagesFromJson(t){const i=JSON.parse(t);if(i[0]!=this.name)return!1;let n=!1;const a=i[1];Object.entries(a).forEach(([o,l])=>{this.nodes[o].value.voltage=l,[p,R].includes(o)||(n=!0)}),n&&this.resetNodeCapacitance()}}class Xn extends ut{copy(){return null}setCtxArtistScale(){}}class $n{constructor(){h(this,"items",[])}enqueue(s){this.items.push(s)}dequeue(){return this.items.shift()}peek(){return this.items[0]}isEmpty(){return this.items.length===0}size(){return this.items.length}toArray(){return this.items}fill(s,t){this.items=Array(t).fill(s)}}class O{constructor(s,t){h(this,"voltage");h(this,"netCurrent");h(this,"capacitance");h(this,"originalCapacitance");h(this,"fixed");h(this,"historicVoltages");h(this,"schematicEffects",[]);const i=new $n;i.fill(0,10);const n=t?100:5e-7;this.voltage=s,this.netCurrent=0,this.capacitance=n,this.originalCapacitance=n,this.fixed=!!t,this.historicVoltages=i}}class J extends Z{constructor(s=[],t){super(s,new W().translate(t))}draw(s){this.transformationMatrix.transformCanvas(s);const t=.8;s.strokeStyle="black",s.lineWidth=this.localLineThickness,s.beginPath(),s.moveTo(0,0),s.lineTo(t/2,0),s.lineTo(0,t/2),s.lineTo(-t/2,0),s.lineTo(0,0),s.stroke()}copy(s){return new J([s].concat(this.transformations.slice(1)),{x:0,y:0})}}class ve extends Z{constructor(s=[],t){super(s,new W().translate(t))}draw(s){this.transformationMatrix.transformCanvas(s);const t=.8;s.strokeStyle="black",s.lineWidth=this.localLineThickness,s.beginPath(),s.moveTo(t/2,0),s.lineTo(-t/2,0),s.stroke()}copy(s){return new ve([s].concat(this.transformations.slice(1)),{x:0,y:0})}}const Qn=()=>{const e=new ut("nMosSingle",{x:0,y:-3},10,20);e.nodes={[p]:w(new O(0,!0)),[R]:w(new O(5,!0)),M1_drain:w(new O(5,!1)),M1_gate:w(new O(1,!1))};const s=new D(e.transformations,P(()=>re([{start:{x:0,y:2},end:{x:0,y:-4}}],B(0,5,e.nodes.M1_drain.value.voltage)/5))),t=new D(e.transformations,P(()=>({x:0,y:-4}))),i=new D(e.transformations,P(()=>e.devices.mosfets.M1.showCharts.value?{x:7,y:0}:{x:0,y:0}),!0);return e.boundingBox=[new M(t.transformations,{x:-5,y:-12}),new M(s.transformations,{x:5,y:-12}),new M(e.transformations,{x:-5,y:6}),new M(i.transformations,{x:5,y:6})],e.devices.mosfets={M1:new U(e.transformations,"nmos",0,0,e.nodes.M1_gate,e.nodes[p],e.nodes.M1_drain,e.nodes[p],e.nodes[p],3,5,!1,"visible","visible","furtherGate")},e.devices.mosfets.M1.vgsChart.originalVisibility="visible",e.devices.mosfets.M1.vdsChart.originalVisibility="visible",e.devices.voltageSources={Vd:new le(s.transformations,{x:0,y:-6},e.nodes.M1_drain,e.nodes[R],"Vdd-Vd","vdd",!0)},e.schematic=new Fe(e.transformations,[new J(...e.devices.mosfets.M1.getAnchorPointWithTransformations("Vs"))],[new ve(t.transformations,{x:0,y:-8})],[],Object.values(e.devices.mosfets),Object.values(e.nodes),[{node:e.nodes.M1_drain,lines:[new g(...e.devices.mosfets.M1.getAnchorPointWithTransformations("Vd"),...e.devices.voltageSources.Vd.getAnchorPointWithTransformations("Vminus"))],voltageDisplayLabel:"Drain",voltageDisplayLocations:[new M(s.transformations,{x:.5,y:-4})]},{node:e.nodes[R],lines:[new g(t.transformations,{x:0,y:-8},...e.devices.voltageSources.Vd.getAnchorPointWithTransformations("Vplus"))],voltageDisplayLabel:"",voltageDisplayLocations:[]}]),e.devices.mosfets.M1.adjacentDevices={up:"Vd",down:"",left:"",right:""},e.devices.voltageSources.Vd.adjacentDevices={up:"",down:"M1",left:"",right:""},e.finishSetup(),e},Zn=()=>{const e=new ut("nMosDiffPair",{x:0,y:4},25,20);e.nodes={[p]:w(new O(0,!0)),[R]:w(new O(5,!0)),M1_gate:w(new O(2,!1)),M2_gate:w(new O(2,!1)),Mb_gate:w(new O(.7,!1)),Vnode:w(new O(1,!1))};const s=new D(e.transformations,P(()=>re([{start:{x:0,y:1},end:{x:0,y:-7}}],B(0,5,Math.max(e.nodes.M1_gate.value.voltage,e.nodes.Vnode.value.voltage))/5))),t=new D(e.transformations,P(()=>re([{start:{x:0,y:1},end:{x:0,y:-7}}],B(0,5,Math.max(e.nodes.M2_gate.value.voltage,e.nodes.Vnode.value.voltage))/5))),i=new D(e.transformations,P(()=>re([{start:{x:0,y:0},end:{x:0,y:-8}}],B(0,5,e.nodes.Vnode.value.voltage)/5))),n=new D(s.transformations,P(()=>e.devices.mosfets.Mb.showCharts.value?{x:5,y:2}:{x:0,y:0}),!0),a=new D(s.transformations,P(()=>e.devices.mosfets.M1.showCharts.value?{x:-8,y:0}:{x:0,y:0}),!0),o=new D(t.transformations,P(()=>e.devices.mosfets.M2.showCharts.value?{x:8,y:0}:{x:0,y:0}),!0);return e.boundingBox=[new M(a.transformations,{x:-11,y:-6}),new M(o.transformations,{x:11,y:-6}),new M(e.transformations,{x:-12,y:13}),new M(e.transformations,{x:12,y:13}),new M(n.transformations,{x:11,y:13})],e.devices.mosfets={Mb:new U(e.transformations,"nmos",0,6,e.nodes.Mb_gate,e.nodes[p],e.nodes.Vnode,e.nodes[p],e.nodes[p],void 0,void 0,!1,"locked","locked","lowerVoltageSource"),M1:new U(s.transformations,"nmos",-4,0,e.nodes.M1_gate,e.nodes.Vnode,e.nodes[R],e.nodes[p],e.nodes[p],void 0,void 0,!0,"locked","locked","voltageSource"),M2:new U(t.transformations,"nmos",4,0,e.nodes.M2_gate,e.nodes.Vnode,e.nodes[R],e.nodes[p],e.nodes[p],void 0,void 0,!1,"locked","locked","voltageSource")},e.devices.voltageSources={V1:new le(...e.devices.mosfets.M1.getAnchorPointWithTransformations("Vg_drive_Vsource"),e.nodes[p],e.nodes.M1_gate,"V1","gnd",!0),V2:new le(...e.devices.mosfets.M2.getAnchorPointWithTransformations("Vg_drive_Vsource"),e.nodes[p],e.nodes.M2_gate,"V2","gnd"),Vb:new le(...e.devices.mosfets.Mb.getAnchorPointWithTransformations("Vg_drive_Vsource"),e.nodes[p],e.nodes.Mb_gate,"Vb","gnd")},e.schematic=new Fe(e.transformations,[new J(...e.devices.mosfets.Mb.getAnchorPointWithTransformations("SourceSupply")),new J(...e.devices.voltageSources.Vb.getAnchorPointWithTransformations("gnd")),new J(...e.devices.voltageSources.V1.getAnchorPointWithTransformations("gnd")),new J(...e.devices.voltageSources.V2.getAnchorPointWithTransformations("gnd"))],[new ve(...e.devices.mosfets.M1.getAnchorPointWithTransformations("DrainSupply")),new ve(...e.devices.mosfets.M2.getAnchorPointWithTransformations("DrainSupply"))],[],Object.values(e.devices.mosfets),Object.values(e.nodes),[{node:e.nodes[p],lines:[new g(e.transformations,{x:0,y:8},e.transformations,{x:0,y:9}),new g(...e.devices.voltageSources.Vb.getAnchorPointWithTransformations("Vminus"),...e.devices.voltageSources.Vb.getAnchorPointWithTransformations("gnd")),new g(...e.devices.voltageSources.V1.getAnchorPointWithTransformations("Vminus"),...e.devices.voltageSources.V1.getAnchorPointWithTransformations("gnd")),new g(...e.devices.voltageSources.V2.getAnchorPointWithTransformations("Vminus"),...e.devices.voltageSources.V2.getAnchorPointWithTransformations("gnd"))],voltageDisplayLabel:"",voltageDisplayLocations:[]},{node:e.nodes[R],lines:[new g(...e.devices.mosfets.M1.getAnchorPointWithTransformations("Vd"),...e.devices.mosfets.M1.getAnchorPointWithTransformations("DrainSupply")),new g(...e.devices.mosfets.M2.getAnchorPointWithTransformations("Vd"),...e.devices.mosfets.M2.getAnchorPointWithTransformations("DrainSupply"))],voltageDisplayLabel:"",voltageDisplayLocations:[]},{node:e.nodes.M1_gate,lines:[new g(...e.devices.mosfets.M1.getAnchorPointWithTransformations("Vg"),...e.devices.mosfets.M1.getAnchorPointWithTransformations("Vg_drive_gate")),new g(...e.devices.voltageSources.V1.getAnchorPointWithTransformations("Vplus"),...e.devices.mosfets.M1.getAnchorPointWithTransformations("Vg_drive_gate"))],voltageDisplayLabel:"",voltageDisplayLocations:[]},{node:e.nodes.M2_gate,lines:[new g(...e.devices.mosfets.M2.getAnchorPointWithTransformations("Vg"),...e.devices.mosfets.M2.getAnchorPointWithTransformations("Vg_drive_gate")),new g(...e.devices.voltageSources.V2.getAnchorPointWithTransformations("Vplus"),...e.devices.mosfets.M2.getAnchorPointWithTransformations("Vg_drive_gate"))],voltageDisplayLabel:"",voltageDisplayLocations:[]},{node:e.nodes.Mb_gate,lines:[new g(...e.devices.mosfets.Mb.getAnchorPointWithTransformations("Vg"),...e.devices.mosfets.Mb.getAnchorPointWithTransformations("Vg_drive_gate")),new g(...e.devices.voltageSources.Vb.getAnchorPointWithTransformations("Vplus"),...e.devices.mosfets.Mb.getAnchorPointWithTransformations("Vg_drive_gate"))],voltageDisplayLabel:"",voltageDisplayLocations:[]},{node:e.nodes.Vnode,lines:[new g(i.transformations,{x:-4,y:3},...e.devices.mosfets.M1.getAnchorPointWithTransformations("Vs")),new g(i.transformations,{x:4,y:3},...e.devices.mosfets.M2.getAnchorPointWithTransformations("Vs")),new g(i.transformations,{x:-4,y:3},i.transformations,{x:4,y:3}),new g(...e.devices.mosfets.Mb.getAnchorPointWithTransformations("Vd"),i.transformations,{x:0,y:3})],voltageDisplayLabel:"V",voltageDisplayLocations:[new M(i.transformations,{x:-1,y:2.5})]}]),e.devices.mosfets.M1.adjacentDevices={up:"",down:"Mb",left:"V1",right:"M2"},e.devices.mosfets.Mb.adjacentDevices={up:"M1",down:"Vb",left:"",right:"Vb"},e.devices.mosfets.M2.adjacentDevices={up:"",down:"Mb",left:"M1",right:"V2"},e.devices.voltageSources.Vb.adjacentDevices={up:"Mb",down:"",left:"Mb",right:""},e.devices.voltageSources.V1.adjacentDevices={up:"M1",down:"Mb",left:"",right:"M1"},e.devices.voltageSources.V2.adjacentDevices={up:"M2",down:"Vb",left:"M2",right:""},e.finishSetup(),e};class Ei extends Z{constructor(t=[],i,n,a){super(t,new W().translate(n).scale(1/30));h(this,"node");h(this,"extraNodeLines");h(this,"currentDots");h(this,"gndSymbol");this.node=i,this.extraNodeLines=a,this.currentDots=new Ws([{start:{x:10,y:-60},end:{x:10,y:60}}]),this.gndSymbol=new J(this.transformations,{x:0,y:30})}draw(t){this.transformationMatrix.scale(.5).transformCanvas(t);const i=7,n=[{start:{x:0,y:50},end:{x:0,y:i}},{start:{x:-30,y:i},end:{x:30,y:i}},{start:{x:-30,y:-i},end:{x:30,y:-i}},{start:{x:0,y:-60},end:{x:0,y:-i}}],a=this.transformationMatrix.transformPath(this.extraNodeLines);De(t,n,this.localLineThickness,"black"),De(t,a,this.localLineThickness,"black"),t.clearRect(-30-this.localLineThickness,-i+this.localLineThickness/2,60+2*this.localLineThickness,2*i-2*this.localLineThickness/2),this.gndSymbol.draw(t),this.transformationMatrix.scale(.5).transformCanvas(t),this.currentDots.draw(t)}}h(Ei,"displayCurrent",!1);const ea=()=>{const e=new ut("nMos5TransistorOpAmp",{x:0,y:0},25,28);e.nodes={[p]:w(new O(0,!0)),[R]:w(new O(5,!0)),M1_gate:w(new O(2,!1)),M1_drain:w(new O(4,!1)),M2_gate:w(new O(2,!1)),Mb_gate:w(new O(.7,!1)),Vout:w(new O(4,!1)),Vnode:w(new O(1,!1))};const s=new D(e.transformations,P(()=>re([{start:{x:0,y:1},end:{x:0,y:-7}}],B(0,5,Math.max(e.nodes.M1_gate.value.voltage,e.nodes.Vnode.value.voltage))/5))),t=new D(e.transformations,P(()=>re([{start:{x:0,y:1},end:{x:0,y:-7}}],B(0,5,Math.max(e.nodes.M2_gate.value.voltage,e.nodes.Vnode.value.voltage))/5))),i=new D(e.transformations,P(()=>({x:0,y:-4}))),n=new D(e.transformations,P(()=>re([{start:{x:0,y:0},end:{x:0,y:-8}}],B(0,5,e.nodes.Vnode.value.voltage)/5))),a=new D(e.transformations,P(()=>re([{start:{x:0,y:2},end:{x:0,y:-6}}],B(0,5,Math.max(e.nodes.Vout.value.voltage,e.nodes.M2_gate.value.voltage-1.25))/5))),o=new D(s.transformations,P(()=>e.devices.mosfets.Mb.showCharts.value?{x:5,y:2}:{x:0,y:0}),!0),l=new D(s.transformations,P(()=>e.devices.mosfets.M1.showCharts.value?{x:-8,y:0}:{x:0,y:0}),!0),c=new D(t.transformations,P(()=>e.devices.mosfets.M2.showCharts.value?{x:8,y:0}:{x:0,y:0}),!0),d=new D(i.transformations,P(()=>e.devices.mosfets.M3.showCharts.value?{x:-3,y:-3}:{x:0,y:0}),!0),f=new D(i.transformations,P(()=>e.devices.mosfets.M4.showCharts.value?{x:3,y:-3}:{x:0,y:0}),!0);return e.boundingBox=[new M(l.transformations,{x:-12,y:-14}),new M(c.transformations,{x:12,y:-14}),new M(d.transformations,{x:-12,y:-14}),new M(f.transformations,{x:12,y:-14}),new M(e.transformations,{x:-12,y:14}),new M(o.transformations,{x:12,y:14})],e.devices.mosfets={Mb:new U(e.transformations,"nmos",0,6,e.nodes.Mb_gate,e.nodes[p],e.nodes.Vnode,e.nodes[p],e.nodes[p],void 0,void 0,!1,"locked","locked","lowerVoltageSource"),M1:new U(s.transformations,"nmos",-4,0,e.nodes.M1_gate,e.nodes.Vnode,e.nodes.M1_drain,e.nodes[p],e.nodes[p],void 0,void 0,!0,"locked","locked","voltageSource"),M2:new U(t.transformations,"nmos",4,0,e.nodes.M2_gate,e.nodes.Vnode,e.nodes.Vout,e.nodes[p],e.nodes[p],void 0,void 0,!1,"locked","locked","voltageSource"),M3:new U(i.transformations,"pmos",-4,-9,e.nodes.M1_drain,e.nodes[R],e.nodes.M1_drain,e.nodes[R],e.nodes[p],void 0,void 0,!1,"locked","locked","lowerBase"),M4:new U(i.transformations,"pmos",4,-9,e.nodes.M1_drain,e.nodes[R],e.nodes.Vout,e.nodes[R],e.nodes[p],void 0,void 0,!0,"locked","locked","lowerBase")},e.devices.voltageSources={V1:new le(...e.devices.mosfets.M1.getAnchorPointWithTransformations("Vg_drive_Vsource"),e.nodes[p],e.nodes.M1_gate,"V1","gnd",!0),V2:new le(...e.devices.mosfets.M2.getAnchorPointWithTransformations("Vg_drive_Vsource"),e.nodes[p],e.nodes.M2_gate,"V2","gnd"),Vb:new le(...e.devices.mosfets.Mb.getAnchorPointWithTransformations("Vg_drive_Vsource"),e.nodes[p],e.nodes.Mb_gate,"Vb","gnd")},e.schematic=new Fe(e.transformations,[new J(...e.devices.mosfets.Mb.getAnchorPointWithTransformations("SourceSupply")),new J(...e.devices.voltageSources.Vb.getAnchorPointWithTransformations("gnd")),new J(...e.devices.voltageSources.V1.getAnchorPointWithTransformations("gnd")),new J(...e.devices.voltageSources.V2.getAnchorPointWithTransformations("gnd"))],[new ve(...e.devices.mosfets.M3.getAnchorPointWithTransformations("SourceSupply")),new ve(...e.devices.mosfets.M4.getAnchorPointWithTransformations("SourceSupply"))],[new Ei(a.transformations,e.nodes.Vout,{x:6,y:-4},[{start:{x:6,y:-5},end:{x:6,y:-4}}])],Object.values(e.devices.mosfets),Object.values(e.nodes),[{node:e.nodes[p],lines:[new g(...e.devices.mosfets.Mb.getAnchorPointWithTransformations("Vs"),...e.devices.mosfets.Mb.getAnchorPointWithTransformations("SourceSupply")),new g(...e.devices.voltageSources.Vb.getAnchorPointWithTransformations("Vminus"),...e.devices.voltageSources.Vb.getAnchorPointWithTransformations("gnd")),new g(...e.devices.voltageSources.V1.getAnchorPointWithTransformations("Vminus"),...e.devices.voltageSources.V1.getAnchorPointWithTransformations("gnd")),new g(...e.devices.voltageSources.V2.getAnchorPointWithTransformations("Vminus"),...e.devices.voltageSources.V2.getAnchorPointWithTransformations("gnd"))],voltageDisplayLabel:"",voltageDisplayLocations:[]},{node:e.nodes[R],lines:[new g(...e.devices.mosfets.M3.getAnchorPointWithTransformations("Vs"),...e.devices.mosfets.M3.getAnchorPointWithTransformations("SourceSupply")),new g(...e.devices.mosfets.M4.getAnchorPointWithTransformations("Vs"),...e.devices.mosfets.M4.getAnchorPointWithTransformations("SourceSupply"))],voltageDisplayLabel:"",voltageDisplayLocations:[]},{node:e.nodes.M1_gate,lines:[new g(...e.devices.mosfets.M1.getAnchorPointWithTransformations("Vg"),...e.devices.mosfets.M1.getAnchorPointWithTransformations("Vg_drive_gate")),new g(...e.devices.voltageSources.V1.getAnchorPointWithTransformations("Vplus"),...e.devices.mosfets.M1.getAnchorPointWithTransformations("Vg_drive_gate"))],voltageDisplayLabel:"",voltageDisplayLocations:[]},{node:e.nodes.M2_gate,lines:[new g(...e.devices.mosfets.M2.getAnchorPointWithTransformations("Vg"),...e.devices.mosfets.M2.getAnchorPointWithTransformations("Vg_drive_gate")),new g(...e.devices.voltageSources.V2.getAnchorPointWithTransformations("Vplus"),...e.devices.mosfets.M2.getAnchorPointWithTransformations("Vg_drive_gate"))],voltageDisplayLabel:"",voltageDisplayLocations:[]},{node:e.nodes.Mb_gate,lines:[new g(...e.devices.mosfets.Mb.getAnchorPointWithTransformations("Vg"),...e.devices.mosfets.Mb.getAnchorPointWithTransformations("Vg_drive_gate")),new g(...e.devices.voltageSources.Vb.getAnchorPointWithTransformations("Vplus"),...e.devices.mosfets.Mb.getAnchorPointWithTransformations("Vg_drive_gate"))],voltageDisplayLabel:"",voltageDisplayLocations:[]},{node:e.nodes.Vnode,lines:[new g(n.transformations,{x:-4,y:3},...e.devices.mosfets.M1.getAnchorPointWithTransformations("Vs")),new g(n.transformations,{x:4,y:3},...e.devices.mosfets.M2.getAnchorPointWithTransformations("Vs")),new g(n.transformations,{x:-4,y:3},n.transformations,{x:4,y:3}),new g(...e.devices.mosfets.Mb.getAnchorPointWithTransformations("Vd"),n.transformations,{x:0,y:3})],voltageDisplayLabel:"V",voltageDisplayLocations:[new M(n.transformations,{x:-1,y:2.5})]},{node:e.nodes.M1_drain,lines:[new g(...e.devices.mosfets.M1.getAnchorPointWithTransformations("Vd"),...e.devices.mosfets.M3.getAnchorPointWithTransformations("Vd")),new g(...e.devices.mosfets.M3.getAnchorPointWithTransformations("Vg_mirror_gate"),...e.devices.mosfets.M3.getAnchorPointWithTransformations("Vg_mirror_corner")),new g(...e.devices.mosfets.M3.getAnchorPointWithTransformations("Vg_mirror_drain"),...e.devices.mosfets.M3.getAnchorPointWithTransformations("Vg_mirror_corner")),new g(...e.devices.mosfets.M3.getAnchorPointWithTransformations("Vg"),...e.devices.mosfets.M4.getAnchorPointWithTransformations("Vg"))],voltageDisplayLabel:"",voltageDisplayLocations:[]},{node:e.nodes.Vout,lines:[new g(...e.devices.mosfets.M2.getAnchorPointWithTransformations("Vd"),...e.devices.mosfets.M4.getAnchorPointWithTransformations("Vd")),new g(a.transformations,{x:4,y:-5},a.transformations,{x:6,y:-5})],voltageDisplayLabel:"Vout",voltageDisplayLocations:[new M(a.transformations,{x:6.5,y:-5})]}]),e.devices.mosfets.Mb.adjacentDevices={up:"M1",down:"Vb",left:"",right:"Vb"},e.devices.mosfets.M1.adjacentDevices={up:"M3",down:"Mb",left:"V1",right:"M2"},e.devices.mosfets.M2.adjacentDevices={up:"M4",down:"Mb",left:"M1",right:"V2"},e.devices.mosfets.M3.adjacentDevices={up:"",down:"M1",left:"",right:"M4"},e.devices.mosfets.M4.adjacentDevices={up:"",down:"M2",left:"M3",right:""},e.devices.voltageSources.Vb.adjacentDevices={up:"Mb",down:"",left:"Mb",right:"V2"},e.devices.voltageSources.V1.adjacentDevices={up:"M1",down:"Mb",left:"",right:"M1"},e.devices.voltageSources.V2.adjacentDevices={up:"M2",down:"Vb",left:"M2",right:""},e.finishSetup(),e},ta=()=>{const e=new ut("nMos9TransistorOpAmp",{x:10,y:-2},50,30);e.nodes={[p]:w(new O(0,!0)),[R]:w(new O(5,!0)),M1_gate:w(new O(2,!1)),M1_drain:w(new O(4,!1)),M2_gate:w(new O(2,!1)),M2_drain:w(new O(4,!1)),M7_drain:w(new O(1,!1)),Mb_gate:w(new O(.7,!1)),Vout:w(new O(4,!1)),Vnode:w(new O(1,!1))};const s=new D(e.transformations,P(()=>re([{start:{x:0,y:1},end:{x:0,y:-7}}],B(0,5,Math.max(e.nodes.M1_gate.value.voltage,e.nodes.Vnode.value.voltage))/5))),t=new D(e.transformations,P(()=>re([{start:{x:0,y:1},end:{x:0,y:-7}}],B(0,5,Math.max(e.nodes.M2_gate.value.voltage,e.nodes.Vnode.value.voltage))/5))),i=new D(e.transformations,P(()=>({x:0,y:-3}))),n=new D(i.transformations,P(()=>{let x=0;return(e.devices.mosfets.M5.showCharts.value||e.devices.mosfets.M6.showCharts.value)&&(e.devices.mosfets.M2.showCharts.value?x=-7:x=-4),Si.value&&(x-=3),{x:0,y:x}}),!0),a=new D(e.transformations,P(()=>{let x=[e.devices.mosfets.M2.showCharts.value,e.devices.mosfets.M5.showCharts.value,e.devices.mosfets.M6.showCharts.value,e.devices.mosfets.Mb.showCharts.value,e.devices.mosfets.M7.showCharts.value].filter(Boolean).length;return x==0?{x:0,y:0}:x==1?{x:5,y:0}:e.devices.mosfets.Mb.showCharts.value&&e.devices.mosfets.M7.showCharts.value?{x:10,y:0}:e.devices.mosfets.M5.showCharts.value&&e.devices.mosfets.M6.showCharts.value?{x:8,y:0}:{x:5,y:0}}),!0),o=new D(n.transformations,P(()=>a.desiredLocation.value),!0),l=new D(e.transformations,P(()=>re([{start:{x:0,y:0},end:{x:0,y:-8}}],B(0,5,e.nodes.Vnode.value.voltage)/5))),c=new D(a.transformations,P(()=>({x:0,y:(n.desiredLocation.value.y-a.desiredLocation.value.y)/2})),!0),d=new D(c.transformations,P(()=>{const x=-(n.desiredLocation.value.y-a.desiredLocation.value.y);return re([{start:{x:0,y:7+x/2},end:{x:0,y:-10-x/2}}],B(0,5,e.nodes.Vout.value.voltage)/5)})),f=new D(e.transformations,P(()=>e.devices.mosfets.Mb.showCharts.value||e.devices.mosfets.M7.showCharts.value||e.devices.mosfets.M8.showCharts.value?{x:0,y:2}:{x:0,y:0}),!0),u=new D(e.transformations,P(()=>e.devices.mosfets.M1.showCharts.value?{x:-8,y:0}:{x:0,y:0}),!0),b=new D(n.transformations,P(()=>e.devices.mosfets.M3.showCharts.value?{x:-3,y:-4}:{x:0,y:0}),!0),y=new D(o.transformations,P(()=>e.devices.mosfets.M4.showCharts.value?{x:2,y:-4}:{x:0,y:0}),!0),C=new D(a.transformations,P(()=>e.devices.mosfets.M8.showCharts.value?{x:2,y:2}:{x:0,y:0}),!0);return e.boundingBox=[new M(b.transformations,{x:-12,y:-16}),new M(y.transformations,{x:33,y:-16}),new M(f.transformations,{x:-12,y:12}),new M(u.transformations,{x:-12,y:0}),new M(C.transformations,{x:33,y:12})],e.devices.mosfets={Mb:new U(e.transformations,"nmos",0,6,e.nodes.Mb_gate,e.nodes[p],e.nodes.Vnode,e.nodes[p],e.nodes[p],void 0,void 0,!1,"locked","locked","lowerVoltageSource"),M1:new U(s.transformations,"nmos",-4,0,e.nodes.M1_gate,e.nodes.Vnode,e.nodes.M1_drain,e.nodes[p],e.nodes[p],void 0,void 0,!0,"locked","locked","voltageSource"),M2:new U(t.transformations,"nmos",4,0,e.nodes.M2_gate,e.nodes.Vnode,e.nodes.M2_drain,e.nodes[p],e.nodes[p],void 0,void 0,!1,"locked","locked","voltageSource"),M3:new U(n.transformations,"pmos",-4,-12,e.nodes.M1_drain,e.nodes[R],e.nodes.M1_drain,e.nodes[R],e.nodes[p],void 0,void 0,!1,"locked","locked","lowerBase"),M4:new U(o.transformations,"pmos",24,-12,e.nodes.M1_drain,e.nodes[R],e.nodes.Vout,e.nodes[R],e.nodes[p],void 0,void 0,!0,"locked","locked","lowerBase"),M5:new U(n.transformations,"pmos",4,-7,e.nodes.M2_drain,e.nodes[R],e.nodes.M2_drain,e.nodes[R],e.nodes[p],void 0,void 0,!1,"locked","locked","mirrorDriver"),M6:new U(o.transformations,"pmos",16,-7,e.nodes.M2_drain,e.nodes[R],e.nodes.M7_drain,e.nodes[R],e.nodes[p],void 0,void 0,!0,"locked","locked","mirrorReceiver"),M7:new U(a.transformations,"nmos",16,6,e.nodes.M7_drain,e.nodes[p],e.nodes.M7_drain,e.nodes[p],e.nodes[p],void 0,void 0,!1,"locked","locked","lowerBase"),M8:new U(a.transformations,"nmos",24,6,e.nodes.M7_drain,e.nodes[p],e.nodes.Vout,e.nodes[p],e.nodes[p],void 0,void 0,!0,"locked","locked","lowerBase")},e.devices.voltageSources={V1:new le(...e.devices.mosfets.M1.getAnchorPointWithTransformations("Vg_drive_Vsource"),e.nodes[p],e.nodes.M1_gate,"V1","gnd",!0),V2:new le(...e.devices.mosfets.M2.getAnchorPointWithTransformations("Vg_drive_Vsource"),e.nodes[p],e.nodes.M2_gate,"V2","gnd"),Vb:new le(...e.devices.mosfets.Mb.getAnchorPointWithTransformations("Vg_drive_Vsource"),e.nodes[p],e.nodes.Mb_gate,"Vb","gnd")},e.schematic=new Fe(e.transformations,[new J(...e.devices.mosfets.Mb.getAnchorPointWithTransformations("SourceSupply")),new J(...e.devices.mosfets.M7.getAnchorPointWithTransformations("SourceSupply")),new J(...e.devices.mosfets.M8.getAnchorPointWithTransformations("SourceSupply")),new J(...e.devices.voltageSources.Vb.getAnchorPointWithTransformations("gnd")),new J(...e.devices.voltageSources.V1.getAnchorPointWithTransformations("gnd")),new J(...e.devices.voltageSources.V2.getAnchorPointWithTransformations("gnd"))],[new ve(...e.devices.mosfets.M3.getAnchorPointWithTransformations("SourceSupply")),new ve(...e.devices.mosfets.M4.getAnchorPointWithTransformations("SourceSupply")),new ve(...e.devices.mosfets.M5.getAnchorPointWithTransformations("SourceSupply")),new ve(...e.devices.mosfets.M6.getAnchorPointWithTransformations("SourceSupply"))],[],Object.values(e.devices.mosfets),Object.values(e.nodes),[{node:e.nodes[p],lines:[new g(...e.devices.mosfets.Mb.getAnchorPointWithTransformations("Vs"),...e.devices.mosfets.Mb.getAnchorPointWithTransformations("SourceSupply")),new g(...e.devices.mosfets.M7.getAnchorPointWithTransformations("Vs"),...e.devices.mosfets.M7.getAnchorPointWithTransformations("SourceSupply")),new g(...e.devices.mosfets.M8.getAnchorPointWithTransformations("Vs"),...e.devices.mosfets.M8.getAnchorPointWithTransformations("SourceSupply")),new g(...e.devices.voltageSources.Vb.getAnchorPointWithTransformations("Vminus"),...e.devices.voltageSources.Vb.getAnchorPointWithTransformations("gnd")),new g(...e.devices.voltageSources.V1.getAnchorPointWithTransformations("Vminus"),...e.devices.voltageSources.V1.getAnchorPointWithTransformations("gnd")),new g(...e.devices.voltageSources.V2.getAnchorPointWithTransformations("Vminus"),...e.devices.voltageSources.V2.getAnchorPointWithTransformations("gnd"))],voltageDisplayLabel:"",voltageDisplayLocations:[]},{node:e.nodes[R],lines:[new g(...e.devices.mosfets.M3.getAnchorPointWithTransformations("Vs"),...e.devices.mosfets.M3.getAnchorPointWithTransformations("SourceSupply")),new g(...e.devices.mosfets.M4.getAnchorPointWithTransformations("Vs"),...e.devices.mosfets.M4.getAnchorPointWithTransformations("SourceSupply")),new g(...e.devices.mosfets.M5.getAnchorPointWithTransformations("Vs"),...e.devices.mosfets.M5.getAnchorPointWithTransformations("SourceSupply")),new g(...e.devices.mosfets.M6.getAnchorPointWithTransformations("Vs"),...e.devices.mosfets.M6.getAnchorPointWithTransformations("SourceSupply"))],voltageDisplayLabel:"",voltageDisplayLocations:[]},{node:e.nodes.M1_gate,lines:[new g(...e.devices.mosfets.M1.getAnchorPointWithTransformations("Vg"),...e.devices.mosfets.M1.getAnchorPointWithTransformations("Vg_drive_gate")),new g(...e.devices.voltageSources.V1.getAnchorPointWithTransformations("Vplus"),...e.devices.mosfets.M1.getAnchorPointWithTransformations("Vg_drive_gate"))],voltageDisplayLabel:"",voltageDisplayLocations:[]},{node:e.nodes.M2_gate,lines:[new g(...e.devices.mosfets.M2.getAnchorPointWithTransformations("Vg"),...e.devices.mosfets.M2.getAnchorPointWithTransformations("Vg_drive_gate")),new g(...e.devices.voltageSources.V2.getAnchorPointWithTransformations("Vplus"),...e.devices.mosfets.M2.getAnchorPointWithTransformations("Vg_drive_gate"))],voltageDisplayLabel:"",voltageDisplayLocations:[]},{node:e.nodes.Mb_gate,lines:[new g(...e.devices.mosfets.Mb.getAnchorPointWithTransformations("Vg"),...e.devices.mosfets.Mb.getAnchorPointWithTransformations("Vg_drive_gate")),new g(...e.devices.voltageSources.Vb.getAnchorPointWithTransformations("Vplus"),...e.devices.mosfets.Mb.getAnchorPointWithTransformations("Vg_drive_gate"))],voltageDisplayLabel:"",voltageDisplayLocations:[]},{node:e.nodes.Vnode,lines:[new g(l.transformations,{x:-4,y:3},...e.devices.mosfets.M1.getAnchorPointWithTransformations("Vs")),new g(l.transformations,{x:4,y:3},...e.devices.mosfets.M2.getAnchorPointWithTransformations("Vs")),new g(l.transformations,{x:-4,y:3},l.transformations,{x:4,y:3}),new g(...e.devices.mosfets.Mb.getAnchorPointWithTransformations("Vd"),l.transformations,{x:0,y:3})],voltageDisplayLabel:"V",voltageDisplayLocations:[new M(l.transformations,{x:-1,y:2.5})]},{node:e.nodes.M1_drain,lines:[new g(...e.devices.mosfets.M1.getAnchorPointWithTransformations("Vd"),...e.devices.mosfets.M3.getAnchorPointWithTransformations("Vd")),new g(...e.devices.mosfets.M3.getAnchorPointWithTransformations("Vg_mirror_gate"),...e.devices.mosfets.M3.getAnchorPointWithTransformations("Vg_mirror_corner")),new g(...e.devices.mosfets.M3.getAnchorPointWithTransformations("Vg_mirror_drain"),...e.devices.mosfets.M3.getAnchorPointWithTransformations("Vg_mirror_corner")),new g(...e.devices.mosfets.M3.getAnchorPointWithTransformations("Vg"),...e.devices.mosfets.M4.getAnchorPointWithTransformations("Vg"))],voltageDisplayLabel:"",voltageDisplayLocations:[]},{node:e.nodes.M2_drain,lines:[new g(...e.devices.mosfets.M2.getAnchorPointWithTransformations("Vd"),...e.devices.mosfets.M5.getAnchorPointWithTransformations("Vd")),new g(...e.devices.mosfets.M5.getAnchorPointWithTransformations("Vg"),...e.devices.mosfets.M6.getAnchorPointWithTransformations("Vg")),new g(...e.devices.mosfets.M5.getAnchorPointWithTransformations("Vg_mirror_gate"),...e.devices.mosfets.M5.getAnchorPointWithTransformations("Vg_mirror_corner")),new g(...e.devices.mosfets.M5.getAnchorPointWithTransformations("Vg_mirror_drain"),...e.devices.mosfets.M5.getAnchorPointWithTransformations("Vg_mirror_corner"))],voltageDisplayLabel:"",voltageDisplayLocations:[]},{node:e.nodes.M7_drain,lines:[new g(...e.devices.mosfets.M6.getAnchorPointWithTransformations("Vd"),...e.devices.mosfets.M7.getAnchorPointWithTransformations("Vd")),new g(...e.devices.mosfets.M7.getAnchorPointWithTransformations("Vg"),...e.devices.mosfets.M8.getAnchorPointWithTransformations("Vg")),new g(...e.devices.mosfets.M7.getAnchorPointWithTransformations("Vg_mirror_gate"),...e.devices.mosfets.M7.getAnchorPointWithTransformations("Vg_mirror_corner")),new g(...e.devices.mosfets.M7.getAnchorPointWithTransformations("Vg_mirror_drain"),...e.devices.mosfets.M7.getAnchorPointWithTransformations("Vg_mirror_corner"))],voltageDisplayLabel:"",voltageDisplayLocations:[]},{node:e.nodes.Vout,lines:[new g(...e.devices.mosfets.M8.getAnchorPointWithTransformations("Vd"),...e.devices.mosfets.M4.getAnchorPointWithTransformations("Vd")),new g(d.transformations,{x:24,y:-3},d.transformations,{x:28,y:-3})],voltageDisplayLabel:"Vout",voltageDisplayLocations:[new M(d.transformations,{x:28.5,y:-3})]}]),e.devices.mosfets.Mb.adjacentDevices={up:"M1",down:"Vb",left:"",right:"Vb"},e.devices.mosfets.M1.adjacentDevices={up:"M3",down:"Mb",left:"V1",right:"M2"},e.devices.mosfets.M2.adjacentDevices={up:"M5",down:"Mb",left:"M1",right:"V2"},e.devices.mosfets.M3.adjacentDevices={up:"",down:"M1",left:"",right:"M4"},e.devices.mosfets.M4.adjacentDevices={up:"",down:"M8",left:"M3",right:""},e.devices.mosfets.M5.adjacentDevices={up:"M3",down:"M2",left:"M3",right:"M6"},e.devices.mosfets.M6.adjacentDevices={up:"M4",down:"M7",left:"M5",right:"M4"},e.devices.mosfets.M7.adjacentDevices={up:"M6",down:"",left:"V2",right:"M8"},e.devices.mosfets.M8.adjacentDevices={up:"M4",down:"",left:"M7",right:""},e.devices.voltageSources.Vb.adjacentDevices={up:"Mb",down:"",left:"Mb",right:"M7"},e.devices.voltageSources.V1.adjacentDevices={up:"M1",down:"Mb",left:"",right:"M1"},e.devices.voltageSources.V2.adjacentDevices={up:"M2",down:"Vb",left:"M2",right:"M7"},e.finishSetup(),e},sa=()=>{const e=new ut("pMosSingle",{x:0,y:3},10,20);e.nodes={[p]:w(new O(0,!0)),[R]:w(new O(5,!0)),M1_drain:w(new O(2,!1)),M1_gate:w(new O(1,!1))};const s=new D(e.transformations,P(()=>re([{start:{x:0,y:4},end:{x:0,y:-2}}],B(0,5,e.nodes.M1_drain.value.voltage)/5))),t=new D(e.transformations,P(()=>({x:0,y:4}))),i=new D(e.transformations,P(()=>e.devices.mosfets.M1.showCharts.value?{x:7,y:0}:{x:0,y:0}),!0);return e.boundingBox=[new M(e.transformations,{x:-5,y:-6}),new M(i.transformations,{x:5,y:-6}),new M(t.transformations,{x:-5,y:12}),new M(t.transformations,{x:5,y:12})],e.devices.mosfets={M1:new U(e.transformations,"pmos",0,0,e.nodes.M1_gate,e.nodes[R],e.nodes.M1_drain,e.nodes[R],e.nodes[p],3,5,!1,"visible","visible","furtherGate")},e.devices.mosfets.M1.vgsChart.originalVisibility="visible",e.devices.mosfets.M1.vdsChart.originalVisibility="visible",e.devices.voltageSources={Vd:new le(s.transformations,{x:0,y:6},e.nodes[p],e.nodes.M1_drain,"Vd","gnd",!0)},e.schematic=new Fe(e.transformations,[new J(t.transformations,{x:0,y:8})],[new ve(...e.devices.mosfets.M1.getAnchorPointWithTransformations("Vs"))],[],Object.values(e.devices.mosfets),Object.values(e.nodes),[{node:e.nodes.M1_drain,lines:[new g(...e.devices.mosfets.M1.getAnchorPointWithTransformations("Vd"),...e.devices.voltageSources.Vd.getAnchorPointWithTransformations("Vplus"))],voltageDisplayLabel:"Drain",voltageDisplayLocations:[new M(s.transformations,{x:.5,y:4.5})]},{node:e.nodes[p],lines:[new g(t.transformations,{x:0,y:8},...e.devices.voltageSources.Vd.getAnchorPointWithTransformations("Vminus"))],voltageDisplayLabel:"",voltageDisplayLocations:[]}]),e.devices.mosfets.M1.adjacentDevices={up:"",down:"Vd",left:"",right:""},e.devices.voltageSources.Vd.adjacentDevices={up:"M1",down:"",left:"",right:""},e.finishSetup(),e},ia={nMosSingle:Qn(),nMosDiffPair:Zn(),pMosSingle:sa(),nMos5TransistorOpAmp:ea(),nMos9TransistorOpAmp:ta()},na=(e,s=10)=>{for(let t in e.nodes){const i=e.nodes[t];i.value.netCurrent=0}for(let t in e.devices.mosfets){const i=e.devices.mosfets[t],n=i.getMosfetCurrent();i.mosfetType=="nmos"?(i.Vd.value.netCurrent-=n,i.Vs.value.netCurrent+=n):i.mosfetType=="pmos"&&(i.Vd.value.netCurrent+=n,i.Vs.value.netCurrent-=n)}for(let t in e.devices.voltageSources){const i=e.devices.voltageSources[t];i.fixedAt=="gnd"?(i.current=i.vplus.value.netCurrent,i.vminus.value.netCurrent+=i.current,i.vplus.value.netCurrent=0):i.fixedAt=="vdd"?(i.current=-i.vminus.value.netCurrent,i.vplus.value.netCurrent+=i.current,i.vminus.value.netCurrent=0):console.error("Cannot solve voltage source not attached to GND or VDD")}for(let t in e.nodes){const i=e.nodes[t];if(t==p){i.value.voltage=0;continue}if(t==R){i.value.voltage=5;continue}if(i.value.fixed)continue;aa(i);let n=i.value.netCurrent/i.value.capacitance*(s/1e3)*.5;n>.1?n=.1:n<-.1&&(n=-.1),i.value.voltage+=n,i.value.historicVoltages.dequeue(),i.value.historicVoltages.enqueue(i.value.voltage)}},aa=e=>{let s=0,t=0,i=!0;e.value.historicVoltages.toArray().forEach((n,a)=>{const o=n-t>0;n-t==0||o!==i&&(s+=1),i=o,t=n,a<=1&&(s=0)}),s>=2&&(e.value.capacitance+=e.value.originalCapacitance),e.value.capacitance<e.value.originalCapacitance&&(e.value.capacitance=e.value.originalCapacitance)},Ri=Object.fromEntries(Object.entries(ia).map(([e,s])=>[e,s.copy()]));let zs="nMosDiffPair",es=Ri[zs];onmessage=function(e){const s=JSON.parse(e.data);s[0]!=zs&&(es=Ri[s[0]],zs=s[0]),Jt.value=s[2].earlyEffect,es.nodeVoltagesFromJson(e.data),postMessage(es.nodeVoltagesToJson())};const ki=20,zi=()=>{na(es,ki),setTimeout(zi,ki)};zi()})();
